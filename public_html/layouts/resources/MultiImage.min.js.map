{"version":3,"file":"MultiImage.min.js","sources":["MultiImage.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nclass MultiImage {\n\t/**\n\t * Create class instance\n\t *\n\t * @param {HTMLElement|jQuery} inputElement - input type file element inside component\n\t */\n\tconstructor(element) {\n\t\tconst thisInstance = this;\n\t\tthis.elements = {};\n\t\tthis.options = {\n\t\t\tshowCarousel: true\n\t\t};\n\t\tthis.detailView = false;\n\t\tthis.elements.fileInput = element.find('.js-multi-image__file').eq(0);\n\t\tif (this.elements.fileInput.length === 0) {\n\t\t\tthis.detailView = true;\n\t\t}\n\t\tthis.elements.component = element.eq(0);\n\t\tthis.elements.form = element.closest('form').eq(0);\n\t\tthis.elements.addButton = this.elements.component.find('.js-multi-image__file-btn').eq(0);\n\t\tthis.elements.values = this.elements.component.find('.js-multi-image__values').eq(0);\n\t\tthis.elements.progressBar = this.elements.component.find('.js-multi-image__progress-bar').eq(0);\n\t\tthis.elements.progress = this.elements.component.find('.js-multi-image__progress').eq(0);\n\t\tthis.elements.result = this.elements.component.find('.js-multi-image__result').eq(0);\n\t\tthis.fieldInfo = this.elements.values.data('fieldinfo');\n\t\tthis.options.formats = this.fieldInfo.formats;\n\t\tthis.options.limit = this.fieldInfo.limit;\n\t\tif (!this.detailView) {\n\t\t\tthis.files = JSON.parse(this.elements.values.val());\n\t\t} else {\n\t\t\tthis.files = this.elements.values.data('value');\n\t\t}\n\t\tif (!this.detailView) {\n\t\t\tthis.elements.fileInput.fileupload({\n\t\t\t\tdataType: 'json',\n\t\t\t\treplaceFileInput: false,\n\t\t\t\tfileInput: this.fileInput,\n\t\t\t\tautoUpload: false,\n\t\t\t\tadd: this.add.bind(this),\n\t\t\t\tchange: this.change.bind(this),\n\t\t\t\tfail: this.uploadError.bind(this)\n\t\t\t});\n\t\t}\n\t\tthis.elements.component.on('click', '.js-multi-image__popover-img', function (e) {\n\t\t\tthisInstance.zoomPreview($(this).data('hash'));\n\t\t});\n\t\tthis.elements.component.on('click', '.js-multi-image__popover-btn-zoom', function (e) {\n\t\t\te.preventDefault();\n\t\t\tthisInstance.zoomPreview($(this).data('hash'));\n\t\t});\n\t\tthis.elements.component.on('click', '.js-multi-image__popover-btn-download', function (e) {\n\t\t\te.preventDefault();\n\t\t\tthisInstance.download($(this).data('hash'));\n\t\t});\n\t\tif (!this.detailView) {\n\t\t\tthis.elements.component.on('click', '.js-multi-image__popover-btn-delete', function (e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tthisInstance.deleteFile($(this).data('hash'));\n\t\t\t});\n\t\t}\n\t\tthis.loadExistingFiles();\n\t}\n\n\t/**\n\t * Prevent form submission\n\t *\n\t * @param {Event} e\n\t */\n\taddButtonClick(e) {\n\t\te.preventDefault();\n\t\tthis.elements.fileInput.trigger('click');\n\t}\n\n\t/**\n\t * Get file information\n\t *\n\t * @param {String} hash - file id\n\t * @returns {Object}\n\t */\n\tgetFileInfo(hash) {\n\t\tfor (let i = 0, len = this.files.length; i < len; i++) {\n\t\t\tconst file = this.files[i];\n\t\t\tif (file.hash === hash) {\n\t\t\t\treturn file;\n\t\t\t}\n\t\t}\n\t\tapp.errorLog(`File '${hash}' not found.`);\n\t\tapp.showNotify({\n\t\t\ttext: app.translate('JS_INVALID_FILE_HASH') + ` [${hash}]`,\n\t\t\ttype: 'error'\n\t\t});\n\t}\n\n\t/**\n\t * Add property to file info object\n\t *\n\t * @param {String} hash - file id\n\t * @param {String} propertyName\n\t * @param {any} value\n\t * @returns {Object}\n\t */\n\taddFileInfoProperty(hash, propertyName, value) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tfileInfo[propertyName] = value;\n\t\treturn fileInfo;\n\t}\n\n\t/**\n\t * Error event handler from file upload request\n\t *\n\t * @param {Event} e\n\t * @param {Object} data\n\t */\n\tuploadError(e, data) {\n\t\tapp.errorLog('File upload error.');\n\t\tconst { jqXHR, files } = data;\n\t\tif (typeof jqXHR.responseJSON === 'undefined' || jqXHR.responseJSON === null) {\n\t\t\tApp.Fields.MultiImage.currentFileUploads--;\n\t\t\treturn app.showNotify({\n\t\t\t\ttext: app.translate('JS_FILE_UPLOAD_ERROR'),\n\t\t\t\ttype: 'error'\n\t\t\t});\n\t\t}\n\t\tconst response = jqXHR.responseJSON;\n\t\t// first try to show error for concrete file\n\t\tif (\n\t\t\ttypeof response.result !== 'undefined' &&\n\t\t\ttypeof response.result.attach !== 'undefined' &&\n\t\t\tArray.isArray(response.result.attach)\n\t\t) {\n\t\t\tresponse.result.attach.forEach((fileAttach) => {\n\t\t\t\tApp.Fields.MultiImage.currentFileUploads--;\n\t\t\t\tthis.deleteFile(fileAttach.hash, false);\n\t\t\t\tif (typeof fileAttach.error === 'string') {\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttext: fileAttach.error + ` [${fileAttach.name}]`,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttext: app.translate('JS_FILE_UPLOAD_ERROR') + ` [${fileAttach.name}]`,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.updateFormValues();\n\t\t\treturn;\n\t\t}\n\t\t// else show default upload error\n\t\tfiles.forEach((file) => {\n\t\t\tApp.Fields.MultiImage.currentFileUploads--;\n\t\t\tthis.deleteFile(file.hash, false);\n\t\t\tapp.showNotify({\n\t\t\t\ttext: app.translate('JS_FILE_UPLOAD_ERROR') + ` [${file.name}]`,\n\t\t\t\ttype: 'error'\n\t\t\t});\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Update form input values\n\t */\n\tupdateFormValues() {\n\t\tconst formValues = this.files.map((file) => {\n\t\t\treturn { key: file.key, name: file.name, size: file.size };\n\t\t});\n\t\tthis.elements.values.val(JSON.stringify(formValues));\n\t}\n\n\t/**\n\t * Validate file\n\t *\n\t * @param {Object} file\n\t * @returns {boolean}\n\t */\n\tvalidateFile(file) {\n\t\tlet valid = false;\n\t\tthis.options.formats.forEach((format) => {\n\t\t\tif (file.type === 'image/' + format) {\n\t\t\t\tvalid = true;\n\t\t\t}\n\t\t});\n\t\tif (!valid) {\n\t\t\tapp.showNotify({\n\t\t\t\ttext: `${app.translate('JS_INVALID_FILE_TYPE')} [${file.name}]\\n${app.translate(\n\t\t\t\t\t'JS_AVAILABLE_FILE_TYPES'\n\t\t\t\t)}  [${this.options.formats.join(', ')}]`,\n\t\t\t\ttype: 'error'\n\t\t\t});\n\t\t}\n\t\treturn valid;\n\t}\n\n\t/**\n\t * Show limit error\n\t */\n\tshowLimitError() {\n\t\tthis.elements.fileInput.val('');\n\t\tapp.showNotify({\n\t\t\ttext: `${app.translate('JS_FILE_LIMIT')} [${this.options.limit}]`,\n\t\t\ttype: 'error'\n\t\t});\n\t}\n\n\t/**\n\t * Get only valid files from list\n\t *\n\t * @param {Array} files\n\t * @returns {Array}\n\t */\n\tfilterValidFiles(files) {\n\t\tif (files.length + this.files.length > this.options.limit) {\n\t\t\tthis.showLimitError();\n\t\t\treturn [];\n\t\t}\n\t\treturn files.filter((file) => {\n\t\t\treturn this.validateFile(file);\n\t\t});\n\t}\n\n\t/**\n\t * Set files hash\n\t * @param {Array} files\n\t * @returns {Array}\n\t */\n\tsetFilesHash(files) {\n\t\tconst addedFiles = [];\n\t\tfor (let i = 0, len = files.length; i < len; i++) {\n\t\t\tconst file = files[i];\n\t\t\tif (typeof file.hash === 'undefined') {\n\t\t\t\tif (this.files.length < this.options.limit) {\n\t\t\t\t\tfile.hash = this.generateRandomHash(CONFIG.userId);\n\t\t\t\t\tthis.files.push({ hash: file.hash, imageSrc: file.imageSrc, name: file.name, file });\n\t\t\t\t\taddedFiles.push(file);\n\t\t\t\t} else {\n\t\t\t\t\tthis.showLimitError();\n\t\t\t\t\treturn addedFiles;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn addedFiles;\n\t}\n\n\t/**\n\t * Add event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {object} data\n\t */\n\tadd(e, data) {\n\t\treturn;\n\t}\n\n\t/**\n\t * Progressall event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {Object} data\n\t */\n\tprogressAll(e, data) {\n\t\tconst progress = parseInt((data.loaded / data.total) * 100, 10);\n\t\tthis.elements.progressBar.css({ width: progress + '%' });\n\t\tif (progress === 100) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.elements.progress.addClass('d-none');\n\t\t\t\tthis.elements.progressBar.css({ width: '0%' });\n\t\t\t}, 1000);\n\t\t} else {\n\t\t\tthis.elements.progress.removeClass('d-none');\n\t\t}\n\t}\n\n\t/**\n\t * Dragover event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t */\n\tdragOver(e) {\n\t\tthis.elements.component.addClass('c-multi-image__drop-effect');\n\t}\n\n\t/**\n\t * Dragleave event handler\n\t * @param {Event} e\n\t */\n\tdragLeave(e) {\n\t\tthis.elements.component.removeClass('c-multi-image__drop-effect');\n\t}\n\n\t/**\n\t * Download file according to source type (base64/file from server)\n\t *\n\t * @param {String} hash\n\t */\n\tdownload(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tif (fileInfo.imageSrc.substr(0, 8).toLowerCase() === 'file.php') {\n\t\t\treturn this.downloadFile(hash);\n\t\t} else {\n\t\t\treturn this.downloadBase64(hash);\n\t\t}\n\t}\n\n\t/**\n\t * Download file that exists on the server already\n\t * @param {String} hash\n\t */\n\tdownloadFile(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tconst link = document.createElement('a');\n\t\t$(link).css('display', 'none');\n\t\tif (typeof link.download === 'string') {\n\t\t\tdocument.body.appendChild(link); // Firefox requires the link to be in the body\n\t\t\tlink.download = fileInfo.name;\n\t\t\tlink.href = fileInfo.imageSrc;\n\t\t\tlink.click();\n\t\t\tdocument.body.removeChild(link); // remove the link when done\n\t\t} else {\n\t\t\tlocation.replace(fileInfo.imageSrc);\n\t\t}\n\t}\n\n\t/**\n\t * Download file from base64 image\n\t *\n\t * @param {String} hash\n\t */\n\tdownloadBase64(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tconst imageUrl =\n\t\t\t`data:application/octet-stream;filename=${fileInfo.name};base64,` + fileInfo.imageSrc.split(',')[1];\n\t\tconst link = document.createElement('a');\n\t\t$(link).css('display', 'none');\n\t\tif (typeof link.download === 'string') {\n\t\t\tdocument.body.appendChild(link); // Firefox requires the link to be in the body\n\t\t\tlink.download = fileInfo.name;\n\t\t\tlink.href = imageUrl;\n\t\t\tlink.click();\n\t\t\tdocument.body.removeChild(link); // remove the link when done\n\t\t} else {\n\t\t\tlocation.replace(imageUrl);\n\t\t}\n\t}\n\n\t/**\n\t * Display modal window with large preview\n\t *\n\t * @param {string} hash\n\t */\n\tzoomPreview(hash) {\n\t\tconst thisInstance = this;\n\t\tlet fileInfo = this.getFileInfo(hash);\n\t\tconst titleTemplate = () => `<i class=\"fa fa-image\"></i> ${fileInfo.name}`;\n\t\tconst bootboxOptions = {\n\t\t\tsize: 'large',\n\t\t\tbackdrop: true,\n\t\t\tonEscape: true,\n\t\t\ttitle: `<span id=\"bootbox-title-${hash}\">${titleTemplate()}</span>`,\n\t\t\tmessage: `<img src=\"${fileInfo.imageSrc}\" class=\"w-100\" />`,\n\t\t\tbuttons: {}\n\t\t};\n\t\tif (this.options.showCarousel) {\n\t\t\tbootboxOptions.message = this.generateCarousel(hash);\n\t\t}\n\t\tif (!this.detailView) {\n\t\t\tbootboxOptions.buttons.Delete = {\n\t\t\t\tlabel: `<i class=\"fa fa-trash-alt\"></i> ${app.translate('JS_DELETE')}`,\n\t\t\t\tclassName: 'float-left btn btn-danger',\n\t\t\t\tcallback() {\n\t\t\t\t\tthisInstance.deleteFile(fileInfo.hash);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\tbootboxOptions.buttons.Download = {\n\t\t\tlabel: `<i class=\"fa fa-download\" title=\"${app.translate('JS_DOWNLOAD')}\"></i>`,\n\t\t\tclassName: 'float-left btn btn-success',\n\t\t\tcallback() {\n\t\t\t\tthisInstance.download(fileInfo.hash);\n\t\t\t}\n\t\t};\n\t\tbootboxOptions.buttons.Close = {\n\t\t\tlabel: `<i class=\"fa fa-times\" title=\"${app.translate('JS_CLOSE')}\"></i>`,\n\t\t\tclassName: 'btn btn-warning',\n\t\t\tcallback: () => {}\n\t\t};\n\t\tbootbox.dialog(bootboxOptions);\n\t\tif (this.options.showCarousel) {\n\t\t\t$(`#carousel-${hash}`).on('slid.bs.carousel', (e) => {\n\t\t\t\tfileInfo = this.getFileInfo($(e.relatedTarget).data('hash'));\n\t\t\t\t$(`#bootbox-title-${hash}`).html(titleTemplate());\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Remove file from preview and from file list\n\t *\n\t * @param {String} hash\n\t */\n\tdeleteFileCallback(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tif (fileInfo.previewElement) {\n\t\t\tfileInfo.previewElement.popover('dispose').remove();\n\t\t}\n\t\tthis.files = this.files.filter((file) => file.hash !== fileInfo.hash);\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Delete image from input field\n\t * Should be called with this pointing on button element with data-hash attribute\n\t *\n\t * @param {string} hash\n\t * @param {boolean} showConfirmation - dialog?\n\t */\n\tdeleteFile(hash, showConfirmation = true) {\n\t\tif (showConfirmation) {\n\t\t\tconst fileInfo = this.getFileInfo(hash);\n\t\t\tbootbox.confirm({\n\t\t\t\ttitle: `<i class=\"fa fa-trash-alt\"></i> ${app.translate('JS_DELETE_FILE')}`,\n\t\t\t\tmessage: `${app.translate('JS_DELETE_FILE_CONFIRMATION')} <span class=\"font-weight-bold\">${\n\t\t\t\t\tfileInfo.name\n\t\t\t\t}</span>`,\n\t\t\t\tcallback: (result) => {\n\t\t\t\t\tif (result) {\n\t\t\t\t\t\tthis.deleteFileCallback(hash);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.deleteFileCallback(hash);\n\t\t}\n\t}\n\n\t/**\n\t * File change event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {object} data\n\t */\n\tchange(e, data) {\n\t\tthis.clearFilesInput();\n\t\tdata.files = this.filterValidFiles(data.files);\n\t\tdata.files = this.setFilesHash(data.files);\n\t\tif (data.files.length) {\n\t\t\tthis.generatePreviewElements(data.files, (element) => {\n\t\t\t\tthis.redraw();\n\t\t\t});\n\t\t}\n\t}\n\n\tclearFilesInput() {\n\t\tthis.files.forEach((file) => {\n\t\t\tif (file.file) {\n\t\t\t\tthis.deleteFile(file.hash, false);\n\t\t\t}\n\t\t});\n\t}\n\t/**\n\t * Generate and apply popover to preview\n\t *\n\t * @param {File} file\n\t * @param {string} template\n\t * @param {string} imageSrc\n\t * @returns {jQuery}\n\t */\n\taddPreviewPopover(file, template, imageSrc) {\n\t\tconst thisInstance = this;\n\t\tlet fileSize = '';\n\t\tconst fileInfo = this.getFileInfo(file.hash);\n\t\tif (typeof fileInfo.size !== 'undefined') {\n\t\t\tfileSize = `<div class=\"p-1 ml-1 bg-white border rounded small position-absolute\">${fileInfo.size}</div>`;\n\t\t}\n\t\tlet deleteBtn = '';\n\t\tif (!this.detailView) {\n\t\t\tdeleteBtn = `<button class=\"btn btn-sm btn-danger c-btn-collapsible js-multi-image__popover-btn-delete mb-1\" type=\"button\" data-hash=\"${\n\t\t\t\tfile.hash\n\t\t\t}\" data-js=\"click\" title=\"${app.translate('JS_DELETE')}\"><i class=\"fa fa-trash-alt\"></i></button>`;\n\t\t}\n\t\treturn $(template).popover({\n\t\t\tcontainer: thisInstance.elements.component,\n\t\t\ttitle: `<div class=\"u-text-ellipsis\"><i class=\"fa fa-image\"></i> ${file.name}</div>`,\n\t\t\thtml: true,\n\t\t\tsanitize: false,\n\t\t\ttrigger: 'focus',\n\t\t\tplacement: 'top',\n\t\t\tcontent: `<img src=\"${imageSrc}\" class=\"w-100 js-multi-image__popover-img c-multi-image__popover-img\" data-hash=\"${file.hash}\" data-js=\"click\"/>`,\n\t\t\ttemplate: `<div class=\"popover\" role=\"tooltip\">\n\t\t\t\t<div class=\"arrow\"></div>\n\t\t\t\t<h3 class=\"popover-header\"></h3>\n\t\t\t\t<div class=\"popover-body\"></div>\n\t\t\t\t<div class=\"text-right popover-footer js-multi-image__popover-actions\">\n\t\t\t\t\t${fileSize}\n\t\t\t\t\t${deleteBtn}\n\t\t\t\t\t<button class=\"btn btn-sm btn-success js-multi-image__popover-btn-download mb-1\" type=\"button\" data-hash=\"${\n\t\t\t\t\t\tfile.hash\n\t\t\t\t\t}\" data-js=\"click\"><i class=\"fa fa-download\" title=\"${app.translate(\n\t\t\t\t'JS_DOWNLOAD'\n\t\t\t)}\"></i> <span class=\"c-btn-collapsible__text\"></span></button>\n\t\t\t\t\t<button class=\"btn btn-sm btn-primary js-multi-image__popover-btn-zoom mb-1 mr-1\" type=\"button\" data-hash=\"${\n\t\t\t\t\t\tfile.hash\n\t\t\t\t\t}\" data-js=\"click\"><i class=\"fa fa-search-plus\" title=\"${app.translate(\n\t\t\t\t'JS_ZOOM_IN'\n\t\t\t)}\"></i> <span class=\"c-btn-collapsible__text\"></span></button>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t});\n\t}\n\n\t/**\n\t * Remove preview popover\n\t *\n\t * @param {String} hash\n\t */\n\tremovePreviewPopover(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tif (typeof fileInfo.previewElement !== 'undefined') {\n\t\t\tfileInfo.previewElement.popover('dispose');\n\t\t}\n\t}\n\n\t/**\n\t * Hide popovers when user starts moving file preview\n\t *\n\t * @param {Event} e\n\t * @param {Object} ui\n\t */\n\tsortOver(e, ui) {\n\t\tthis.elements.result.find('.js-multi-image__preview').popover('hide');\n\t}\n\n\t/**\n\t * Update file position according to elements order\n\t *\n\t * @param {Event} e\n\t * @param {Object} ui\n\t */\n\tsortStop(e, ui) {\n\t\tconst actualElements = this.elements.result.find('.js-multi-image__preview').toArray();\n\t\tthis.files = actualElements.map((element) => {\n\t\t\tfor (let i = 0, len = this.files.length; i < len; i++) {\n\t\t\t\tconst elementHash = $(element).data('hash');\n\t\t\t\tif (this.files[i].hash === elementHash) {\n\t\t\t\t\treturn this.files[i];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.redraw();\n\t}\n\n\t/**\n\t * Redraw view according to in-memory positions\n\t */\n\tredraw() {\n\t\tthis.files.forEach((file) => {\n\t\t\tthis.elements.result.append(file.previewElement);\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Enable drag and drop files repositioning\n\t */\n\tenableDragNDrop() {\n\t\tthis.elements.result\n\t\t\t.sortable({\n\t\t\t\thandle: '.js-multi-image__preview-img',\n\t\t\t\titems: '.js-multi-image__preview',\n\t\t\t\tover: this.sortOver.bind(this),\n\t\t\t\tstop: this.sortStop.bind(this)\n\t\t\t})\n\t\t\t.disableSelection()\n\t\t\t.on('mousedown', '.js-multi-image__preview-img', function (e) {\n\t\t\t\tthis.focus(); // focus to show popover\n\t\t\t});\n\t}\n\tgeneratePreviewElements(files, callback) {\n\t\tfiles.forEach((file) => {\n\t\t\tif (file instanceof File) {\n\t\t\t\tlet template = $(this.generatePreviewFromFile(file));\n\t\t\t\tfile.preview = template;\n\t\t\t\tthis.addFileInfoProperty(file.hash, 'previewElement', file.preview);\n\t\t\t\tcallback(template);\n\t\t\t} else {\n\t\t\t\tthis.generatePreviewFromValue(file, (template, imageSrc) => {\n\t\t\t\t\tfile.preview = this.addPreviewPopover(file, template, imageSrc);\n\t\t\t\t\tthis.addFileInfoProperty(file.hash, 'previewElement', file.preview);\n\t\t\t\t\tcallback(file.preview);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Generate preview of image as html string\n\t *\n\t * @param {File} file\n\t * @param {function} callback\n\t */\n\tgeneratePreviewFromFile(file, callback) {\n\t\treturn `<div class=\"mr-1 js-multi-image__preview d-none\" id=\"js-multi-image__preview-hash-${\n\t\t\tfile.hash\n\t\t}\" data-hash=\"${file.hash}\" data-js=\"container|click\">\n\t\t\t<button class=\"btn btn-sm btn-danger c-btn-collapsible js-multi-image__popover-btn-delete mr-1\" type=\"button\" data-hash=\"${\n\t\t\t\tfile.hash\n\t\t\t}\" data-js=\"click\" title=\"${app.translate('JS_DELETE')}\"><i class=\"fa fa-trash-alt\"></i></button>${file.name}\n\t\t</div>`;\n\t}\n\n\t/**\n\t * Generate preview of image as html string from existing values\n\t *\n\t * @param {File} file\n\t * @param {function} callback\n\t */\n\tgeneratePreviewFromValue(file, callback) {\n\t\tcallback(\n\t\t\t`<div class=\"d-inline-block mr-1 js-multi-image__preview\" id=\"js-multi-image__preview-hash-${file.hash}\" data-hash=\"${file.hash}\" data-js=\"container|click\">\n\t\t\t\t<div class=\"img-thumbnail js-multi-image__preview-img c-multi-image__preview-img\" data-hash=\"${file.hash}\" data-js=\"drag\" style=\"background-image:url(${file.imageSrc})\" tabindex=\"0\" title=\"${file.name}\"></div>\n\t\t</div>`,\n\t\t\tfile.imageSrc\n\t\t);\n\t}\n\n\t/**\n\t * Load files that were in valueInput as json string\n\t */\n\tloadExistingFiles() {\n\t\tthis.files = this.files\n\t\t\t.map((file) => {\n\t\t\t\tfile.hash = this.generateRandomHash(CONFIG.userId);\n\t\t\t\treturn file;\n\t\t\t})\n\t\t\t.slice(0, this.options.limit);\n\t\tthis.generatePreviewElements(this.files, (element) => {\n\t\t\tthis.elements.result.append(element);\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Generate carousel for all files in large preview\n\t *\n\t * @param {String} hash\n\t */\n\tgenerateCarousel(hash) {\n\t\tif (this.files.length <= 1) {\n\t\t\tconst fileInfo = this.getFileInfo(hash);\n\t\t\treturn `<img class=\"d-block w-100\" src=\"${fileInfo.imageSrc}\">`;\n\t\t}\n\t\tlet template = `<div id=\"carousel-${hash}\" class=\"carousel slide c-carousel\" data-ride=\"carousel\" data-js=\"container\">\n\t\t  <div class=\"carousel-inner\">`;\n\t\tthis.files.forEach((file) => {\n\t\t\ttemplate += `<div class=\"carousel-item c-carousel__item`;\n\t\t\tif (file.hash === hash) {\n\t\t\t\ttemplate += ` active`;\n\t\t\t}\n\t\t\ttemplate += `\" data-hash=\"${file.hash}\">\n\t\t      <img class=\"d-block w-100 c-carousel__image\" src=\"${file.imageSrc}\">\n\t\t    </div>`;\n\t\t});\n\t\ttemplate += `<a class=\"carousel-control-prev c-carousel__prevnext-btn c-carousel__prev-btn\" href=\"#carousel-${hash}\" role=\"button\" data-slide=\"prev\" data-js=\"click\">\n\t\t    <span class=\"fas fa-caret-left fa-2x c-carousel__prev-icon mr-1\" aria-hidden=\"true\"></span>\n\t\t  </a>\n\t\t  <a class=\"carousel-control-next c-carousel__prevnext-btn c-carousel__next-btn\" href=\"#carousel-${hash}\" role=\"button\" data-slide=\"next\" data-js=\"click\">\n\t\t    <span class=\"fas fa-caret-right fa-2x c-carousel__next-icon ml-1\" aria-hidden=\"true\"></span>\n\t\t  </a>\n\t\t</div>`;\n\t\treturn template;\n\t}\n\n\t/**\n\t * generate random hash\n\t * @returns {string}\n\t */\n\tgenerateRandomHash(prefix = '') {\n\t\tprefix = prefix.toString();\n\t\tconst hash =\n\t\t\tMath.random().toString(36).substr(2, 10) +\n\t\t\tMath.random().toString(36).substr(2, 10) +\n\t\t\tnew Date().valueOf() +\n\t\t\tMath.random().toString(36).substr(2, 6);\n\t\treturn prefix ? prefix + hash : hash;\n\t}\n}\n"],"names":["element","elements","options","showCarousel","detailView","fileInput","find","eq","length","component","form","closest","addButton","values","progressBar","progress","result","fieldInfo","data","formats","limit","files","JSON","parse","val","fileupload","dataType","replaceFileInput","autoUpload","add","bind","change","fail","uploadError","on","thisInstance","zoomPreview","$","e","preventDefault","download","deleteFile","loadExistingFiles","trigger","hash","i","len","file","app","errorLog","showNotify","text","translate","type","propertyName","value","getFileInfo","fileInfo","jqXHR","responseJSON","Fields","MultiImage","currentFileUploads","attach","Array","isArray","response","forEach","fileAttach","App","error","name","updateFormValues","map","key","size","stringify","formValues","format","valid","join","showLimitError","filter","validateFile","addedFiles","generateRandomHash","CONFIG","userId","push","imageSrc","parseInt","loaded","total","css","width","setTimeout","addClass","removeClass","substr","toLowerCase","downloadFile","downloadBase64","link","document","createElement","body","appendChild","href","click","removeChild","location","replace","imageUrl","split","titleTemplate","bootboxOptions","backdrop","onEscape","title","message","buttons","generateCarousel","Delete","label","className","callback","Download","Close","bootbox","dialog","relatedTarget","html","previewElement","popover","remove","showConfirmation","confirm","deleteFileCallback","clearFilesInput","filterValidFiles","setFilesHash","generatePreviewElements","redraw","template","fileSize","deleteBtn","container","sanitize","placement","content","actualElements","toArray","elementHash","append","sortable","handle","items","over","sortOver","stop","sortStop","disableSelection","focus","generatePreviewFromFile","preview","addFileInfoProperty","generatePreviewFromValue","addPreviewPopover","slice","prefix","toString","Math","random","valueOf"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IASC,oBAAYA,OAAZ,CAAqB,iCACpB,iBAAqB,IAArB,CACA,KAAKC,QAAL,CAAgB,EAFI,CAGpB,KAAKC,OAAL,CAAe,CACdC,eADc,CAHK,CAMpB,KAAKC,UAAL,GANoB,CAOpB,KAAKH,QAAL,CAAcI,SAAd,CAA0BL,QAAQM,IAAR,CAAa,uBAAb,EAAsCC,EAAtC,CAAyC,CAAzC,CAPN,CAQmB,CAAnC,QAAKN,QAAL,CAAcI,SAAd,CAAwBG,MARR,GASnB,KAAKJ,UAAL,GATmB,EAWpB,KAAKH,QAAL,CAAcQ,SAAd,CAA0BT,QAAQO,EAAR,CAAW,CAAX,CAXN,CAYpB,KAAKN,QAAL,CAAcS,IAAd,CAAqBV,QAAQW,OAAR,CAAgB,MAAhB,EAAwBJ,EAAxB,CAA2B,CAA3B,CAZD,CAapB,KAAKN,QAAL,CAAcW,SAAd,CAA0B,KAAKX,QAAL,CAAcQ,SAAd,CAAwBH,IAAxB,CAA6B,2BAA7B,EAA0DC,EAA1D,CAA6D,CAA7D,CAbN,CAcpB,KAAKN,QAAL,CAAcY,MAAd,CAAuB,KAAKZ,QAAL,CAAcQ,SAAd,CAAwBH,IAAxB,CAA6B,yBAA7B,EAAwDC,EAAxD,CAA2D,CAA3D,CAdH,CAepB,KAAKN,QAAL,CAAca,WAAd,CAA4B,KAAKb,QAAL,CAAcQ,SAAd,CAAwBH,IAAxB,CAA6B,+BAA7B,EAA8DC,EAA9D,CAAiE,CAAjE,CAfR,CAgBpB,KAAKN,QAAL,CAAcc,QAAd,CAAyB,KAAKd,QAAL,CAAcQ,SAAd,CAAwBH,IAAxB,CAA6B,2BAA7B,EAA0DC,EAA1D,CAA6D,CAA7D,CAhBL,CAiBpB,KAAKN,QAAL,CAAce,MAAd,CAAuB,KAAKf,QAAL,CAAcQ,SAAd,CAAwBH,IAAxB,CAA6B,yBAA7B,EAAwDC,EAAxD,CAA2D,CAA3D,CAjBH,CAkBpB,KAAKU,SAAL,CAAiB,KAAKhB,QAAL,CAAcY,MAAd,CAAqBK,IAArB,CAA0B,WAA1B,CAlBG,CAmBpB,KAAKhB,OAAL,CAAaiB,OAAb,CAAuB,KAAKF,SAAL,CAAeE,OAnBlB,CAoBpB,KAAKjB,OAAL,CAAakB,KAAb,CAAqB,KAAKH,SAAL,CAAeG,KApBhB,CAwBnB,KAAKC,KAxBc,CAqBf,KAAKjB,UArBU,CAwBN,KAAKH,QAAL,CAAcY,MAAd,CAAqBK,IAArB,CAA0B,OAA1B,CAxBM,CAsBNI,KAAKC,KAAL,CAAW,KAAKtB,QAAL,CAAcY,MAAd,CAAqBW,GAArB,EAAX,CAtBM,CA0Bf,KAAKpB,UA1BU,EA2BnB,KAAKH,QAAL,CAAcI,SAAd,CAAwBoB,UAAxB,CAAmC,CAClCC,SAAU,MADwB,CAElCC,mBAFkC,CAGlCtB,UAAW,KAAKA,SAHkB,CAIlCuB,aAJkC,CAKlCC,IAAK,KAAKA,GAAL,CAASC,IAAT,CAAc,IAAd,CAL6B,CAMlCC,OAAQ,KAAKA,MAAL,CAAYD,IAAZ,CAAiB,IAAjB,CAN0B,CAOlCE,KAAM,KAAKC,WAAL,CAAiBH,IAAjB,CAAsB,IAAtB,CAP4B,CAAnC,CA3BmB,CAqCpB,KAAK7B,QAAL,CAAcQ,SAAd,CAAwByB,EAAxB,CAA2B,OAA3B,CAAoC,8BAApC,CAAoE,UAAa,CAChFC,aAAaC,WAAb,CAAyBC,EAAE,IAAF,EAAQnB,IAAR,CAAa,MAAb,CAAzB,EACA,CAFD,CArCoB,CAwCpB,KAAKjB,QAAL,CAAcQ,SAAd,CAAwByB,EAAxB,CAA2B,OAA3B,CAAoC,mCAApC,CAAyE,SAAUI,CAAV,CAAa,CACrFA,EAAEC,cAAF,EADqF,CAErFJ,aAAaC,WAAb,CAAyBC,EAAE,IAAF,EAAQnB,IAAR,CAAa,MAAb,CAAzB,EACA,CAHD,CAxCoB,CA4CpB,KAAKjB,QAAL,CAAcQ,SAAd,CAAwByB,EAAxB,CAA2B,OAA3B,CAAoC,uCAApC,CAA6E,SAAUI,CAAV,CAAa,CACzFA,EAAEC,cAAF,EADyF,CAEzFJ,aAAaK,QAAb,CAAsBH,EAAE,IAAF,EAAQnB,IAAR,CAAa,MAAb,CAAtB,EACA,CAHD,CA5CoB,CAgDf,KAAKd,UAhDU,EAiDnB,KAAKH,QAAL,CAAcQ,SAAd,CAAwByB,EAAxB,CAA2B,OAA3B,CAAoC,qCAApC,CAA2E,SAAUI,CAAV,CAAa,CACvFA,EAAEC,cAAF,EADuF,CAEvFJ,aAAaM,UAAb,CAAwBJ,EAAE,IAAF,EAAQnB,IAAR,CAAa,MAAb,CAAxB,EACA,CAHD,CAjDmB,CAsDpB,KAAKwB,iBAAL,GACA,CAED;;;;uFAKeJ,EAAG,CACjBA,EAAEC,cAAF,EADiB,CAEjB,KAAKtC,QAAL,CAAcI,SAAd,CAAwBsC,OAAxB,CAAgC,OAAhC,EACA,CAED;;;;;oDAMYC,KAAM,CACjB,IAAK,QAAA,CAAIC,EAAI,CAAR,CAAWC,IAAM,KAAKzB,KAAL,CAAWb,MAAjC,CAAyCqC,EAAIC,GAA7C,CAAkDD,GAAlD,CAEC,GADME,IACN,CADa,KAAK1B,KAAL,CAAWwB,CAAX,CACb,CAAIE,KAAKH,IAAL,GAAcA,IAAlB,CACC,WAAA,CAGFI,IAAIC,QAAJ,WAAsBL,IAAtB,iBAPiB,CAQjBI,IAAIE,UAAJ,CAAe,CACdC,KAAMH,IAAII,SAAJ,CAAc,sBAAd,QAA6CR,IAA7C,KADQ,CAEdS,KAAM,OAFQ,CAAf,EAIA,CAED;;;;;;;oEAQoBT,KAAMU,aAAcC,MAAO,CAC9C,aAAiB,KAAKC,WAAL,CAAiBZ,IAAjB,CAAjB,CAEA,gBADSU,YAAT,EAAyBC,KACzB,CAAOE,QACP,CAED;;;;;oDAMYnB,EAAGpB,KAAM,gBACpB8B,IAAIC,QAAJ,CAAa,oBAAb,CADoB,UAAA,CAEK/B,IAFL,CAEZwC,KAFY,CAELrC,KAFK,CAEKH,IAFL,CAELG,KAFK,CAGpB,GAAkC,WAA9B,eAAasC,YAAb,EAAoE,IAAvB,SAAMA,YAAvD,CAEC,WADIC,MAAJ,CAAWC,UAAX,CAAsBC,kBAAtB,EACA,CAAOd,IAAIE,UAAJ,CAAe,CACrBC,KAAMH,IAAII,SAAJ,CAAc,sBAAd,CADe,CAErBC,KAAM,OAFe,CAAf,CAAP,CAKD,aAAiBK,MAAMC,YAAvB,CACA;AAXoB,OAaQ,WAA3B,kBAAgB3C,MAAhB,EACkC,WAAlC,kBAAgBA,MAAT,CAAgB+C,MADvB,EAEAC,MAAMC,OAAN,CAAcC,SAASlD,MAAT,CAAgB+C,MAA9B,CAfmB,EAiBnBG,SAASlD,MAAT,CAAgB+C,MAAhB,CAAuBI,OAAvB,CAA+B,SAACC,UAAD,CAAgB,CAC9CC,IAAIT,MAAJ,CAAWC,UAAX,CAAsBC,kBAAtB,EAD8C,CAE9C,MAAKrB,UAAL,CAAgB2B,WAAWxB,IAA3B,IAF8C,CAGd,QAA5B,oBAAkB0B,KAHwB,CAI7CtB,IAAIE,UAAJ,CAAe,CACdC,KAAMiB,WAAWE,KAAX,OAAwBF,WAAWG,IAAnC,KADQ,CAEdlB,KAAM,OAFQ,CAAf,CAJ6C,CAS7CL,IAAIE,UAAJ,CAAe,CACdC,KAAMH,IAAII,SAAJ,CAAc,sBAAd,QAA6CgB,WAAWG,IAAxD,KADQ,CAEdlB,KAAM,OAFQ,CAAf,EAKD,CAdD,CAjBmB,WAgCdmB,gBAAL,EAhCmB;AAoCpBnD,MAAM8C,OAAN,CAAc,SAACpB,IAAD,CAAU,CACvBsB,IAAIT,MAAJ,CAAWC,UAAX,CAAsBC,kBAAtB,EADuB,CAEvB,MAAKrB,UAAL,CAAgBM,KAAKH,IAArB,IAFuB,CAGvBI,IAAIE,UAAJ,CAAe,CACdC,KAAMH,IAAII,SAAJ,CAAc,sBAAd,QAA6CL,KAAKwB,IAAlD,KADQ,CAEdlB,KAAM,OAFQ,CAAf,EAIA,CAPD,CApCoB,CA4CpB,KAAKmB,gBAAL,EA5CoB,CA6CpB,CAED;;+DAGmB,CAClB,eAAmB,KAAKnD,KAAL,CAAWoD,GAAX,CAAe,SAAC1B,IAAD,CAAU,CAC3C,OAAO,CAAE2B,IAAK3B,KAAK2B,GAAZ,CAAiBH,KAAMxB,KAAKwB,IAA5B,CAAkCI,KAAM5B,KAAK4B,IAA7C,CACP,CAFkB,CAAnB,CAGA,KAAK1E,QAAL,CAAcY,MAAd,CAAqBW,GAArB,CAAyBF,KAAKsD,SAAL,CAAeC,UAAf,CAAzB,EACA,CAED;;;;;sDAMa9B,KAAM,CAClB,YAAA,CAcA,YAbK7C,OAAL,CAAaiB,OAAb,CAAqBgD,OAArB,CAA6B,SAACW,MAAD,CAAY,CACpC/B,KAAKM,IAAL,GAAc,SAAWyB,MADW,GAEvCC,QAFuC,EAIxC,CAJD,CAaA,CARKA,KAQL,EAPC/B,IAAIE,UAAJ,CAAe,CACdC,KAASH,IAAII,SAAJ,CAAc,sBAAd,CAAT,MAAmDL,KAAKwB,IAAxD,OAAkEvB,IAAII,SAAJ,CACjE,yBADiE,CAAlE,OAEO,KAAKlD,OAAL,CAAaiB,OAAb,CAAqB6D,IAArB,CAA0B,IAA1B,CAFP,IADc,CAId3B,KAAM,OAJQ,CAAf,CAOD,CAAO0B,KACP,CAED;;2DAGiB,CAChB,KAAK9E,QAAL,CAAcI,SAAd,CAAwBmB,GAAxB,CAA4B,EAA5B,CADgB,CAEhBwB,IAAIE,UAAJ,CAAe,CACdC,KAASH,IAAII,SAAJ,CAAc,eAAd,CAAT,MAA4C,KAAKlD,OAAL,CAAakB,KAAzD,IADc,CAEdiC,KAAM,OAFQ,CAAf,EAIA,CAED;;;;;8DAMiBhC,MAAO,8BACbb,MAAN,CAAe,KAAKa,KAAL,CAAWb,MAA1B,CAAmC,KAAKN,OAAL,CAAakB,KAD7B,EAEtB,KAAK6D,cAAL,EAFsB,CAGf,EAHe,EAKhB5D,MAAM6D,MAAN,CAAa,SAACnC,IAAD,CAAU,CAC7B,cAAYoC,YAAL,CAAkBpC,IAAlB,CACP,CAFM,CAGP,CAED;;;;sDAKa1B,MAAO,CAEnB,YAAA,CADM+D,WAAa,EACnB,CAASvC,EAAI,CAAb,CAAgBC,IAAMzB,MAAMb,MAA5B,CAAoCqC,EAAIC,GAAxC,CAA6CD,GAA7C,CAEC,GADME,IACN,CADa1B,MAAMwB,CAAN,CACb,CAAyB,WAArB,cAAYD,IAAhB,CACC,GAAI,KAAKvB,KAAL,CAAWb,MAAX,CAAoB,KAAKN,OAAL,CAAakB,KAArC,CACC2B,KAAKH,IAAL,CAAY,KAAKyC,kBAAL,CAAwBC,OAAOC,MAA/B,CADb,CAEC,KAAKlE,KAAL,CAAWmE,IAAX,CAAgB,CAAE5C,KAAMG,KAAKH,IAAb,CAAmB6C,SAAU1C,KAAK0C,QAAlC,CAA4ClB,KAAMxB,KAAKwB,IAAvD,CAA6DxB,SAA7D,CAAhB,CAFD,CAGCqC,WAAWI,IAAX,CAAgBzC,IAAhB,CAHD,kBAKMkC,cAAL,EACA,CAAOG,UAAP,CAIH,iBACA,CAED;;;;;qCAMa,EAIb;;;;;oDAMY9C,EAAGpB,KAAM,iBACdH,SAAW2E,SAAsC,GAA7B,EAACxE,KAAKyE,MAAL,CAAczE,KAAK0E,KAApB,CAAT,CAA2C,EAA3C,CADG,CAEpB,KAAK3F,QAAL,CAAca,WAAd,CAA0B+E,GAA1B,CAA8B,CAAEC,MAAO/E,SAAW,GAApB,CAA9B,CAFoB,CAGH,GAAb,WAHgB,CAInBgF,WAAW,UAAM,CAChB,OAAK9F,QAAL,CAAcc,QAAd,CAAuBiF,QAAvB,CAAgC,QAAhC,CADgB,CAEhB,OAAK/F,QAAL,CAAca,WAAd,CAA0B+E,GAA1B,CAA8B,CAAEC,MAAO,IAAT,CAA9B,EACA,CAHD,CAGG,GAHH,CAJmB,CASnB,KAAK7F,QAAL,CAAcc,QAAd,CAAuBkF,WAAvB,CAAmC,QAAnC,EAED,CAED;;;;+CAKY,CACX,KAAKhG,QAAL,CAAcQ,SAAd,CAAwBuF,QAAxB,CAAiC,4BAAjC,EACA,CAED;;;iDAIa,CACZ,KAAK/F,QAAL,CAAcQ,SAAd,CAAwBwF,WAAxB,CAAoC,4BAApC,EACA,CAED;;;;8CAKSrD,KAAM,CACd,aAAiB,KAAKY,WAAL,CAAiBZ,IAAjB,CAAjB,CADc,OAEuC,UAAjD,YAAS6C,QAAT,CAAkBS,MAAlB,CAAyB,CAAzB,CAA4B,CAA5B,EAA+BC,WAA/B,EAFU,CAGN,KAAKC,YAAL,CAAkBxD,IAAlB,CAHM,CAKN,KAAKyD,cAAL,CAAoBzD,IAApB,CAER,CAED;;;sDAIaA,KAAM,cACD,KAAKY,WAAL,CAAiBZ,IAAjB,CADC,CAEZ0D,KAAOC,SAASC,aAAT,CAAuB,GAAvB,CAFK,CAGlBnE,EAAEiE,IAAF,EAAQT,GAAR,CAAY,SAAZ,CAAuB,MAAvB,CAHkB,CAIW,QAAzB,cAAYrD,QAJE,EAKjB+D,SAASE,IAAT,CAAcC,WAAd,CAA0BJ,IAA1B,CALiB,CAMjBA,KAAK9D,QAAL,CAAgBiB,SAASc,IANR,CAOjB+B,KAAKK,IAAL,CAAYlD,SAASgC,QAPJ,CAQjBa,KAAKM,KAAL,EARiB,CASjBL,SAASE,IAAT,CAAcI,WAAd,CAA0BP,IAA1B,CATiB,EAWjBQ,SAASC,OAAT,CAAiBtD,SAASgC,QAA1B,EAED,CAED;;;;0DAKe7C,KAAM,cACH,KAAKY,WAAL,CAAiBZ,IAAjB,CADG,CAEdoE,SACL,0CAA0CvD,SAASc,IAAnD,YAAoEd,SAASgC,QAAT,CAAkBwB,KAAlB,CAAwB,GAAxB,EAA6B,CAA7B,CAHjD,CAIdX,KAAOC,SAASC,aAAT,CAAuB,GAAvB,CAJO,CAKpBnE,EAAEiE,IAAF,EAAQT,GAAR,CAAY,SAAZ,CAAuB,MAAvB,CALoB,CAMS,QAAzB,cAAYrD,QANI,EAOnB+D,SAASE,IAAT,CAAcC,WAAd,CAA0BJ,IAA1B,CAPmB,CAQnBA,KAAK9D,QAAL,CAAgBiB,SAASc,IARN,CASnB+B,KAAKK,IAAL,CAAYK,QATO,CAUnBV,KAAKM,KAAL,EAVmB,CAWnBL,SAASE,IAAT,CAAcI,WAAd,CAA0BP,IAA1B,CAXmB,EAanBQ,SAASC,OAAT,CAAiBC,QAAjB,EAED,CAED;;;;oDAKYpE,KAAM,iBACXT,aAAe,IADJ,CAEbsB,SAAW,KAAKD,WAAL,CAAiBZ,IAAjB,CAFE,CAGXsE,cAAgB,iDAAqCzD,SAASc,IAA9C,CAHL,CAIX4C,eAAiB,CACtBxC,KAAM,OADgB,CAEtByC,WAFsB,CAGtBC,WAHsB,CAItBC,iCAAkC1E,IAAlC,MAA2CsE,eAA3C,UAJsB,CAKtBK,qBAAsB9D,SAASgC,QAA/B,qBALsB,CAMtB+B,QAAS,EANa,CAJN,CAYb,KAAKtH,OAAL,CAAaC,YAZA,GAahBgH,eAAeI,OAAf,CAAyB,KAAKE,gBAAL,CAAsB7E,IAAtB,CAbT,EAeZ,KAAKxC,UAfO,GAgBhB+G,eAAeK,OAAf,CAAuBE,MAAvB,CAAgC,CAC/BC,yCAA0C3E,IAAII,SAAJ,CAAc,WAAd,CADX,CAE/BwE,UAAW,2BAFoB,CAG/BC,QAH+B,oBAGpB,CACV1F,aAAaM,UAAb,CAAwBgB,SAASb,IAAjC,EACA,CAL8B,CAhBhB,EAwBjBuE,eAAeK,OAAf,CAAuBM,QAAvB,CAAkC,CACjCH,0CAA2C3E,IAAII,SAAJ,CAAc,aAAd,CAA3C,SADiC,CAEjCwE,UAAW,4BAFsB,CAGjCC,QAHiC,oBAGtB,CACV1F,aAAaK,QAAb,CAAsBiB,SAASb,IAA/B,EACA,CALgC,CAxBjB,CA+BjBuE,eAAeK,OAAf,CAAuBO,KAAvB,CAA+B,CAC9BJ,uCAAwC3E,IAAII,SAAJ,CAAc,UAAd,CAAxC,SAD8B,CAE9BwE,UAAW,iBAFmB,CAG9BC,SAAU,mBAAM,EAHc,CA/Bd,CAoCjBG,QAAQC,MAAR,CAAed,cAAf,CApCiB,CAqCb,KAAKjH,OAAL,CAAaC,YArCA,EAsChBkC,eAAeO,IAAf,EAAuBV,EAAvB,CAA0B,kBAA1B,CAA8C,SAACI,CAAD,CAAO,CACpDmB,SAAW,OAAKD,WAAL,CAAiBnB,EAAEC,EAAE4F,aAAJ,EAAmBhH,IAAnB,CAAwB,MAAxB,CAAjB,CADyC,CAEpDmB,oBAAoBO,IAApB,EAA4BuF,IAA5B,CAAiCjB,eAAjC,EACA,CAHD,EAKD,CAED;;;;kEAKmBtE,KAAM,CACxB,aAAiB,KAAKY,WAAL,CAAiBZ,IAAjB,CAAjB,CACIa,SAAS2E,cAFW,EAGvB3E,SAAS2E,cAAT,CAAwBC,OAAxB,CAAgC,SAAhC,EAA2CC,MAA3C,EAHuB,CAKxB,KAAKjH,KAAL,CAAa,KAAKA,KAAL,CAAW6D,MAAX,CAAkB,SAACnC,IAAD,cAAeH,IAAL,GAAca,SAASb,IAAjC,CAAlB,CALW,CAMxB,KAAK4B,gBAAL,GACA,CAED;;;;;;kDAOW5B,KAA+B,iBAAzB2F,gBAAyB,4DACzC,GAAIA,gBAAJ,CAAsB,CACrB,aAAiB,KAAK/E,WAAL,CAAiBZ,IAAjB,CAAjB,CACAoF,QAAQQ,OAAR,CAAgB,CACflB,yCAA0CtE,IAAII,SAAJ,CAAc,gBAAd,CAD3B,CAEfmE,QAAYvE,IAAII,SAAJ,CAAc,6BAAd,CAAZ,oCACCK,SAASc,IADV,UAFe,CAKfsD,SAAU,kBAAC7G,MAAD,CAAY,CACjBA,MADiB,EAEpB,OAAKyH,kBAAL,CAAwB7F,IAAxB,EAED,CATc,CAAhB,EAWA,CAbD,UAcM6F,kBAAL,CAAwB7F,IAAxB,EAED,CAED;;;;;0CAMON,EAAGpB,KAAM,iBACf,KAAKwH,eAAL,EADe,CAEfxH,KAAKG,KAAL,CAAa,KAAKsH,gBAAL,CAAsBzH,KAAKG,KAA3B,CAFE,CAGfH,KAAKG,KAAL,CAAa,KAAKuH,YAAL,CAAkB1H,KAAKG,KAAvB,CAHE,CAIXH,KAAKG,KAAL,CAAWb,MAJA,EAKd,KAAKqI,uBAAL,CAA6B3H,KAAKG,KAAlC,CAAyC,UAAa,CACrD,OAAKyH,MAAL,GACA,CAFD,EAID,0DAEiB,iBACjB,KAAKzH,KAAL,CAAW8C,OAAX,CAAmB,SAACpB,IAAD,CAAU,CACxBA,KAAKA,IADmB,EAE3B,OAAKN,UAAL,CAAgBM,KAAKH,IAArB,KAED,CAJD,EAKA,CACD;;;;;;;gEAQkBG,KAAMgG,SAAUtD,SAAU,kBACtB,IADsB,CAEvCuD,SAAW,EAF4B,CAGrCvF,SAAW,KAAKD,WAAL,CAAiBT,KAAKH,IAAtB,CAH0B,CAId,WAAzB,kBAAgB+B,IAJuB,GAK1CqE,kFAAoFvF,SAASkB,IAA7F,SAL0C,EAO3C,cAAgB,EAAhB,CAMA,YALUvE,UAKV,GAJC6I,sIACClG,KAAKH,IADN,6BAE4BI,IAAII,SAAJ,CAAc,WAAd,CAF5B,6CAID,EAAOf,EAAE0G,QAAF,EAAYV,OAAZ,CAAoB,CAC1Ba,UAAW/G,aAAalC,QAAb,CAAsBQ,SADP,CAE1B6G,kEAAmEvE,KAAKwB,IAAxE,SAF0B,CAG1B4D,OAH0B,CAI1BgB,WAJ0B,CAK1BxG,QAAS,OALiB,CAM1ByG,UAAW,KANe,CAO1BC,qBAAsB5D,QAAtB,sFAAmH1C,KAAKH,IAAxH,sBAP0B,CAQ1BmG,oQAKIC,QALJ,gBAMIC,SANJ,0HAQGlG,KAAKH,IARR,uDASwDI,IAAII,SAAJ,CACvD,aADuD,CATxD,wLAaGL,KAAKH,IAbR,0DAc2DI,IAAII,SAAJ,CAC1D,YAD0D,CAd3D,8FAR0B,CAApB,CA4BP,CAED;;;;sEAKqBR,KAAM,CAC1B,aAAiB,KAAKY,WAAL,CAAiBZ,IAAjB,CAAjB,CACuC,WAAnC,kBAAgBwF,cAFM,EAGzB3E,SAAS2E,cAAT,CAAwBC,OAAxB,CAAgC,SAAhC,EAED,CAED;;;;;+CAMgB,CACf,KAAKpI,QAAL,CAAce,MAAd,CAAqBV,IAArB,CAA0B,0BAA1B,EAAsD+H,OAAtD,CAA8D,MAA9D,EACA,CAED;;;;;+CAMgB,iBACTiB,eAAiB,KAAKrJ,QAAL,CAAce,MAAd,CAAqBV,IAArB,CAA0B,0BAA1B,EAAsDiJ,OAAtD,EADR,CAEf,KAAKlI,KAAL,CAAaiI,eAAe7E,GAAf,CAAmB,SAACzE,OAAD,CAAa,CAC5C,IAAK,eAAA,CAAI6C,EAAI,CAAR,CAAWC,IAAM,OAAKzB,KAAL,CAAWb,MAAjC,CAAyCqC,EAAIC,GAA7C,CAAkDD,GAAlD,CAEC,GADM2G,WACN,CADoBnH,EAAErC,OAAF,EAAWkB,IAAX,CAAgB,MAAhB,CACpB,CAAI,OAAKG,KAAL,CAAWwB,CAAX,EAAcD,IAAd,GAAuB4G,WAA3B,CACC,cAAYnI,KAAL,CAAWwB,CAAX,CAGT,CAPY,CAFE,CAUf,KAAKiG,MAAL,GACA,CAED;;2CAGS,iBACR,KAAKzH,KAAL,CAAW8C,OAAX,CAAmB,SAACpB,IAAD,CAAU,CAC5B,OAAK9C,QAAL,CAAce,MAAd,CAAqByI,MAArB,CAA4B1G,KAAKqF,cAAjC,EACA,CAFD,CADQ,CAIR,KAAK5D,gBAAL,GACA,CAED;;6DAGkB,CACjB,KAAKvE,QAAL,CAAce,MAAd,CACE0I,QADF,CACW,CACTC,OAAQ,8BADC,CAETC,MAAO,0BAFE,CAGTC,KAAM,KAAKC,QAAL,CAAchI,IAAd,CAAmB,IAAnB,CAHG,CAITiI,KAAM,KAAKC,QAAL,CAAclI,IAAd,CAAmB,IAAnB,CAJG,CADX,EAOEmI,gBAPF,GAQE/H,EARF,CAQK,WARL,CAQkB,8BARlB,CAQkD,UAAa,CAC7D,KAAKgI,KAAL,GACA,CADc;AAThB,EAWA,yEACuB7I,MAAOwG,SAAU,kBACxCxG,MAAM8C,OAAN,CAAc,SAACpB,IAAD,CAAU,CACvB,GAAIA,oBAAJ,CAA0B,CACzB,aAAeV,EAAE,QAAK8H,uBAAL,CAA6BpH,IAA7B,CAAF,CAAf,CACAA,KAAKqH,OAAL,CAAerB,QAFU,CAGzB,QAAKsB,mBAAL,CAAyBtH,KAAKH,IAA9B,CAAoC,gBAApC,CAAsDG,KAAKqH,OAA3D,CAHyB,CAIzBvC,SAASkB,QAAT,EACA,CALD,aAMMuB,wBAAL,CAA8BvH,IAA9B,CAAoC,SAACgG,QAAD,CAAWtD,QAAX,CAAwB,CAC3D1C,KAAKqH,OAAL,CAAe,QAAKG,iBAAL,CAAuBxH,IAAvB,CAA6BgG,QAA7B,CAAuCtD,QAAvC,CAD4C,CAE3D,QAAK4E,mBAAL,CAAyBtH,KAAKH,IAA9B,CAAoC,gBAApC,CAAsDG,KAAKqH,OAA3D,CAF2D,CAG3DvC,SAAS9E,KAAKqH,OAAd,EACA,CAJD,EAMD,CAbD,EAcA,CAED;;;;;4EAMwBrH,KAAgB,CACvC,4FACCA,KAAKH,IADN,iBAEgBG,KAAKH,IAFrB,iKAIEG,KAAKH,IAJP,6BAK6BI,IAAII,SAAJ,CAAc,WAAd,CAL7B,8CAKoGL,KAAKwB,IALzG,eAOA,CAED;;;;;8EAMyBxB,KAAM8E,SAAU,CACxCA,sGAC8F9E,KAAKH,IADnG,iBACuHG,KAAKH,IAD5H,uIAEiGG,KAAKH,IAFtG,iDAE0JG,KAAK0C,QAF/J,2BAEiM1C,KAAKwB,IAFtM,wBAICxB,KAAK0C,QAJN,EAMA,CAED;;iEAGoB,kBACnB,KAAKpE,KAAL,CAAa,KAAKA,KAAL,CACXoD,GADW,CACP,SAAC1B,IAAD,CAAU,CAEd,YADKH,IAAL,CAAY,QAAKyC,kBAAL,CAAwBC,OAAOC,MAA/B,CACZ,CAAOxC,IACP,CAJW,EAKXyH,KALW,CAKL,CALK,CAKF,KAAKtK,OAAL,CAAakB,KALX,CADM,CAOnB,KAAKyH,uBAAL,CAA6B,KAAKxH,KAAlC,CAAyC,SAACrB,OAAD,CAAa,CACrD,QAAKC,QAAL,CAAce,MAAd,CAAqByI,MAArB,CAA4BzJ,OAA5B,EACA,CAFD,CAPmB,CAUnB,KAAKwE,gBAAL,GACA,CAED;;;;8DAKiB5B,KAAM,CACtB,GAAyB,CAArB,OAAKvB,KAAL,CAAWb,MAAf,CAA4B,CAC3B,aAAiB,KAAKgD,WAAL,CAAiBZ,IAAjB,CAAjB,CACA,0CAA0Ca,SAASgC,QAAnD,KACA,CACD,kCAAoC7C,IAAhC,oHAAJ,CAkBA,YAhBKvB,KAAL,CAAW8C,OAAX,CAAmB,SAACpB,IAAD,CAAU,CAC5BgG,sDAD4B,CAExBhG,KAAKH,IAAL,GAAcA,IAFU,GAG3BmG,mBAH2B,EAK5BA,0BAA4BhG,KAAKH,IAAjC,oEACyDG,KAAK0C,QAD9D,sBAGA,CARD,CAgBA,CAPAsD,4GAA8GnG,IAA9G,8QAGmGA,IAHnG,mLAOA,CAAOmG,QACP,CAED;;;mEAIgC,WAAA,wDAAJ,EAAI,CAC/B0B,OAASA,OAAOC,QAAP,EADsB,CAE/B,SACCC,KAAKC,MAAL,GAAcF,QAAd,CAAuB,EAAvB,EAA2BxE,MAA3B,CAAkC,CAAlC,CAAqC,EAArC,EACAyE,KAAKC,MAAL,GAAcF,QAAd,CAAuB,EAAvB,EAA2BxE,MAA3B,CAAkC,CAAlC,CAAqC,EAArC,CADA,CAEA,QAAA,GAAW2E,OAAX,EAFA,CAGAF,KAAKC,MAAL,GAAcF,QAAd,CAAuB,EAAvB,EAA2BxE,MAA3B,CAAkC,CAAlC,CAAqC,CAArC,CAJD,CAKA,cAAgBuE,OAAS7H,IAAlB,CAAyBA,IAChC"}