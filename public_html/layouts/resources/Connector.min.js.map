{"version":3,"file":"Connector.min.js","sources":["Connector.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\nvar AppConnector = {\n\t/**\n\t * Sends a pjax request (push state +ajax)\n\t * The function is deferred. it will be resolved on success and error on failure\n\t *  Success - if request is success it will send you data that it recieved\n\t *  error - it will send two parameters first gives string regarding error\n\t *                   Second gives you error object if exists\n\t *\n\t *  @return - deferred promise\n\t */\n\trequestPjax: function (params) {\n\t\treturn AppConnector._request(params, true);\n\t},\n\n\t/**\n\t *  Sends ajax request to the specified url.\n\t *  The function is deferred. it will be resolved on success and error on failure\n\t *  Success - if request is success it will send you data that it recieved\n\t *  error - it will send two parameters first gives string regarding error\n\t *                   Second gives you error object if exists\n\t *\n\t *  @return - deferred promise\n\t */\n\trequest: function (params, rawData) {\n\t\treturn AppConnector._request(params, false, rawData);\n\t},\n\n\t_request: function (params, pjaxMode, rawData) {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tif (typeof rawData === 'undefined') {\n\t\t\trawData = false;\n\t\t}\n\t\tif (typeof pjaxMode === 'undefined') {\n\t\t\tpjaxMode = false;\n\t\t}\n\t\tif (typeof params === 'undefined') {\n\t\t\tparams = {};\n\t\t}\n\t\tvar fullUrl = '';\n\t\t//caller has send only data\n\t\tif (typeof params.data === 'undefined' || rawData) {\n\t\t\tif (typeof params === 'string') {\n\t\t\t\tvar callerParams = (fullUrl = params);\n\t\t\t\tvar index = callerParams.indexOf('?');\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tvar subStr = callerParams.substr(0, index + 1); //need to replace only \"index.php?\" or \"?\"\n\t\t\t\t\tcallerParams = callerParams.replace(subStr, '');\n\t\t\t\t}\n\t\t\t\tparams = { type: 'GET' };\n\t\t\t} else {\n\t\t\t\tcallerParams = jQuery.extend({}, params);\n\t\t\t\tparams = {};\n\t\t\t}\n\t\t\tparams.data = callerParams;\n\t\t}\n\t\t//Make the request as post by default\n\t\tif (typeof params.type === 'undefined' || rawData) params.type = 'POST';\n\t\tif (typeof params.jsonp === 'undefined' || rawData) params.jsonp = false;\n\n\t\t//By default we expect json from the server\n\t\tif (typeof params.dataType === 'undefined' || rawData) {\n\t\t\tvar data = params.data;\n\t\t\t//view will return html\n\t\t\tparams.dataType = 'json';\n\t\t\tif (data.hasOwnProperty('view')) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t} else if (typeof data === 'string' && data.indexOf('&view=') !== -1) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t}\n\t\t\tif (typeof params.url !== 'undefined' && params.url.indexOf('&view=') !== -1) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t}\n\t\t}\n\t\t//If url contains params then seperate them and make them as data\n\t\tif (typeof params.url !== 'undefined' && params.url.indexOf('?') !== -1) {\n\t\t\tfullUrl = params.url;\n\t\t\tvar urlSplit = params.url.split('?');\n\t\t\tvar queryString = urlSplit[1];\n\t\t\tparams.url = urlSplit[0];\n\t\t\tvar queryParameters = queryString.split('&');\n\t\t\tfor (var index = 0; index < queryParameters.length; index++) {\n\t\t\t\tvar queryParam = queryParameters[index];\n\t\t\t\tvar queryParamComponents = queryParam.split('=');\n\t\t\t\tparams.data[queryParamComponents[0]] = queryParamComponents[1];\n\t\t\t}\n\t\t}\n\t\tif (typeof params.url === 'undefined' || params.url.length <= 0) {\n\t\t\tparams.url = 'index.php';\n\t\t}\n\t\tparams.success = function (data, status, jqXHR) {\n\t\t\tif (data !== null && typeof data === 'object' && data.error) {\n\t\t\t\tapp.errorLog(data.error);\n\t\t\t\tif (data.error.message) {\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttext: data.error.message,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\taDeferred.resolve(data);\n\t\t};\n\t\tparams.error = function (jqXHR, textStatus, errorThrown) {\n\t\t\tlet sep = '-'.repeat(150);\n\t\t\tconsole.warn(\n\t\t\t\t'%cYetiForce debug mode!!!',\n\t\t\t\t'color: red; font-family: sans-serif; font-size: 1.5em; font-weight: bolder; text-shadow: #000 1px 1px;'\n\t\t\t);\n\t\t\tlet log = 'Error: ' + errorThrown + '\\n';\n\t\t\tlog += sep + '\\nParams:\\n' + sep + '\\n' + JSON.stringify(params, null, '\\t') + '\\n';\n\t\t\tif (jqXHR.responseJSON) {\n\t\t\t\tlog += sep + '\\nMessage: ' + jqXHR.responseJSON.error.message + '\\n';\n\t\t\t\tlog += sep + '\\nTrace:\\n' + sep + '\\n' + jqXHR.responseJSON.error.trace + '\\n';\n\t\t\t} else {\n\t\t\t\ttry {\n\t\t\t\t\tlet json = JSON.parse(jqXHR.responseText);\n\t\t\t\t\tlog += json.error.message ? sep + '\\nMessage: ' + json.error.message + '\\n' : '';\n\t\t\t\t\tlog += json.error.trace ? sep + '\\nTrace:\\n' + sep + '\\n' + json.error.trace + '\\n' : '';\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlog += sep + '\\nResponse:\\n' + sep + '\\n' + jqXHR.responseText;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconsole.error(log);\n\t\t\taDeferred.reject(textStatus, errorThrown, jqXHR);\n\t\t};\n\t\tjQuery.ajax(params);\n\t\tif (pjaxMode) {\n\t\t\tif (fullUrl === '') {\n\t\t\t\tfullUrl = 'index.php?' + $.param(params.data);\n\t\t\t} else if (fullUrl.indexOf('index.php?') === -1) {\n\t\t\t\tfullUrl = 'index.php?' + fullUrl;\n\t\t\t}\n\t\t\tif (history.pushState && fullUrl !== '') {\n\t\t\t\tconst currentHref = window.location.href;\n\t\t\t\tif (!history.state) {\n\t\t\t\t\thistory.replaceState(currentHref, 'title 1', currentHref);\n\t\t\t\t}\n\t\t\t\thistory.pushState(fullUrl, 'title 2', fullUrl);\n\t\t\t}\n\t\t}\n\t\treturn aDeferred.promise();\n\t},\n\n\trequestForm: function (url, params) {\n\t\tvar newEle = '<form action=' + url + ' method=\"POST\">';\n\t\tif (typeof csrfMagicName !== 'undefined') {\n\t\t\tnewEle += '<input type=\"hidden\" name=\"' + csrfMagicName + '\"  value=\\'' + csrfMagicToken + \"'>\";\n\t\t}\n\t\tif (typeof params !== 'undefined') {\n\t\t\tjQuery.each(params, function (index, value) {\n\t\t\t\tnewEle += '<input type=\"hidden\" name=\"' + index + '\"  value=\\'' + value + \"'>\";\n\t\t\t});\n\t\t}\n\t\tnewEle += '</form>';\n\t\tvar form = new jQuery(newEle);\n\t\tform.appendTo('body').submit();\n\t}\n};\n"],"names":["requestPjax","params","_request","request","rawData","AppConnector","pjaxMode","aDeferred","jQuery","Deferred","data","callerParams","fullUrl","index","indexOf","substr","replace","subStr","type","extend","jsonp","dataType","hasOwnProperty","url","urlSplit","split","queryString","queryParameters","length","queryParamComponents","queryParam","success","error","app","errorLog","message","showNotify","text","resolve","jqXHR","textStatus","errorThrown","repeat","console","warn","log","JSON","stringify","responseJSON","trace","parse","responseText","json","e","reject","ajax","$","param","history","pushState","window","location","href","state","replaceState","currentHref","promise","requestForm","newEle","csrfMagicName","csrfMagicToken","each","value","form","appendTo","submit"],"mappings":";;oSAAA,kKACA,IAAgB,YAAA,CAAG;AAEnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IACCA,WAAW,CAAE,SAAUC,WAAAA,CAAAA,MAAV,CAAkB,CAC9B,OAAmB,YAAA,CAACC,QAAb,CAAsBD,MAAtB,CAAA,CAAA,CAAA,CACP,CAZiB;AAenB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IACCE,OAAO,CAAE,SAAUF,OAAAA,CAAAA,MAAV,CAAkBG,OAAlB,CAA2B,CACnC,OAAOC,YAAY,CAACH,QAAb,CAAsBD,MAAtB,CAAqCG,CAAAA,CAAAA,CAAAA,OAArC,CACP,CAzBiB,CA2BlBF,QAAQ,CAAE,SAAA,QAAA,CAAUD,MAAV,CAAkBK,QAAlB,CAA4BF,OAA5B,CAAqC,CAC9C,IAAIG,SAAS,CAAGC,MAAM,CAACC,QAAP,EAAhB,CACuB,WAAnB,EAAA,OAF0C,OAAA,GAG7CL,OAAO,CAAA,CAAA,CAHsC,CAKtB,CAAA,WAApB,SAL0C,QAAA,GAM7CE,QAAQ,CAAA,CAAA,CANqC,CAQxB,CAAA,WAAlB,EAAOL,OAAAA,MARmC,GAS7CA,MAAM,CAAG,EAToC,CAW9C,CAAA,IAAW,OAAA,CAAG,EAAd,CACA;AACA,GAA2B,WAAvB,SAAa,MAAA,CAACS,IAAd,EAAsCN,OAA1C,CAAmD,CAClD,GAAsB,QAAlB,SAAJ,MAAA,CAAgC,CAC3BO,IAAAA,YAAY,CAAIC,OAAO,CAAGX,MADC,CAE3BY,KAAK,CAAGF,YAAY,CAACG,OAAb,CAAqB,GAArB,CAFmB,CAG/B,GAAc,CAAC,CAAX,GAAAD,KAAJ,CAAkB,CACjB,UAAU,CAAGF,YAAY,CAACI,MAAb,CAAoB,CAApB,CAAuBF,KAAK,CAAG,CAA/B,CAAb,CAAgD;AAChDF,YAAY,CAAGA,YAAY,CAACK,OAAb,CAAqBC,MAArB,CAA6B,EAA7B,EACf,CACDhB,MAAM,CAAG,CAAEiB,IAAI,CAAE,KAAR,EACT,CARD,KASa,YAAA,CAAGV,MAAM,CAACW,MAAP,CAAc,EAAd,CAAkBlB,MAAlB,CAThB,CAUCA,MAAM,CAAG,EAVV,CAYAA,MAAM,CAACS,IAAP,CAAcC,aACd,CACD;AAIA;AACA,GAAA,CAJ2B,WAAvB,EAAOV,OAAAA,MAAM,CAACiB,IAAd,EAAsCd,OAI1C,IAJmDH,MAAM,CAACiB,IAAP,CAAc,MAIjE,CAH4B,CAAA,CAAA,WAAxB,SAAa,MAAA,CAACE,KAAd,EAAuChB,OAG3C,IAHoDH,MAAM,CAACmB,KAAP,CAAA,CAAA,CAGpD,EAA+B,WAA3B,EAAA,aAAa,CAACC,QAAd,EAA0CjB,OAA9C,CAAuD,CACtD,IAAIM,IAAI,CAAGT,MAAM,CAACS,IAAlB,CACA;AACAT,MAAM,CAACoB,QAAP,CAAkB,MAHoC,CAIlDX,IAAI,CAACY,cAAL,CAAoB,MAApB,CAJkD,CAKrDrB,MAAM,CAACoB,QAAP,CAAkB,MALmC,CAM3B,QAAhB,EAAA,OAAA,IAAA,EAAuD,CAAC,CAA5B,GAAAX,IAAI,CAACI,OAAL,CAAa,QAAb,CANe,GAOrDb,MAAM,CAACoB,QAAP,CAAkB,MAPmC,CAS5B,CAAA,WAAtB,EAAOpB,OAAAA,MAAM,CAACsB,GAAd,EAAsE,CAAC,CAAlC,GAAAtB,MAAM,CAACsB,GAAP,CAAWT,OAAX,CAAmB,QAAnB,CATa,GAUrDb,MAAM,CAACoB,QAAP,CAAkB,MAVmC,EAYtD,CACD;AACA,GAA0B,WAAtB,EAAA,OAAa,MAAA,CAACE,GAAd,EAAiE,CAAC,CAA7B,GAAAtB,MAAM,CAACsB,GAAP,CAAWT,OAAX,CAAmB,GAAnB,CAAzC,CAAyE,CACxEF,OAAO,CAAGX,MAAM,CAACsB,GADuD,CAEpEC,IAAAA,QAAQ,CAAGvB,MAAM,CAACsB,GAAP,CAAWE,KAAX,CAAiB,GAAjB,CAFyD,CAGpEC,WAAW,CAAGF,QAAQ,CAAC,CAAD,CAH8C,CAIxEvB,MAAM,CAACsB,GAAP,CAAaC,QAAQ,CAAC,CAAD,CAJmD,CAMxE,IAAA,IADmB,eAAA,CAAGE,WAAW,CAACD,KAAZ,CAAkB,GAAlB,CACtB,CAASZ,KAAK,CAAG,CAAjB,CAAoBA,KAAK,CAAGc,eAAe,CAACC,MAA5C,CAAoDf,KAAK,EAAzD,CAA6D,CAAA,IAC9C,UAAA,CAAGc,eAAe,CAACd,KAAD,CAD4B,CAExDgB,oBAAoB,CAAGC,UAAU,CAACL,KAAX,CAAiB,GAAjB,CAFiC,CAG5DxB,MAAM,CAACS,IAAP,CAAYmB,oBAAoB,CAAC,CAAD,CAAhC,CAAA,CAAuCA,oBAAoB,CAAC,CAAD,EAC3D,CACD,CAwCD,GAvC0B,CAAA,WAAtB,EAAO5B,OAAAA,MAAM,CAACsB,GAAd,EAA0D,CAArB,EAAAtB,MAAM,CAACsB,GAAP,CAAWK,MAuCpD,IAtCC3B,MAAM,CAACsB,GAAP,CAAa,WAsCd,CAAA,CApCAtB,MAAM,CAAC8B,OAAP,CAAiB,SAAUrB,IAAV,CAA+B,CAClC,IAAT,GAAAA,IAAI,EAA6B,QAAhB,GAAOA,OAAAA,CAAAA,IAAP,CAAjB,EAA6CA,IAAI,CAACsB,KADP,GAE9CC,GAAG,CAACC,QAAJ,CAAaxB,IAAI,CAACsB,KAAlB,CAF8C,CAG1CtB,IAAI,CAACsB,KAAL,CAAWG,OAH+B,EAI7CF,GAAG,CAACG,UAAJ,CAAe,CACdC,IAAI,CAAE3B,IAAI,CAACsB,KAAL,CAAWG,OADH,CAEdjB,IAAI,CAAE,OAFQ,CAAf,CAJ6C,CAU/CX,CAAAA,SAAS,CAAC+B,OAAV,CAAkB5B,IAAlB,EACA,CAyBD,CAxBAT,MAAM,CAAC+B,KAAP,CAAe,SAAUO,KAAV,CAAiBC,UAAjB,CAA6BC,WAA7B,CAA0C,CAC9C,GAAIC,CAAAA,MAAJ,CAAW,GAAX,CAD8C,CAExDC,OAAO,CAACC,IAAR,CACC,2BADD,CAEC,wGAFD,CAFwD,CAMxD,IAAO,GAAA,CAAG,SAAYH,CAAAA,WAAZ,CAA0B,IAApC,CAEA,GADAI,GAAG,EAAI,2TAAA,CAAmCC,IAAI,CAACC,SAAL,CAAe9C,MAAf,CAAuB,IAAvB,CAA6B,IAA7B,CAAnC,CAAwE,IAC/E,CAAIsC,KAAK,CAACS,YAAV,CACCH,GAAG,EAAI,mKAAsBN,CAAAA,KAAK,CAACS,YAAN,CAAmBhB,KAAnB,CAAyBG,OAA/C,CAAyD,IADjE,CAECU,GAAG,EAAI,0TAAkCN,CAAAA,KAAK,CAACS,YAAN,CAAmBhB,KAAnB,CAAyBiB,KAA3D,CAAmE,IAF3E,CAIC,KAAA,GAAI,CACH,IAAQ,IAAA,CAAGH,IAAI,CAACI,KAAL,CAAWX,KAAK,CAACY,YAAjB,CAAX,CACAN,GAAG,EAAIO,IAAI,CAACpB,KAAL,CAAWG,OAAX,CAAqB,mKAAsBiB,CAAAA,IAAI,CAACpB,KAAL,CAAWG,OAAjC,CAA2C,IAAhE,CAAuE,EAF3E,CAGHU,GAAG,EAAIO,IAAI,CAACpB,KAAL,CAAWiB,KAAX,CAAmB,0TAAA,CAAkCG,IAAI,CAACpB,KAAL,CAAWiB,KAA7C,CAAqD,IAAxE,CAA+E,GACtF,CAAC,MAAOI,CAAP,CAAU,CACXR,GAAG,EAAI,6TAAA,CAAqCN,KAAK,CAACY,aAClD,CAEFR,OAAO,CAACX,KAAR,CAAca,GAAd,CApBwD,CAqBxDtC,SAAS,CAAC+C,MAAV,CAAiBd,UAAjB,CAA6BC,WAA7B,CAA0CF,KAA1C,EACA,CAED,CADA/B,MAAM,CAAC+C,IAAP,CAAYtD,MAAZ,CACA,CAAIK,QAAJ,GACiB,EAAZ,GAAAM,OADL,CAEEA,OAAO,CAAG,YAAA,CAAe4C,CAAC,CAACC,KAAF,CAAQxD,MAAM,CAACS,IAAf,CAF3B,CAG8C,CAAC,CAAnC,GAAAE,OAAO,CAACE,OAAR,CAAgB,YAAhB,CAHZ,GAIEF,OAAO,CAAG,YAAeA,CAAAA,OAJ3B,EAMK8C,OAAO,CAACC,SAAR,EAAiC,EAAZ,GAAA/C,OAN1B,CAAA,CAM0C,CACxC,IAAiB,WAAA,CAAGgD,MAAM,CAACC,QAAP,CAAgBC,IAApC,CACKJ,OAAO,CAACK,KAF2B,EAGvCL,OAAO,CAACM,YAAR,CAAqBC,WAArB,CAAkC,SAAlC,CAA6CA,WAA7C,CAHuC,CAKxCP,OAAO,CAACC,SAAR,CAAkB/C,OAAlB,CAA2B,SAA3B,CAAsCA,OAAtC,EACA,CAEF,OAAgB,SAAA,CAACsD,OAAV,EACP,CA5IiB,CA8IlBC,WAAW,CAAE,SAAU5C,WAAAA,CAAAA,GAAV,CAAetB,MAAf,CAAuB,CACnC,IAAImE,MAAM,CAAG,eAAA,CAAkB7C,GAAlB,CAAwB,mBAArC,CAC6B,WAAzB,EAAO8C,OAAAA,aAFwB,GAGlCD,MAAM,EAAI,gCAAA,CAAgCC,aAAhC,CAAgD,aAAhD,CAAgEC,cAAhE,CAAiF,IAHzD,CAAA,CAKb,WAAlB,EAAA,OAL+B,MAAA,EAMlC9D,MAAM,CAAC+D,IAAP,CAAYtE,MAAZ,CAAoB,SAAUY,KAAV,CAAiB2D,KAAjB,CAAwB,CAC3CJ,MAAM,EAAI,gCAAA,CAAgCvD,KAAhC,CAAwC,aAAxC,CAAwD2D,KAAxD,CAAgE,KAC1E,CAFD,CANkC,CAUnCJ,MAAM,EAAI,SAVyB,CAWnC,IAAQ,IAAA,CAAG,IAAI5D,MAAJ,CAAW4D,MAAX,CAAX,CACAK,IAAI,CAACC,QAAL,CAAc,MAAd,CAAA,CAAsBC,MAAtB,GACA,CA3JiB,CAAnB;;"}