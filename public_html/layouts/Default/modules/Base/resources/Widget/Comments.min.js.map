{"version":3,"file":"Comments.min.js","sources":["Comments.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\nwindow.Base_Widget_Comments_Js = class {\n\tconstructor() {\n\t\tthis.container = null;\n\t}\n\t/**\n\t * Load widget content\n\t */\n\tloadContent(page = 1) {\n\t\tconst deferred = $.Deferred();\n\t\tlet url = this.container.data('url');\n\t\tif (url) {\n\t\t\turl += page ? `&page=${page}` : '';\n\t\t\tlet progressInstance = $.progressIndicator({\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true,\n\t\t\t\t\telementToBlock: this.container\n\t\t\t\t},\n\t\t\t\tmessage: ' '\n\t\t\t});\n\t\t\tAppConnector.request(url)\n\t\t\t\t.done((responseData) => {\n\t\t\t\t\tthis.container.find('.js-widget-container_content').html(responseData);\n\t\t\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tdeferred.resolve();\n\t\t\t\t})\n\t\t\t\t.fail(function (e, er) {\n\t\t\t\t\tapp.errorLog(e, er);\n\t\t\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tdeferred.reject();\n\t\t\t\t});\n\t\t} else {\n\t\t\tdeferred.reject();\n\t\t}\n\t\treturn deferred.promise();\n\t}\n\tgetContent(url = null) {\n\t\tconst deferred = $.Deferred();\n\t\tif (url) {\n\t\t\tlet progressInstance = $.progressIndicator({\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true,\n\t\t\t\t\telementToBlock: this.container\n\t\t\t\t},\n\t\t\t\tmessage: ' '\n\t\t\t});\n\t\t\tAppConnector.request(url)\n\t\t\t\t.done((responseData) => {\n\t\t\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tdeferred.resolve(responseData);\n\t\t\t\t})\n\t\t\t\t.fail(function (e, er) {\n\t\t\t\t\tapp.errorLog(e, er);\n\t\t\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tdeferred.reject(false);\n\t\t\t\t});\n\t\t} else {\n\t\t\tdeferred.reject();\n\t\t}\n\t\treturn deferred.promise();\n\t}\n\n\t/**\n\t * Change page event\n\t */\n\tregisterChangePage() {\n\t\tthis.container.on('click', '.js-change-page', (e) => {\n\t\t\tlet page = e.currentTarget.dataset.page;\n\t\t\tthis.loadContent(page);\n\t\t});\n\t}\n\n\t/**\n\t * Show replies\n\t */\n\tregisterShowReplies() {\n\t\tthis.container.on('click', '.js-show-replies', (e) => {\n\t\t\tlet element = $(e.currentTarget);\n\t\t\tlet url = e.currentTarget.dataset.url;\n\t\t\tthis.getContent(url).done((result) => {\n\t\t\t\telement.closest('.js-post-container_body').append(result);\n\t\t\t\telement.addClass('d-none');\n\t\t\t});\n\t\t});\n\t}\n\t/**\n\t * Add comments\n\t */\n\tregisterAddComments() {\n\t\tlet form = this.container.find('.js-add-comment-block form');\n\t\tform.validationEngine({ binded: false, ...app.validationEngineOptions });\n\t\tform.on('submit', (e) => {\n\t\t\te.preventDefault();\n\t\t\tif (form.validationEngine('validate')) {\n\t\t\t\tlet commentContent = form.find('.js-comment-content');\n\t\t\t\tlet commentContentValue = commentContent.html();\n\t\t\t\tif ('' === commentContentValue) {\n\t\t\t\t\tcommentContent.validationEngine(\n\t\t\t\t\t\t'showPrompt',\n\t\t\t\t\t\tapp.translate('JS_LBL_COMMENT_VALUE_CANT_BE_EMPTY'),\n\t\t\t\t\t\t'error',\n\t\t\t\t\t\t'bottomLeft',\n\t\t\t\t\t\ttrue\n\t\t\t\t\t);\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tlet formData = form.serializeFormData();\n\t\t\t\tformData['commentcontent'] = commentContentValue;\n\t\t\t\tAppConnector.request(formData).done((response) => {\n\t\t\t\t\tform.find('[name=\"commentcontent\"]').empty();\n\t\t\t\t\tthis.loadContent();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tthis.container.on('submit', '.js-reply-comment-block form', (e) => {\n\t\t\te.preventDefault();\n\t\t\tlet formReply = $(e.currentTarget);\n\t\t\tformReply.validationEngine({ binded: false, ...app.validationEngineOptions });\n\t\t\tif (formReply.validationEngine('validate')) {\n\t\t\t\tAppConnector.request(formReply.serializeFormData()).done((response) => {\n\t\t\t\t\tformReply.find('[name=\"commentcontent\"]').val('');\n\t\t\t\t\tlet postContainer = formReply.closest('.js-post-container');\n\t\t\t\t\tlet url = postContainer.find('.js-show-replies:first').data('url');\n\t\t\t\t\tthis.getContent(url).done((result) => {\n\t\t\t\t\t\tpostContainer.find('.js-post-container').remove();\n\t\t\t\t\t\tpostContainer.find('.js-post-cancel').trigger('click');\n\t\t\t\t\t\tpostContainer.find('.js-post-container_body').append(result);\n\t\t\t\t\t\tpostContainer.find('.js-show-replies').addClass('d-none');\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\tregisterReply() {\n\t\tthis.container.on('click', '.js-post-reply,.js-post-cancel', (e) => {\n\t\t\tlet postContainer = $(e.currentTarget).closest('.js-post-container'),\n\t\t\t\treplyBlock = postContainer.find('.js-reply-comment-block:first'),\n\t\t\t\treplyBtn = postContainer.find('.js-post-reply:first');\n\t\t\treplyBlock.toggleClass('d-none');\n\t\t\treplyBtn.toggleClass('d-none');\n\t\t});\n\t}\n\n\t/**\n\t * Register events\n\t * @param {jQuery} container\n\t */\n\n\tregisterEvents(container) {\n\t\tthis.container = container;\n\t\tthis.loadContent();\n\t\tthis.registerChangePage();\n\t\tthis.registerShowReplies();\n\t\tthis.registerAddComments();\n\t\tthis.registerReply();\n\t}\n};\n"],"names":["window","Base_Widget_Comments_Js","container","page","deferred","$","Deferred","url","data","progressIndicator","position","blockInfo","enabled","elementToBlock","message","AppConnector","request","done","responseData","find","html","progressInstance","mode","resolve","fail","e","er","app","errorLog","reject","promise","on","currentTarget","dataset","loadContent","getContent","result","element","closest","append","addClass","form","validationEngine","binded","validationEngineOptions","preventDefault","commentContentValue","commentContent","translate","formData","serializeFormData","empty","formReply","val","postContainer","remove","trigger","replyBlock","replyBtn","toggleClass","registerChangePage","registerShowReplies","registerAddComments","registerReply"],"mappings":"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"}