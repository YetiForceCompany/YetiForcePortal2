'use strict';

function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols);}return keys}function _objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null==arguments[i]?{}:arguments[i],i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)descriptor=props[i],descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor);}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */window.Base_Widget_Comments_Js=/*#__PURE__*/function(){function _class(){_classCallCheck(this,_class),this.container=null;}/**
	 * Load widget content
	 */return _createClass(_class,[{key:"loadContent",value:function loadContent(){var _this=this,page=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,deferred=$.Deferred(),url=this.container.data("url");if(url){url+=page?"&page=".concat(page):"";var progressInstance=$.progressIndicator({position:"html",blockInfo:{enabled:!0,elementToBlock:this.container},message:" "});AppConnector.request(url).done(function(responseData){_this.container.find(".js-widget-container_content").html(responseData),progressInstance.progressIndicator({mode:"hide"}),deferred.resolve();}).fail(function(e,er){app.errorLog(e,er),progressInstance.progressIndicator({mode:"hide"}),deferred.reject();});}else deferred.reject();return deferred.promise()}},{key:"getContent",value:function getContent(){var url=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,deferred=$.Deferred();if(url){var progressInstance=$.progressIndicator({position:"html",blockInfo:{enabled:!0,elementToBlock:this.container},message:" "});AppConnector.request(url).done(function(responseData){progressInstance.progressIndicator({mode:"hide"}),deferred.resolve(responseData);}).fail(function(e,er){app.errorLog(e,er),progressInstance.progressIndicator({mode:"hide"}),deferred.reject(!1);});}else deferred.reject();return deferred.promise()}/**
	 * Change page event
	 */},{key:"registerChangePage",value:function registerChangePage(){var _this2=this;this.container.on("click",".js-change-page",function(e){var page=e.currentTarget.dataset.page;_this2.loadContent(page);});}/**
	 * Show replies
	 */},{key:"registerShowReplies",value:function registerShowReplies(){var _this3=this;this.container.on("click",".js-show-replies",function(e){var element=$(e.currentTarget),url=e.currentTarget.dataset.url;_this3.getContent(url).done(function(result){element.closest(".js-post-container_body").append(result),element.addClass("d-none");});});}/**
	 * Add comments
	 */},{key:"registerAddComments",value:function registerAddComments(){var _this4=this,form=this.container.find(".js-add-comment-block form");form.validationEngine(_objectSpread({binded:!1},app.validationEngineOptions)),form.on("submit",function(e){if(e.preventDefault(),form.validationEngine("validate")){var commentContent=form.find(".js-comment-content"),commentContentValue=commentContent.html();if(""===commentContentValue)return commentContent.validationEngine("showPrompt",app.translate("JS_LBL_COMMENT_VALUE_CANT_BE_EMPTY"),"error","bottomLeft",!0),!1;var formData=form.serializeFormData();formData.commentcontent=commentContentValue,AppConnector.request(formData).done(function(){form.find("[name=\"commentcontent\"]").empty(),_this4.loadContent();});}}),this.container.on("submit",".js-reply-comment-block form",function(e){e.preventDefault();var formReply=$(e.currentTarget);formReply.validationEngine(_objectSpread({binded:!1},app.validationEngineOptions)),formReply.validationEngine("validate")&&AppConnector.request(formReply.serializeFormData()).done(function(){formReply.find("[name=\"commentcontent\"]").val("");var postContainer=formReply.closest(".js-post-container"),url=postContainer.find(".js-show-replies:first").data("url");_this4.getContent(url).done(function(result){postContainer.find(".js-post-container").remove(),postContainer.find(".js-post-cancel").trigger("click"),postContainer.find(".js-post-container_body").append(result),postContainer.find(".js-show-replies").addClass("d-none");});});});}},{key:"registerReply",value:function registerReply(){this.container.on("click",".js-post-reply,.js-post-cancel",function(e){var postContainer=$(e.currentTarget).closest(".js-post-container"),replyBlock=postContainer.find(".js-reply-comment-block:first"),replyBtn=postContainer.find(".js-post-reply:first");replyBlock.toggleClass("d-none"),replyBtn.toggleClass("d-none");});}/**
	 * Register events
	 * @param {jQuery} container
	 */},{key:"registerEvents",value:function registerEvents(container){this.container=container,this.loadContent(),this.registerChangePage(),this.registerShowReplies(),this.registerAddComments(),this.registerReply();}}]),_class}();
//# sourceMappingURL=Comments.min.js.map
