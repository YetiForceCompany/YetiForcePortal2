{"version":3,"file":"EditView.min.js","sources":["EditView.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\njQuery.Class(\n\t'Base_EditView_Js',\n\t{},\n\t{\n\t\tcontainer: false,\n\t\tgetContainer: function () {\n\t\t\tif (this.container == false) {\n\t\t\t\tthis.container = jQuery('.mainContent');\n\t\t\t}\n\t\t\treturn this.container;\n\t\t},\n\t\treferenceModulePopupRegisterEvent: function (container) {\n\t\t\tvar thisInstance = this;\n\t\t\tif (container == undefined) {\n\t\t\t\tcontainer = this.getContainer();\n\t\t\t}\n\t\t\tcontainer.on('click', '.relatedPopup', function (e) {\n\t\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\t\tvar containerField = element.closest('.fieldValue');\n\t\t\t\tvar url = 'index.php?module=' + thisInstance.getReferencedModuleName(containerField) + '&view=RecordList';\n\t\t\t\tapp.getRecordList(url, function (selectedItems) {\n\t\t\t\t\tthisInstance.setReferenceFieldValue(containerField, selectedItems);\n\t\t\t\t});\n\t\t\t});\n\t\t\tcontainer.find('.referenceModulesList').on('change', function (e) {\n\t\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\t\tvar parentElem = element.closest('.fieldValue');\n\t\t\t\tvar popupReferenceModule = element.val();\n\t\t\t\tvar referenceModuleElement = jQuery('input[name=\"popupReferenceModule\"]', parentElem);\n\t\t\t\tvar prevSelectedReferenceModule = referenceModuleElement.val();\n\t\t\t\treferenceModuleElement.val(popupReferenceModule);\n\n\t\t\t\t//If Reference module is changed then we should clear the previous value\n\t\t\t\tif (prevSelectedReferenceModule != popupReferenceModule) {\n\t\t\t\t\tparentElem.find('.clearReferenceSelection').trigger('click');\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tgetReferencedModuleName: function (parenElement) {\n\t\t\treturn jQuery('input[name=\"popupReferenceModule\"]', parenElement).val();\n\t\t},\n\t\tregisterClearReferenceSelectionEvent: function (container) {\n\t\t\tvar thisInstance = this;\n\t\t\tcontainer.on('click', '.clearReferenceSelection', function (e) {\n\t\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\t\tthisInstance.clearFieldValue(element);\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t},\n\t\tclearFieldValue: function (element) {\n\t\t\tvar fieldValueContener = element.closest('.fieldValue');\n\t\t\tvar fieldNameElement = fieldValueContener.find('.sourceField');\n\t\t\tvar fieldName = fieldNameElement.attr('name');\n\t\t\tfieldNameElement.val('');\n\t\t\tfieldValueContener\n\t\t\t\t.find('#' + fieldName + '_display')\n\t\t\t\t.removeAttr('readonly')\n\t\t\t\t.val('');\n\t\t},\n\t\tsetReferenceFieldValue: function (container, params) {\n\t\t\tvar sourceField = container.find('input.sourceField').attr('name');\n\t\t\tvar fieldElement = container.find('input[name=\"' + sourceField + '\"]');\n\t\t\tvar sourceFieldDisplay = sourceField + '_display';\n\t\t\tvar fieldDisplayElement = container.find('input[name=\"' + sourceFieldDisplay + '\"]');\n\t\t\tvar selectedName = params.name;\n\t\t\tvar id = params.id;\n\t\t\tfieldElement.val(id);\n\t\t\tfieldDisplayElement.val(selectedName).attr('readonly', true);\n\t\t},\n\t\tregisterValidationsFields: function (container) {\n\t\t\tvar params = app.validationEngineOptions;\n\t\t\tcontainer.validationEngine(params);\n\t\t},\n\t\tregisterMaskFields: function (container) {\n\t\t\tcontainer.find(':input').inputmask();\n\t\t},\n\t\tregisterRecordSave: function (container) {\n\t\t\tvar formElement = container.find('form');\n\t\t\tformElement.on('submit', function (e) {\n\t\t\t\tif (formElement.validationEngine('validate') === true) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tvar form = jQuery(e.currentTarget);\n\t\t\t\t\tvar formData = form.serializeFormData();\n\t\t\t\t\tAppConnector.request(formData).done((data) => {\n\t\t\t\t\t\tvar data = JSON.parse(data);\n\t\t\t\t\t\tvar response = data.result;\n\t\t\t\t\t\tif (response.id) {\n\t\t\t\t\t\t\twindow.location.href =\n\t\t\t\t\t\t\t\t'index.php?module=' + app.getModuleName() + '&view=DetailView&record=' + response.id;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\talert(response.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tapp.formAlignmentAfterValidation(formElement);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tregisterTree: function () {\n\t\t\tlet container = this.getContainer();\n\t\t\tcontainer.find('.js-tree-select').on('click', function () {\n\t\t\t\tlet containerField = $(this).closest('.js-tree-content'),\n\t\t\t\t\ttreeValueField = containerField.find('.js-tree-value'),\n\t\t\t\t\tfieldDisplayElement = containerField.find('input[name=\"' + treeValueField.attr('name') + '_display\"]'),\n\t\t\t\t\tmultiple = treeValueField.data('multiple');\n\t\t\t\tapp.showModalWindow(containerField.find('.js-tree-modal-window').clone(), function (modalContainer) {\n\t\t\t\t\tlet jstreeInstance = modalContainer.find('.js-tree-jstree');\n\t\t\t\t\tif (multiple === 1) {\n\t\t\t\t\t\tnew window.App.Fields.MultiTree(jstreeInstance);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnew window.App.Fields.Tree(jstreeInstance);\n\t\t\t\t\t}\n\t\t\t\t\tmodalContainer.find('.js-tree-modal-select').on('click', function () {\n\t\t\t\t\t\tlet selectedCategories = [];\n\t\t\t\t\t\t$.each(jstreeInstance.jstree('get_selected', true), (index, value) => {\n\t\t\t\t\t\t\tselectedCategories.push(value);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tlet treeText = [];\n\t\t\t\t\t\tlet treeValue = [];\n\t\t\t\t\t\t$.each(selectedCategories, (index, value) => {\n\t\t\t\t\t\t\ttreeValue.push(value['original']['tree']);\n\t\t\t\t\t\t\ttreeText.push(value['text']);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfieldDisplayElement.val(treeText.join(','));\n\t\t\t\t\t\tfieldDisplayElement.attr('readonly', true);\n\t\t\t\t\t\ttreeValueField.val(treeValue.join(','));\n\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\tcontainer.find('.js-tree-clear').on('click', function (e) {\n\t\t\t\tlet containerField = $(this).closest('.js-tree-content'),\n\t\t\t\t\ttreeValueField = containerField.find('.js-tree-value'),\n\t\t\t\t\tfieldDisplayElement = containerField.find('input[name=\"' + treeValueField.attr('name') + '_display\"]');\n\t\t\t\tfieldDisplayElement.val('');\n\t\t\t\tfieldDisplayElement.attr('readonly', false);\n\t\t\t\ttreeValueField.val('');\n\t\t\t});\n\t\t},\n\t\tregisterEvents: function () {\n\t\t\tvar container = this.getContainer();\n\t\t\tcontainer.find('form').validationEngine(app.validationEngineOptions);\n\t\t\tthis.referenceModulePopupRegisterEvent();\n\t\t\tthis.registerClearReferenceSelectionEvent(container);\n\t\t\tthis.registerValidationsFields(container);\n\t\t\tthis.registerMaskFields(container);\n\t\t\tthis.registerRecordSave(container);\n\t\t\tthis.registerTree();\n\t\t}\n\t}\n);\n"],"names":["jQuery","Class","container","getContainer","referenceModulePopupRegisterEvent","on","e","currentTarget","containerField","element","closest","url","thisInstance","getReferencedModuleName","app","getRecordList","selectedItems","setReferenceFieldValue","find","parentElem","popupReferenceModule","val","referenceModuleElement","prevSelectedReferenceModule","trigger","parenElement","registerClearReferenceSelectionEvent","clearFieldValue","preventDefault","fieldNameElement","fieldValueContener","fieldName","attr","removeAttr","params","fieldElement","sourceField","fieldDisplayElement","selectedName","name","id","registerValidationsFields","validationEngineOptions","validationEngine","registerMaskFields","inputmask","registerRecordSave","formElement","formData","form","serializeFormData","AppConnector","request","done","data","JSON","parse","response","result","window","location","href","getModuleName","alert","message","formAlignmentAfterValidation","registerTree","$","treeValueField","multiple","showModalWindow","clone","modalContainer","App","Fields","MultiTree","jstreeInstance","Tree","each","jstree","index","value","selectedCategories","push","treeValue","treeText","join","hideModalWindow","registerEvents"],"mappings":"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"}