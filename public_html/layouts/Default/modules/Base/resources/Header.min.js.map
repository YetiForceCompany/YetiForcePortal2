{"version":3,"file":"Header.min.js","sources":["Header.js"],"sourcesContent":["/**\n * Base header class\n *\n * @copyright YetiForce Sp. z o.o.\n * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n */\n'use strict';\n\njQuery.Class(\n\t'Base_Header_Js',\n\t{\n\t\tself: false,\n\t\tgetInstance: function () {\n\t\t\tif (this.self != false) {\n\t\t\t\treturn this.self;\n\t\t\t}\n\t\t\tthis.self = new Base_Header_Js();\n\t\t\treturn this.self;\n\t\t}\n\t},\n\t{\n\t\trecentPageViews: function () {\n\t\t\tvar thisInstance = this;\n\t\t\tvar maxValues = 20;\n\t\t\tvar BtnText = '';\n\t\t\tvar BtnLink = 'javascript:void();';\n\t\t\tvar key = 'yf_history_portal_';\n\t\t\tvar history = localStorage.getItem(key);\n\t\t\tif (history != '' && history != null) {\n\t\t\t\tvar sp = history.toString().split('_|_');\n\t\t\t\tvar item = sp[sp.length - 1].toString().split('|');\n\t\t\t\tBtnText = item[0];\n\t\t\t\tBtnLink = item[1];\n\t\t\t}\n\t\t\tvar htmlContent = '<ul class=\"dropdown-menu float-right historyList px-3\" role=\"menu\">';\n\t\t\tvar date = new Date().getTime();\n\t\t\tvar howManyDays = -1;\n\t\t\tvar writeSelector = true;\n\t\t\tif (sp != null) {\n\t\t\t\tfor (var i = sp.length - 1; i >= 0; i--) {\n\t\t\t\t\titem = sp[i].toString().split('|');\n\t\t\t\t\tvar d = new Date();\n\t\t\t\t\tvar t = '';\n\t\t\t\t\tif (item[2] != undefined) {\n\t\t\t\t\t\td.setTime(item[2]);\n\t\t\t\t\t\tvar hours = app.formatDateZ(d.getHours());\n\t\t\t\t\t\tvar minutes = app.formatDateZ(d.getMinutes());\n\t\t\t\t\t\tif (writeSelector && howManyDays != app.howManyDaysFromDate(d)) {\n\t\t\t\t\t\t\thowManyDays = app.howManyDaysFromDate(d);\n\t\t\t\t\t\t\tif (howManyDays == 0) {\n\t\t\t\t\t\t\t\thtmlContent += '<li class=\"selectorHistory\">' + app.translate('JS_TODAY') + '</li>';\n\t\t\t\t\t\t\t} else if (howManyDays == 1) {\n\t\t\t\t\t\t\t\thtmlContent += '<li class=\"selectorHistory\">' + app.translate('JS_YESTERDAY') + '</li>';\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\thtmlContent += '<li class=\"selectorHistory\">' + app.translate('JS_OLDER') + '</li>';\n\t\t\t\t\t\t\t\twriteSelector = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (writeSelector) t = '<span class=\"historyHour\">' + hours + ':' + minutes + '</span> | ';\n\t\t\t\t\t\telse t = app.formatDate(d) + ' | ';\n\t\t\t\t\t}\n\t\t\t\t\tvar format = $('#userDateFormat').val() + '' + $('#userDateFormat').val();\n\t\t\t\t\thtmlContent += ' <a class=\"item dropdown-item\" href=\"' + item[1] + '\">' + t + item[0] + '</a>';\n\t\t\t\t}\n\t\t\t\tvar Label = this.getHistoryLabel();\n\t\t\t\tif (Label.length > 1 && document.URL != BtnLink) {\n\t\t\t\t\tsp.push(this.getHistoryLabel() + '|' + document.URL + '|' + date);\n\t\t\t\t}\n\t\t\t\tif (sp.length >= maxValues) {\n\t\t\t\t\tsp.splice(0, 1);\n\t\t\t\t}\n\t\t\t\tlocalStorage.setItem(key, sp.join('_|_'));\n\t\t\t} else {\n\t\t\t\tvar stack = new Array();\n\t\t\t\tvar Label = this.getHistoryLabel();\n\t\t\t\tif (Label.length > 1) {\n\t\t\t\t\tstack.push(this.getHistoryLabel() + '|' + document.URL + '|' + date);\n\t\t\t\t\tlocalStorage.setItem(key, stack.join('_|_'));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (history != null) {\n\t\t\t\thtmlContent +=\n\t\t\t\t\t'<div class=\"dropdown-divider\"></div><a class=\"dropdown-item clearHistory\" href=\"#\">' +\n\t\t\t\t\tapp.translate('JS_CLEAR_HISTORY') +\n\t\t\t\t\t'</a>';\n\t\t\t} else {\n\t\t\t\thtmlContent +=\n\t\t\t\t\t' <a class=\"item dropdown-item\" href=\"#\" role=\"listitem\">' + app.translate('JS_NO_RECORDS') + '</a>';\n\t\t\t}\n\n\t\t\thtmlContent += '</ul>';\n\t\t\t$('.showHistoryBtn').after(htmlContent);\n\t\t\tthis.registerClearHistory();\n\t\t},\n\t\tgetHistoryLabel: function () {\n\t\t\tvar label = '';\n\t\t\t$('.breadcrumbsLinks span').each(function (index) {\n\t\t\t\tlabel += $(this).text().replace(/\\//g, ' ');\n\t\t\t});\n\t\t\treturn label;\n\t\t},\n\t\tregisterClearHistory: function () {\n\t\t\t$('.historyBtn .clearHistory').click(function () {\n\t\t\t\tvar key = 'yf_history_portal_';\n\t\t\t\tlocalStorage.removeItem(key);\n\t\t\t\tvar htmlContent =\n\t\t\t\t\t'<a class=\"item dropdown-item\" href=\"#\" role=\"listitem\">' + app.translate('JS_NO_RECORDS') + '</a>';\n\t\t\t\t$('.historyBtn .dropdown-menu').html(htmlContent);\n\t\t\t});\n\t\t},\n\t\tregisterChangeCompany: function () {\n\t\t\t$('#modalSelectCompanies').on('show.bs.modal', function (relatedTarget) {\n\t\t\t\tlet modal = $(relatedTarget.target);\n\t\t\t\tlet select = modal.find('select').addClass('select2');\n\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(select);\n\t\t\t\tmodal.on('click', '.js-change-company', function (e) {\n\t\t\t\t\tAppConnector.request({\n\t\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\t\taction: 'ChangeCompany',\n\t\t\t\t\t\trecord: modal.find('#companyId').val()\n\t\t\t\t\t}).done((data) => {\n\t\t\t\t\t\twindow.location.href = 'index.php';\n\t\t\t\t\t});\n\t\t\t\t\te.preventDefault();\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Show left scrollbar for menu.\n\t\t */\n\t\tregisterScrolbarToMenu() {\n\t\t\tconst container = $('.js-base-container'),\n\t\t\t\tmenuContainer = container.find('.js-menu--scroll');\n\t\t\tapp.showNewScrollbarLeft(menuContainer, { suppressScrollX: true });\n\t\t},\n\t\t/**\n\t\t * Pin menu\n\t\t */\n\t\tregisterPinEvent: function () {\n\t\t\tconst container = $('.js-base-container');\n\t\t\tlet pinButton = container.find('.js-menu--pin');\n\t\t\tpinButton.on('click', () => {\n\t\t\t\tlet hideMenu = 0;\n\t\t\t\tif (pinButton.attr('data-show') === '0') {\n\t\t\t\t\thideMenu = 1;\n\t\t\t\t\tpinButton.removeClass('u-opacity-muted');\n\t\t\t\t\tcontainer.addClass('c-menu--open');\n\t\t\t\t} else {\n\t\t\t\t\tpinButton.addClass('u-opacity-muted');\n\t\t\t\t\tcontainer.removeClass('c-menu--open');\n\t\t\t\t}\n\t\t\t\tpinButton.attr('data-show', hideMenu);\n\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tmodule: 'Users',\n\t\t\t\t\taction: 'UserPreferences',\n\t\t\t\t\tkey: 'menuPin',\n\t\t\t\t\tvalue: hideMenu\n\t\t\t\t}).done((response) => {\n\t\t\t\t\tif (response.success) {\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: app.translate('JS_SAVE_NOTIFY_SUCCESS'),\n\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tcontainer.addClass('c-menu--animation');\n\t\t\t\t}, 300);\n\t\t\t});\n\t\t},\n\t\tregisterEvents: function () {\n\t\t\tvar thisInstance = this;\n\t\t\tthisInstance.recentPageViews();\n\t\t\tthisInstance.registerChangeCompany();\n\t\t\tthisInstance.registerScrolbarToMenu();\n\t\t\tthisInstance.registerPinEvent();\n\t\t\tApp.Fields.Tree.getInstance();\n\t\t}\n\t}\n);\njQuery(document).ready(function () {\n\tBase_Header_Js.getInstance().registerEvents();\n});\n"],"names":["jQuery","Class","self","getInstance","recentPageViews","thisInstance","BtnText","BtnLink","history","localStorage","getItem","toString","split","item","sp","length","date","getTime","howManyDays","writeSelector","i","t","d","setTime","app","formatDateZ","getHours","minutes","getMinutes","howManyDaysFromDate","htmlContent","translate","hours","formatDate","$","val","getHistoryLabel","document","URL","push","splice","setItem","join","Label","stack","after","registerClearHistory","each","label","text","replace","click","removeItem","html","registerChangeCompany","on","relatedTarget","target","select","modal","find","addClass","App","Fields","Picklist","showSelect2ElementView","e","AppConnector","request","module","getModuleName","action","record","done","window","location","href","preventDefault","registerScrolbarToMenu","menuContainer","container","showNewScrollbarLeft","suppressScrollX","registerPinEvent","pinButton","attr","hideMenu","removeClass","key","value","response","success","showNotify","type","setTimeout","registerEvents","Tree","ready","Base_Header_Js"],"mappings":"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"}