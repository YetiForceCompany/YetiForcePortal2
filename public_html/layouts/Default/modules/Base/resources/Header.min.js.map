{"version":3,"file":"Header.min.js","sources":["Header.js"],"sourcesContent":["/**\n * Base header class\n *\n * @copyright YetiForce Sp. z o.o.\n * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n */\n'use strict';\n\njQuery.Class(\n\t'Base_Header_Js',\n\t{\n\t\tself: false,\n\t\tgetInstance: function () {\n\t\t\tif (this.self != false) {\n\t\t\t\treturn this.self;\n\t\t\t}\n\t\t\tthis.self = new Base_Header_Js();\n\t\t\treturn this.self;\n\t\t}\n\t},\n\t{\n\t\trecentPageViews: function () {\n\t\t\tvar thisInstance = this;\n\t\t\tvar maxValues = 20;\n\t\t\tvar BtnText = '';\n\t\t\tvar BtnLink = 'javascript:void();';\n\t\t\tvar key = 'yf_history_portal_';\n\t\t\tvar history = localStorage.getItem(key);\n\t\t\tif (history != '' && history != null) {\n\t\t\t\tvar sp = history.toString().split('_|_');\n\t\t\t\tvar item = sp[sp.length - 1].toString().split('|');\n\t\t\t\tBtnText = item[0];\n\t\t\t\tBtnLink = item[1];\n\t\t\t}\n\t\t\tvar htmlContent = '<ul class=\"dropdown-menu float-right historyList px-3\" role=\"menu\">';\n\t\t\tvar date = new Date().getTime();\n\t\t\tvar howManyDays = -1;\n\t\t\tvar writeSelector = true;\n\t\t\tif (sp != null) {\n\t\t\t\tfor (var i = sp.length - 1; i >= 0; i--) {\n\t\t\t\t\titem = sp[i].toString().split('|');\n\t\t\t\t\tvar d = new Date();\n\t\t\t\t\tvar t = '';\n\t\t\t\t\tif (item[2] != undefined) {\n\t\t\t\t\t\td.setTime(item[2]);\n\t\t\t\t\t\tvar hours = app.formatDateZ(d.getHours());\n\t\t\t\t\t\tvar minutes = app.formatDateZ(d.getMinutes());\n\t\t\t\t\t\tif (writeSelector && howManyDays != app.howManyDaysFromDate(d)) {\n\t\t\t\t\t\t\thowManyDays = app.howManyDaysFromDate(d);\n\t\t\t\t\t\t\tif (howManyDays == 0) {\n\t\t\t\t\t\t\t\thtmlContent += '<li class=\"selectorHistory\">' + app.translate('JS_TODAY') + '</li>';\n\t\t\t\t\t\t\t} else if (howManyDays == 1) {\n\t\t\t\t\t\t\t\thtmlContent += '<li class=\"selectorHistory\">' + app.translate('JS_YESTERDAY') + '</li>';\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\thtmlContent += '<li class=\"selectorHistory\">' + app.translate('JS_OLDER') + '</li>';\n\t\t\t\t\t\t\t\twriteSelector = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (writeSelector) t = '<span class=\"historyHour\">' + hours + ':' + minutes + '</span> | ';\n\t\t\t\t\t\telse t = app.formatDate(d) + ' | ';\n\t\t\t\t\t}\n\t\t\t\t\tvar format = $('#userDateFormat').val() + '' + $('#userDateFormat').val();\n\t\t\t\t\thtmlContent += ' <a class=\"item dropdown-item\" href=\"' + item[1] + '\">' + t + item[0] + '</a>';\n\t\t\t\t}\n\t\t\t\tvar Label = this.getHistoryLabel();\n\t\t\t\tif (Label.length > 1 && document.URL != BtnLink) {\n\t\t\t\t\tsp.push(this.getHistoryLabel() + '|' + document.URL + '|' + date);\n\t\t\t\t}\n\t\t\t\tif (sp.length >= maxValues) {\n\t\t\t\t\tsp.splice(0, 1);\n\t\t\t\t}\n\t\t\t\tlocalStorage.setItem(key, sp.join('_|_'));\n\t\t\t} else {\n\t\t\t\tvar stack = new Array();\n\t\t\t\tvar Label = this.getHistoryLabel();\n\t\t\t\tif (Label.length > 1) {\n\t\t\t\t\tstack.push(this.getHistoryLabel() + '|' + document.URL + '|' + date);\n\t\t\t\t\tlocalStorage.setItem(key, stack.join('_|_'));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (history != null) {\n\t\t\t\thtmlContent +=\n\t\t\t\t\t'<div class=\"dropdown-divider\"></div><a class=\"dropdown-item clearHistory\" href=\"#\">' +\n\t\t\t\t\tapp.translate('JS_CLEAR_HISTORY') +\n\t\t\t\t\t'</a>';\n\t\t\t} else {\n\t\t\t\thtmlContent +=\n\t\t\t\t\t' <a class=\"item dropdown-item\" href=\"#\" role=\"listitem\">' + app.translate('JS_NO_RECORDS') + '</a>';\n\t\t\t}\n\n\t\t\thtmlContent += '</ul>';\n\t\t\t$('.showHistoryBtn').after(htmlContent);\n\t\t\tthis.registerClearHistory();\n\t\t},\n\t\tgetHistoryLabel: function () {\n\t\t\tvar label = '';\n\t\t\t$('.breadcrumbsLinks span').each(function (index) {\n\t\t\t\tlabel += $(this).text().replace(/\\//g, ' ');\n\t\t\t});\n\t\t\treturn label;\n\t\t},\n\t\tregisterClearHistory: function () {\n\t\t\t$('.historyBtn .clearHistory').click(function () {\n\t\t\t\tvar key = 'yf_history_portal_';\n\t\t\t\tlocalStorage.removeItem(key);\n\t\t\t\tvar htmlContent =\n\t\t\t\t\t'<a class=\"item dropdown-item\" href=\"#\" role=\"listitem\">' + app.translate('JS_NO_RECORDS') + '</a>';\n\t\t\t\t$('.historyBtn .dropdown-menu').html(htmlContent);\n\t\t\t});\n\t\t},\n\t\tregisterChangeCompany: function () {\n\t\t\t$('#modalSelectCompanies').on('show.bs.modal', function (relatedTarget) {\n\t\t\t\tlet modal = $(relatedTarget.target);\n\t\t\t\tlet select = modal.find('select').addClass('select2');\n\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(select);\n\t\t\t\tmodal.on('click', '.js-change-company', function (e) {\n\t\t\t\t\tAppConnector.request({\n\t\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\t\taction: 'ChangeCompany',\n\t\t\t\t\t\trecord: modal.find('#companyId').val()\n\t\t\t\t\t}).done((data) => {\n\t\t\t\t\t\twindow.location.href = 'index.php';\n\t\t\t\t\t});\n\t\t\t\t\te.preventDefault();\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Show left scrollbar for menu.\n\t\t */\n\t\tregisterScrolbarToMenu() {\n\t\t\tconst container = $('.js-base-container'),\n\t\t\t\tmenuContainer = container.find('.js-menu--scroll');\n\t\t\tapp.showNewScrollbarLeft(menuContainer, { suppressScrollX: true });\n\t\t},\n\t\t/**\n\t\t * Pin menu\n\t\t */\n\t\tregisterPinEvent: function () {\n\t\t\tconst container = $('.js-base-container');\n\t\t\tlet pinButton = container.find('.js-menu--pin');\n\t\t\tpinButton.on('click', () => {\n\t\t\t\tlet hideMenu = 0;\n\t\t\t\tif (pinButton.attr('data-show') === '0') {\n\t\t\t\t\thideMenu = 1;\n\t\t\t\t\tpinButton.removeClass('u-opacity-muted');\n\t\t\t\t\tcontainer.addClass('c-menu--open');\n\t\t\t\t} else {\n\t\t\t\t\tpinButton.addClass('u-opacity-muted');\n\t\t\t\t\tcontainer.removeClass('c-menu--open');\n\t\t\t\t}\n\t\t\t\tpinButton.attr('data-show', hideMenu);\n\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tmodule: 'Users',\n\t\t\t\t\taction: 'UserPreferences',\n\t\t\t\t\tkey: 'menuPin',\n\t\t\t\t\tvalue: hideMenu\n\t\t\t\t}).done((response) => {\n\t\t\t\t\tif (response.success) {\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: app.translate('JS_SAVE_NOTIFY_SUCCESS'),\n\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tcontainer.addClass('c-menu--animation');\n\t\t\t\t}, 300);\n\t\t\t});\n\t\t},\n\t\tregisterEvents: function () {\n\t\t\tvar thisInstance = this;\n\t\t\tthisInstance.recentPageViews();\n\t\t\tthisInstance.registerChangeCompany();\n\t\t\tthisInstance.registerScrolbarToMenu();\n\t\t\tthisInstance.registerPinEvent();\n\t\t\tApp.Fields.Tree.getInstance();\n\t\t}\n\t}\n);\njQuery(document).ready(function () {\n\tBase_Header_Js.getInstance().registerEvents();\n});\n"],"names":["jQuery","Class","self","getInstance","Base_Header_Js","recentPageViews","thisInstance","BtnText","BtnLink","key","history","localStorage","getItem","sp","toString","split","item","length","htmlContent","date","Date","getTime","howManyDays","writeSelector","i","d","t","setTime","hours","app","formatDateZ","getHours","minutes","getMinutes","howManyDaysFromDate","translate","formatDate","$","val","Label","getHistoryLabel","document","URL","push","splice","setItem","join","stack","Array","after","registerClearHistory","label","each","text","replace","click","removeItem","html","registerChangeCompany","on","relatedTarget","modal","target","select","find","addClass","App","Fields","Picklist","showSelect2ElementView","e","AppConnector","request","module","getModuleName","action","record","done","window","location","href","preventDefault","registerScrolbarToMenu","container","menuContainer","showNewScrollbarLeft","suppressScrollX","registerPinEvent","pinButton","hideMenu","attr","removeClass","value","response","success","showNotify","type","setTimeout","registerEvents","Tree","ready"],"mappings":"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"}