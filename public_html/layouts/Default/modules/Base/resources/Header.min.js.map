{"version":3,"file":"Header.min.js","sources":["Header.js"],"sourcesContent":["/**\n * Base header class\n *\n * @copyright YetiForce S.A.\n * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n */\n'use strict';\n\njQuery.Class(\n\t'Base_Header_Js',\n\t{\n\t\tself: false,\n\t\tgetInstance: function () {\n\t\t\tif (this.self != false) {\n\t\t\t\treturn this.self;\n\t\t\t}\n\t\t\tthis.self = new Base_Header_Js();\n\t\t\treturn this.self;\n\t\t}\n\t},\n\t{\n\t\trecentPageViews: function () {\n\t\t\tvar thisInstance = this;\n\t\t\tvar maxValues = 20;\n\t\t\tvar BtnText = '';\n\t\t\tvar BtnLink = 'javascript:void();';\n\t\t\tvar key = 'yf_history_portal_';\n\t\t\tvar history = localStorage.getItem(key);\n\t\t\tif (history != '' && history != null) {\n\t\t\t\tvar sp = history.toString().split('_|_');\n\t\t\t\tvar item = sp[sp.length - 1].toString().split('|');\n\t\t\t\tBtnText = item[0];\n\t\t\t\tBtnLink = item[1];\n\t\t\t}\n\t\t\tvar htmlContent = '<ul class=\"dropdown-menu float-right historyList px-3\" role=\"menu\">';\n\t\t\tvar date = new Date().getTime();\n\t\t\tvar howManyDays = -1;\n\t\t\tvar writeSelector = true;\n\t\t\tif (sp != null) {\n\t\t\t\tfor (var i = sp.length - 1; i >= 0; i--) {\n\t\t\t\t\titem = sp[i].toString().split('|');\n\t\t\t\t\tvar d = new Date();\n\t\t\t\t\tvar t = '';\n\t\t\t\t\tif (item[2] != undefined) {\n\t\t\t\t\t\td.setTime(item[2]);\n\t\t\t\t\t\tvar hours = app.formatDateZ(d.getHours());\n\t\t\t\t\t\tvar minutes = app.formatDateZ(d.getMinutes());\n\t\t\t\t\t\tif (writeSelector && howManyDays != app.howManyDaysFromDate(d)) {\n\t\t\t\t\t\t\thowManyDays = app.howManyDaysFromDate(d);\n\t\t\t\t\t\t\tif (howManyDays == 0) {\n\t\t\t\t\t\t\t\thtmlContent += '<li class=\"selectorHistory\">' + app.translate('JS_TODAY') + '</li>';\n\t\t\t\t\t\t\t} else if (howManyDays == 1) {\n\t\t\t\t\t\t\t\thtmlContent += '<li class=\"selectorHistory\">' + app.translate('JS_YESTERDAY') + '</li>';\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\thtmlContent += '<li class=\"selectorHistory\">' + app.translate('JS_OLDER') + '</li>';\n\t\t\t\t\t\t\t\twriteSelector = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (writeSelector) t = '<span class=\"historyHour\">' + hours + ':' + minutes + '</span> | ';\n\t\t\t\t\t\telse t = app.formatDate(d) + ' | ';\n\t\t\t\t\t}\n\t\t\t\t\tvar format = $('#userDateFormat').val() + '' + $('#userDateFormat').val();\n\t\t\t\t\thtmlContent += ' <a class=\"item dropdown-item\" href=\"' + item[1] + '\">' + t + item[0] + '</a>';\n\t\t\t\t}\n\t\t\t\tvar Label = this.getHistoryLabel();\n\t\t\t\tif (Label.length > 1 && document.URL != BtnLink) {\n\t\t\t\t\tsp.push(this.getHistoryLabel() + '|' + document.URL + '|' + date);\n\t\t\t\t}\n\t\t\t\tif (sp.length >= maxValues) {\n\t\t\t\t\tsp.splice(0, 1);\n\t\t\t\t}\n\t\t\t\tlocalStorage.setItem(key, sp.join('_|_'));\n\t\t\t} else {\n\t\t\t\tvar stack = new Array();\n\t\t\t\tvar Label = this.getHistoryLabel();\n\t\t\t\tif (Label.length > 1) {\n\t\t\t\t\tstack.push(this.getHistoryLabel() + '|' + document.URL + '|' + date);\n\t\t\t\t\tlocalStorage.setItem(key, stack.join('_|_'));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (history != null) {\n\t\t\t\thtmlContent +=\n\t\t\t\t\t'<div class=\"dropdown-divider\"></div><a class=\"dropdown-item clearHistory\" href=\"#\">' +\n\t\t\t\t\tapp.translate('JS_CLEAR_HISTORY') +\n\t\t\t\t\t'</a>';\n\t\t\t} else {\n\t\t\t\thtmlContent +=\n\t\t\t\t\t' <a class=\"item dropdown-item\" href=\"#\" role=\"listitem\">' + app.translate('JS_NO_RECORDS') + '</a>';\n\t\t\t}\n\n\t\t\thtmlContent += '</ul>';\n\t\t\t$('.showHistoryBtn').after(htmlContent);\n\t\t\tthis.registerClearHistory();\n\t\t},\n\t\tgetHistoryLabel: function () {\n\t\t\tvar label = '';\n\t\t\t$('.breadcrumbsLinks span').each(function (index) {\n\t\t\t\tlabel += $(this).text().replace(/\\//g, ' ');\n\t\t\t});\n\t\t\treturn label;\n\t\t},\n\t\tregisterClearHistory: function () {\n\t\t\t$('.historyBtn .clearHistory').click(function () {\n\t\t\t\tvar key = 'yf_history_portal_';\n\t\t\t\tlocalStorage.removeItem(key);\n\t\t\t\tvar htmlContent =\n\t\t\t\t\t'<a class=\"item dropdown-item\" href=\"#\" role=\"listitem\">' + app.translate('JS_NO_RECORDS') + '</a>';\n\t\t\t\t$('.historyBtn .dropdown-menu').html(htmlContent);\n\t\t\t});\n\t\t},\n\t\tregisterChangeCompany: function () {\n\t\t\t$('#modalSelectCompanies').on('show.bs.modal', function (relatedTarget) {\n\t\t\t\tlet modal = $(relatedTarget.target);\n\t\t\t\tlet select = modal.find('select').addClass('select2');\n\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(select);\n\t\t\t\tmodal.on('click', '.js-change-company', function (e) {\n\t\t\t\t\tAppConnector.request({\n\t\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\t\taction: 'ChangeCompany',\n\t\t\t\t\t\trecord: modal.find('#companyId').val()\n\t\t\t\t\t}).done((data) => {\n\t\t\t\t\t\twindow.location.href = 'index.php';\n\t\t\t\t\t});\n\t\t\t\t\te.preventDefault();\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Show left scrollbar for menu.\n\t\t */\n\t\tregisterScrolbarToMenu() {\n\t\t\tconst container = $('.js-base-container'),\n\t\t\t\tmenuContainer = container.find('.js-menu--scroll');\n\t\t\tapp.showNewScrollbarLeft(menuContainer, { suppressScrollX: true });\n\t\t},\n\t\t/**\n\t\t * Pin menu\n\t\t */\n\t\tregisterPinEvent: function () {\n\t\t\tconst container = $('.js-base-container');\n\t\t\tlet pinButton = container.find('.js-menu--pin');\n\t\t\tpinButton.on('click', () => {\n\t\t\t\tlet hideMenu = 0;\n\t\t\t\tif (pinButton.attr('data-show') === '0') {\n\t\t\t\t\thideMenu = 1;\n\t\t\t\t\tpinButton.removeClass('u-opacity-muted');\n\t\t\t\t\tcontainer.addClass('c-menu--open');\n\t\t\t\t} else {\n\t\t\t\t\tpinButton.addClass('u-opacity-muted');\n\t\t\t\t\tcontainer.removeClass('c-menu--open');\n\t\t\t\t}\n\t\t\t\tpinButton.attr('data-show', hideMenu);\n\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tmodule: 'Users',\n\t\t\t\t\taction: 'UserPreferences',\n\t\t\t\t\tkey: 'menuPin',\n\t\t\t\t\tvalue: hideMenu\n\t\t\t\t}).done((response) => {\n\t\t\t\t\tif (response.success) {\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: app.translate('JS_SAVE_NOTIFY_SUCCESS'),\n\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tcontainer.addClass('c-menu--animation');\n\t\t\t\t}, 300);\n\t\t\t});\n\t\t},\n\t\tregisterEvents: function () {\n\t\t\tvar thisInstance = this;\n\t\t\tthisInstance.recentPageViews();\n\t\t\tthisInstance.registerChangeCompany();\n\t\t\tthisInstance.registerScrolbarToMenu();\n\t\t\tthisInstance.registerPinEvent();\n\t\t\tApp.Fields.Tree.getInstance();\n\t\t}\n\t}\n);\njQuery(document).ready(function () {\n\tBase_Header_Js.getInstance().registerEvents();\n});\n"],"names":["jQuery","Class","self","getInstance","recentPageViews","BtnLink","key","history","localStorage","getItem","sp","toString","split","item","length","BtnText","htmlContent","date","getTime","howManyDays","writeSelector","i","t","d","setTime","app","formatDateZ","getHours","minutes","getMinutes","howManyDaysFromDate","translate","hours","formatDate","$","val","getHistoryLabel","Label","document","URL","push","splice","setItem","join","stack","after","registerClearHistory","label","each","text","replace","click","removeItem","html","registerChangeCompany","on","relatedTarget","target","select","modal","find","addClass","App","Fields","Picklist","showSelect2ElementView","e","AppConnector","request","module","getModuleName","action","record","done","window","location","href","preventDefault","registerScrolbarToMenu","menuContainer","container","showNewScrollbarLeft","suppressScrollX","registerPinEvent","pinButton","attr","hideMenu","removeClass","value","response","success","showNotify","type","setTimeout","registerEvents","thisInstance","Tree","ready","Base_Header_Js"],"mappings":"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"}