'use strict';

/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */jQuery.Class('Base_EditView_Js',{},{container:!1,getContainer:function getContainer(){return !1==this.container&&(this.container=jQuery('.mainContent')),this.container},referenceModulePopupRegisterEvent:function referenceModulePopupRegisterEvent(container){var thisInstance=this;container==null&&(container=this.getContainer()),container.on('click','.relatedPopup',function(e){var element=jQuery(e.currentTarget),containerField=element.closest('.fieldValue'),url='index.php?module='+thisInstance.getReferencedModuleName(containerField)+'&view=RecordList';app.getRecordList(url,function(selectedItems){thisInstance.setReferenceFieldValue(containerField,selectedItems);});}),container.find('.referenceModulesList').on('change',function(e){var element=jQuery(e.currentTarget),parentElem=element.closest('.fieldValue'),popupReferenceModule=element.val(),referenceModuleElement=jQuery('input[name="popupReferenceModule"]',parentElem),prevSelectedReferenceModule=referenceModuleElement.val();referenceModuleElement.val(popupReferenceModule),prevSelectedReferenceModule!=popupReferenceModule&&parentElem.find('.clearReferenceSelection').trigger('click');});},getReferencedModuleName:function getReferencedModuleName(parenElement){return jQuery('input[name="popupReferenceModule"]',parenElement).val()},registerClearReferenceSelectionEvent:function registerClearReferenceSelectionEvent(container){var thisInstance=this;container.on('click','.clearReferenceSelection',function(e){var element=jQuery(e.currentTarget);thisInstance.clearFieldValue(element),e.preventDefault();});},clearFieldValue:function clearFieldValue(element){var fieldValueContener=element.closest('.fieldValue'),fieldNameElement=fieldValueContener.find('.sourceField'),fieldName=fieldNameElement.attr('name');fieldNameElement.val(''),fieldValueContener.find('#'+fieldName+'_display').removeAttr('readonly').val('');},setReferenceFieldValue:function setReferenceFieldValue(container,params){var sourceField=container.find('input.sourceField').attr('name'),fieldElement=container.find('input[name="'+sourceField+'"]'),fieldDisplayElement=container.find('input[name="'+(sourceField+'_display')+'"]'),selectedName=params.name,id=params.id;fieldElement.val(id),fieldDisplayElement.val(selectedName).attr('readonly',!0);},registerValidationsFields:function registerValidationsFields(container){var params=app.validationEngineOptions;container.validationEngine(params);},registerMaskFields:function registerMaskFields(container){container.find(':input').inputmask();},registerRecordSave:function registerRecordSave(container){var formElement=container.find('form');formElement.on('submit',function(e){if(!0===formElement.validationEngine('validate')){e.preventDefault();var form=jQuery(e.currentTarget),formData=form.serializeFormData();AppConnector.request(formData).done(function(data){var data=JSON.parse(data),response=data.result;response.id?window.location.href='index.php?module='+app.getModuleName()+'&view=DetailView&record='+response.id:alert(response.message);});}else app.formAlignmentAfterValidation(formElement);});},registerTree:function registerTree(){var container=this.getContainer();container.find('.js-tree-select').on('click',function(){var containerField=$(this).closest('.js-tree-content'),treeValueField=containerField.find('.js-tree-value'),fieldDisplayElement=containerField.find('input[name="'+treeValueField.attr('name')+'_display"]'),multiple=treeValueField.data('multiple');app.showModalWindow(containerField.find('.js-tree-modal-window').clone(),function(modalContainer){var jstreeInstance=modalContainer.find('.js-tree-jstree');1===multiple?new window.App.Fields.MultiTree(jstreeInstance):new window.App.Fields.Tree(jstreeInstance),modalContainer.find('.js-tree-modal-select').on('click',function(){var selectedCategories=[];$.each(jstreeInstance.jstree('get_selected',!0),function(index,value){selectedCategories.push(value);});var treeText=[],treeValue=[];$.each(selectedCategories,function(index,value){treeValue.push(value.original.tree),treeText.push(value.text);}),fieldDisplayElement.val(treeText.join(',')),fieldDisplayElement.attr('readonly',!0),treeValueField.val(treeValue.join(',')),app.hideModalWindow();});});}),container.find('.js-tree-clear').on('click',function(){var containerField=$(this).closest('.js-tree-content'),treeValueField=containerField.find('.js-tree-value'),fieldDisplayElement=containerField.find('input[name="'+treeValueField.attr('name')+'_display"]');fieldDisplayElement.val(''),fieldDisplayElement.attr('readonly',!1),treeValueField.val('');});},registerEvents:function registerEvents(){var container=this.getContainer();container.find('form').validationEngine(app.validationEngineOptions),this.referenceModulePopupRegisterEvent(),this.registerClearReferenceSelectionEvent(container),this.registerValidationsFields(container),this.registerMaskFields(container),this.registerRecordSave(container),this.registerTree();}});
//# sourceMappingURL=EditView.min.js.map
