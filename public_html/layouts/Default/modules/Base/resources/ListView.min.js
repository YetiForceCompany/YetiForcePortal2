'use strict';

/**
 * Base list view class
 *
 * @copyright YetiForce S.A.
 * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)
 * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>
 */'use strict';function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)descriptor=props[i],descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor);}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}window.Base_ListView_Js=/*#__PURE__*/function(){function _class(){_classCallCheck(this,_class);}return _createClass(_class,[{key:"registerDataTable",value:/**
	 * Register data table
	 */function registerDataTable(){var _this=this;this.dataTable=app.registerDataTables(this.table,{order:[],processing:!0,serverSide:!0,searching:!1,orderCellsTop:!0,deferRender:!0,ajax:{url:"index.php",type:"POST",data:function data(_data){$.extend(_data,_this.listForm.serializeFormData());},error:function error(jqXHR,ajaxOptions,thrownError){app.errorLog(jqXHR,thrownError),app.showNotify({text:thrownError,type:"error",stack:window.stackPage});}}}),console.log(this.listForm.find("input,select")),this.listForm.find("input,select").on("change",function(e){console.log(11),console.log(e),_this.dataTable.ajax.reload();});}/**
	 * Register records events
	 */},{key:"registerListEvents",value:function registerListEvents(){var _this2=this,self=this;this.table.on("click",".js-delete-record",function(e){var url=$(e.currentTarget).data("url");app.showNotifyConfirm({title:app.translate("JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_DELETE")},function(){AppConnector.request({data:{},url:url}).done(function(data){data.result&&self.dataTable.ajax.reload();});});}),this.table.on("click",".js-search-records",function(){_this2.dataTable.ajax.reload();}),this.table.on("click",".js-clear-search",function(){_this2.table.find(".js-filter-field").each(function(){this.value="";}),_this2.dataTable.ajax.reload();}),this.table.on("click","tbody tr",function(e){var clickedElement=$(e.target),rowElement=jQuery(this);clickedElement.closest("div").parent().is(".actions, .dropdown-menu")||0<clickedElement.closest("a").length||(window.location.href=rowElement.find(".js-detail-view").attr("href"));});}/**
	 * Register custom view event
	 */},{key:"registerCustomView",value:function registerCustomView(){var _this3=this,customFilter=this.listForm.find(".js-cv-list");App.Fields.Picklist.showSelect2ElementView(customFilter),customFilter.on("change",function(e){console.log(22),console.log(e);}),this.listForm.on("click",".js-filter-tab",function(e){$.progressIndicatorShow(),_this3.container.find("[name=\"cvId\"]").val(e.currentTarget.dataset.cvid),_this3.reloadView(!1);});}/**
	 * Reload view
	 * @param   {boolean}  onlyData
	 */},{key:"reloadView",value:function reloadView(){var onlyData=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];onlyData?this.dataTable.ajax.reload():window.location.href=app.convertObjectToUrl({module:this.container.find("#module").val(),view:this.container.find("#view").val(),cvId:this.container.find("[name=\"cvId\"]").val()});}/**
	 * Register tree.
	 */},{key:"registerTree",value:function registerTree(){this.listForm.find(".js-tree-select").on("click",function(e){var containerField=$(e.currentTarget).closest(".js-tree-content"),treeValueField=containerField.find(".js-tree-value"),fieldDisplayElement=containerField.find("input[data-display=\"".concat(treeValueField.attr("date-field-name"),"\"]")),multiple=treeValueField.data("multiple");app.showModalWindow(containerField.find(".js-tree-modal-window").clone(),function(modalContainer){var jstreeInstance=modalContainer.find(".js-tree-jstree");1===multiple?new window.App.Fields.MultiTree(jstreeInstance):new window.App.Fields.Tree(jstreeInstance),modalContainer.find(".js-tree-modal-select").on("click",function(){var selectedCategories=[];$.each(jstreeInstance.jstree("get_selected",!0),function(index,value){selectedCategories.push(value);});var treeText=[],treeValue=[];$.each(selectedCategories,function(index,value){treeValue.push(value.original.tree),treeText.push(value.text);}),fieldDisplayElement.val(treeText.join(",")),fieldDisplayElement.attr("readonly",!0),console.log(treeValue.join(",")),treeValueField.val(treeValue.join(",")),treeValueField.trigger("change"),app.hideModalWindow();});});}),this.listForm.find(".js-tree-clear").on("click",function(e){var containerField=$(e.currentTarget).closest(".js-tree-content"),treeValueField=containerField.find(".js-tree-value"),fieldDisplayElement=containerField.find("input[data-display=\"".concat(treeValueField.attr("date-field-name"),"\"]"));fieldDisplayElement.val(""),fieldDisplayElement.attr("readonly",!1),treeValueField.val(""),treeValueField.trigger("change");});}/**
	 * Register keyboard shortcuts events
	 */},{key:"registerKeyboardShortcutsEvent",value:function registerKeyboardShortcutsEvent(){document.addEventListener("keydown",function(event){event.altKey&&"KeyA"===event.code&&$(".js-add-record").length&&(window.location.href="index.php?module="+app.getModuleName()+"&view=EditView");});}/**
	 * Register modal events.
	 */},{key:"registerEvents",value:function registerEvents(){this.container=$("#page"),this.listForm=$(".js-form-container"),this.table=this.listForm.find(".js-list-view-table"),this.registerDataTable(),this.registerListEvents(),this.registerTree(),this.registerCustomView(),this.registerKeyboardShortcutsEvent();}}]),_class}();
//# sourceMappingURL=ListView.min.js.map
