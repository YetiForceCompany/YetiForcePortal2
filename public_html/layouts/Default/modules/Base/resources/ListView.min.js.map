{"version":3,"file":"ListView.min.js","sources":["ListView.js"],"sourcesContent":["/**\n * Base list view class\n *\n * @copyright YetiForce Sp. z o.o.\n * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n */\n'use strict';\n\nwindow.Base_ListView_Js = class {\n\t/**\n\t * Register data table\n\t */\n\tregisterDataTable() {\n\t\tthis.dataTable = app.registerDataTables(this.table, {\n\t\t\torder: [],\n\t\t\tprocessing: true,\n\t\t\tserverSide: true,\n\t\t\tsearching: false,\n\t\t\torderCellsTop: true,\n\t\t\tdeferRender: true,\n\t\t\tajax: {\n\t\t\t\turl: 'index.php',\n\t\t\t\ttype: 'POST',\n\t\t\t\tdata: (data) => {\n\t\t\t\t\t$.extend(data, this.listForm.serializeFormData());\n\t\t\t\t},\n\t\t\t\terror: function (jqXHR, ajaxOptions, thrownError) {\n\t\t\t\t\tapp.errorLog(jqXHR, thrownError);\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttext: thrownError,\n\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\tstack: window.stackPage\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.listForm.find('input,select').on('change', () => {\n\t\t\tthis.dataTable.ajax.reload();\n\t\t});\n\t}\n\t/**\n\t * Register records events\n\t */\n\tregisterListEvents() {\n\t\tconst self = this;\n\t\tthis.table.on('click', '.js-delete-record', (e) => {\n\t\t\tapp.showNotifyConfirm(\n\t\t\t\t{\n\t\t\t\t\ttitle: app.translate('JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_DELETE')\n\t\t\t\t},\n\t\t\t\tfunction () {\n\t\t\t\t\tAppConnector.request({\n\t\t\t\t\t\tdata: {},\n\t\t\t\t\t\turl: $(e.currentTarget).data('url')\n\t\t\t\t\t}).done((data) => {\n\t\t\t\t\t\tif (data.result) {\n\t\t\t\t\t\t\tself.dataTable.ajax.reload();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t\tthis.table.on('click', '.js-search-records', () => {\n\t\t\tthis.dataTable.ajax.reload();\n\t\t});\n\t\tthis.table.on('click', '.js-clear-search', () => {\n\t\t\tthis.table.find('.js-filter-field').each(function () {\n\t\t\t\tthis.value = '';\n\t\t\t});\n\t\t\tthis.dataTable.ajax.reload();\n\t\t});\n\t\tthis.table.on('click', 'tbody tr', function () {\n\t\t\tlet element = jQuery(this);\n\t\t\tif (element.prop('tagName') !== 'A') {\n\t\t\t\twindow.location.href = element.find('.js-detail-view').attr('href');\n\t\t\t}\n\t\t});\n\t}\n\t/**\n\t * Register custom view event\n\t */\n\tregisterCustomView() {\n\t\tlet customFilter = this.listForm.find('.js-cv-list');\n\t\tApp.Fields.Picklist.showSelect2ElementView(customFilter);\n\t\tcustomFilter.on('change', (_) => {\n\t\t\t$.progressIndicatorShow();\n\t\t\tthis.reloadView(false);\n\t\t});\n\t\tthis.listForm.on('click', '.js-filter-tab', (e) => {\n\t\t\t$.progressIndicatorShow();\n\t\t\tthis.container.find('[name=\"cvId\"]').val(e.currentTarget.dataset.cvid);\n\t\t\tthis.reloadView(false);\n\t\t});\n\t}\n\t/**\n\t * Reload view\n\t * @param   {boolean}  onlyData\n\t */\n\treloadView(onlyData = true) {\n\t\tif (onlyData) {\n\t\t\tthis.dataTable.ajax.reload();\n\t\t} else {\n\t\t\twindow.location.href = app.convertObjectToUrl({\n\t\t\t\tmodule: this.container.find('#module').val(),\n\t\t\t\tview: this.container.find('#view').val(),\n\t\t\t\tcvId: this.container.find('[name=\"cvId\"]').val()\n\t\t\t});\n\t\t}\n\t}\n\t/**\n\t * Register tree.\n\t */\n\tregisterTree() {\n\t\tthis.listForm.find('.js-tree-select').on('click', (e) => {\n\t\t\tlet containerField = $(e.currentTarget).closest('.js-tree-content'),\n\t\t\t\ttreeValueField = containerField.find('.js-tree-value'),\n\t\t\t\tfieldDisplayElement = containerField.find(`input[data-display=\"${treeValueField.attr('date-field-name')}\"]`),\n\t\t\t\tmultiple = treeValueField.data('multiple');\n\t\t\tapp.showModalWindow(containerField.find('.js-tree-modal-window').clone(), function (modalContainer) {\n\t\t\t\tlet jstreeInstance = modalContainer.find('.js-tree-jstree');\n\t\t\t\tif (multiple === 1) {\n\t\t\t\t\tnew window.App.Fields.MultiTree(jstreeInstance);\n\t\t\t\t} else {\n\t\t\t\t\tnew window.App.Fields.Tree(jstreeInstance);\n\t\t\t\t}\n\t\t\t\tmodalContainer.find('.js-tree-modal-select').on('click', function () {\n\t\t\t\t\tlet selectedCategories = [];\n\t\t\t\t\t$.each(jstreeInstance.jstree('get_selected', true), (index, value) => {\n\t\t\t\t\t\tselectedCategories.push(value);\n\t\t\t\t\t});\n\t\t\t\t\tlet treeText = [];\n\t\t\t\t\tlet treeValue = [];\n\t\t\t\t\t$.each(selectedCategories, (index, value) => {\n\t\t\t\t\t\ttreeValue.push(value['original']['tree']);\n\t\t\t\t\t\ttreeText.push(value['text']);\n\t\t\t\t\t});\n\t\t\t\t\tfieldDisplayElement.val(treeText.join(','));\n\t\t\t\t\tfieldDisplayElement.attr('readonly', true);\n\t\t\t\t\tconsole.log(treeValue.join(','));\n\t\t\t\t\ttreeValueField.val(treeValue.join(','));\n\t\t\t\t\ttreeValueField.trigger('change');\n\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\tthis.listForm.find('.js-tree-clear').on('click', (e) => {\n\t\t\tlet containerField = $(e.currentTarget).closest('.js-tree-content'),\n\t\t\t\ttreeValueField = containerField.find('.js-tree-value'),\n\t\t\t\tfieldDisplayElement = containerField.find(`input[data-display=\"${treeValueField.attr('date-field-name')}\"]`);\n\t\t\tfieldDisplayElement.val('');\n\t\t\tfieldDisplayElement.attr('readonly', false);\n\t\t\ttreeValueField.val('');\n\t\t\ttreeValueField.trigger('change');\n\t\t});\n\t}\n\t/**\n\t * Register modal events.\n\t */\n\tregisterEvents() {\n\t\tthis.container = $('#page');\n\t\tthis.listForm = $('.js-form-container');\n\t\tthis.table = this.listForm.find('.js-list-view-table');\n\t\tthis.registerDataTable();\n\t\tthis.registerListEvents();\n\t\tthis.registerTree();\n\t\tthis.registerCustomView();\n\t}\n};\n"],"names":["window","Base_ListView_Js","dataTable","app","registerDataTables","table","order","processing","serverSide","searching","orderCellsTop","deferRender","ajax","url","type","data","$","extend","listForm","serializeFormData","error","jqXHR","ajaxOptions","thrownError","errorLog","showNotify","text","stack","stackPage","find","on","reload","self","e","showNotifyConfirm","title","translate","AppConnector","request","currentTarget","done","result","each","value","jQuery","prop","location","href","element","attr","customFilter","App","Fields","Picklist","showSelect2ElementView","progressIndicatorShow","reloadView","container","val","dataset","cvid","onlyData","convertObjectToUrl","module","view","cvId","closest","treeValueField","containerField","fieldDisplayElement","multiple","showModalWindow","clone","modalContainer","MultiTree","jstreeInstance","Tree","jstree","index","selectedCategories","push","treeValue","treeText","join","console","log","trigger","hideModalWindow","registerDataTable","registerListEvents","registerTree","registerCustomView"],"mappings":"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"}