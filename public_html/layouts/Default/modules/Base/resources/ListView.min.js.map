{"version":3,"file":"ListView.min.js","sources":["ListView.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nwindow.Base_ListView_Js = class {\n\t/**\n\t * Register data table\n\t */\n\tregisterDataTable() {\n\t\tthis.dataTable = app.registerDataTables(this.table, {\n\t\t\torder: [],\n\t\t\tprocessing: true,\n\t\t\tserverSide: true,\n\t\t\tsearching: false,\n\t\t\torderCellsTop: true,\n\t\t\tdeferRender: true,\n\t\t\tajax: {\n\t\t\t\turl: 'index.php',\n\t\t\t\ttype: 'POST',\n\t\t\t\tdata: (data) => {\n\t\t\t\t\t$.extend(data, this.listForm.serializeFormData());\n\t\t\t\t},\n\t\t\t\terror: function (jqXHR, ajaxOptions, thrownError) {\n\t\t\t\t\tapp.errorLog(jqXHR, thrownError);\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttext: thrownError,\n\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\tstack: window.stackPage\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.listForm.find('input,select').on('change', () => {\n\t\t\tthis.dataTable.ajax.reload();\n\t\t});\n\t}\n\t/**\n\t * Register records events\n\t */\n\tregisterListEvents() {\n\t\tconst self = this;\n\t\tthis.table.on('click', '.js-delete-record', (e) => {\n\t\t\tapp.showNotifyConfirm(\n\t\t\t\t{\n\t\t\t\t\ttitle: app.translate('JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_DELETE')\n\t\t\t\t},\n\t\t\t\tfunction () {\n\t\t\t\t\tAppConnector.request({\n\t\t\t\t\t\tdata: {},\n\t\t\t\t\t\turl: $(e.currentTarget).data('url')\n\t\t\t\t\t}).done((data) => {\n\t\t\t\t\t\tif (data.result) {\n\t\t\t\t\t\t\tself.dataTable.ajax.reload();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t\tthis.table.on('click', '.js-search-records', () => {\n\t\t\tthis.dataTable.ajax.reload();\n\t\t});\n\t\tthis.table.on('click', '.js-clear-search', () => {\n\t\t\tthis.table.find('.js-filter-field').each(function () {\n\t\t\t\tthis.value = '';\n\t\t\t});\n\t\t\tthis.dataTable.ajax.reload();\n\t\t});\n\t}\n\t/**\n\t * Register custom view event\n\t */\n\tregisterCustomView() {\n\t\tlet customFiltr = this.listForm.find('.js-cv-list');\n\t\tApp.Fields.Picklist.showSelect2ElementView(customFiltr);\n\t\tcustomFiltr.on('change', (_) => {\n\t\t\t$.progressIndicatorShow();\n\t\t\tthis.reloadView();\n\t\t});\n\t\tthis.listForm.on('click', '.js-filter-tab', (e) => {\n\t\t\t$.progressIndicatorShow();\n\t\t\tthis.container.find('[name=\"cvId\"]').val(e.currentTarget.dataset.cvid);\n\t\t\tthis.reloadView();\n\t\t});\n\t}\n\t/**\n\t * Reload view\n\t */\n\treloadView() {\n\t\tlet data = {\n\t\t\tmodule: this.container.find('#module').val(),\n\t\t\tview: this.container.find('#view').val(),\n\t\t\tcvId: this.container.find('[name=\"cvId\"]').val()\n\t\t};\n\t\twindow.location.href = app.convertObjectToUrl(data);\n\t}\n\t/**\n\t * Register tree.\n\t */\n\tregisterTree() {\n\t\tthis.listForm.find('.js-tree-select').on('click', (e) => {\n\t\t\tlet containerField = $(e.currentTarget).closest('.js-tree-content'),\n\t\t\t\ttreeValueField = containerField.find('.js-tree-value'),\n\t\t\t\tfieldDisplayElement = containerField.find(`input[data-display=\"${treeValueField.attr('date-field-name')}\"]`),\n\t\t\t\tmultiple = treeValueField.data('multiple');\n\t\t\tapp.showModalWindow(containerField.find('.js-tree-modal-window').clone(), function (modalContainer) {\n\t\t\t\tlet jstreeInstance = modalContainer.find('.js-tree-jstree');\n\t\t\t\tif (multiple === 1) {\n\t\t\t\t\tnew window.App.Fields.MultiTree(jstreeInstance);\n\t\t\t\t} else {\n\t\t\t\t\tnew window.App.Fields.Tree(jstreeInstance);\n\t\t\t\t}\n\t\t\t\tmodalContainer.find('.js-tree-modal-select').on('click', function () {\n\t\t\t\t\tlet selectedCategories = [];\n\t\t\t\t\t$.each(jstreeInstance.jstree('get_selected', true), (index, value) => {\n\t\t\t\t\t\tselectedCategories.push(value);\n\t\t\t\t\t});\n\t\t\t\t\tlet treeText = [];\n\t\t\t\t\tlet treeValue = [];\n\t\t\t\t\t$.each(selectedCategories, (index, value) => {\n\t\t\t\t\t\ttreeValue.push(value['original']['tree']);\n\t\t\t\t\t\ttreeText.push(value['text']);\n\t\t\t\t\t});\n\t\t\t\t\tfieldDisplayElement.val(treeText.join(','));\n\t\t\t\t\tfieldDisplayElement.attr('readonly', true);\n\t\t\t\t\tconsole.log(treeValue.join(','));\n\t\t\t\t\ttreeValueField.val(treeValue.join(','));\n\t\t\t\t\ttreeValueField.trigger('change');\n\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\tthis.listForm.find('.js-tree-clear').on('click', (e) => {\n\t\t\tlet containerField = $(e.currentTarget).closest('.js-tree-content'),\n\t\t\t\ttreeValueField = containerField.find('.js-tree-value'),\n\t\t\t\tfieldDisplayElement = containerField.find(`input[data-display=\"${treeValueField.attr('date-field-name')}\"]`);\n\t\t\tfieldDisplayElement.val('');\n\t\t\tfieldDisplayElement.attr('readonly', false);\n\t\t\ttreeValueField.val('');\n\t\t\ttreeValueField.trigger('change');\n\t\t});\n\t}\n\t/**\n\t * Register modal events.\n\t */\n\tregisterEvents() {\n\t\tthis.container = $('#page');\n\t\tthis.listForm = $('.js-form-container');\n\t\tthis.table = this.listForm.find('.js-list-view-table');\n\t\tthis.registerDataTable();\n\t\tthis.registerListEvents();\n\t\tthis.registerTree();\n\t\tthis.registerCustomView();\n\t}\n};\n"],"names":["window","Base_ListView_Js","dataTable","app","registerDataTables","table","order","processing","serverSide","searching","orderCellsTop","deferRender","ajax","url","type","data","$","extend","listForm","serializeFormData","error","jqXHR","ajaxOptions","thrownError","errorLog","showNotify","text","stack","stackPage","find","on","reload","self","e","showNotifyConfirm","title","translate","AppConnector","request","currentTarget","done","result","each","value","customFiltr","App","Fields","Picklist","showSelect2ElementView","progressIndicatorShow","reloadView","container","val","dataset","cvid","module","view","cvId","location","href","convertObjectToUrl","closest","treeValueField","containerField","fieldDisplayElement","attr","multiple","showModalWindow","clone","modalContainer","MultiTree","jstreeInstance","Tree","jstree","index","selectedCategories","push","treeValue","treeText","join","console","log","trigger","hideModalWindow","registerDataTable","registerListEvents","registerTree","registerCustomView"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAGAA,OAAOC,gBAAP;;IAAA,kCAIqB,gBACnB,KAAKC,SAAL,CAAiBC,IAAIC,kBAAJ,CAAuB,KAAKC,KAA5B,CAAmC,CACnDC,MAAO,EAD4C,CAEnDC,aAFmD,CAGnDC,aAHmD,CAInDC,YAJmD,CAKnDC,gBALmD,CAMnDC,cANmD,CAOnDC,KAAM,CACLC,IAAK,WADA,CAELC,KAAM,MAFD,CAGLC,KAAM,cAACA,KAAD,CAAU,CACfC,EAAEC,MAAF,CAASF,KAAT,CAAe,MAAKG,QAAL,CAAcC,iBAAd,EAAf,EACA,CALI,CAMLC,MAAO,eAAUC,KAAV,CAAiBC,WAAjB,CAA8BC,WAA9B,CAA2C,CACjDpB,IAAIqB,QAAJ,CAAaH,KAAb,CAAoBE,WAApB,CADiD,CAEjDpB,IAAIsB,UAAJ,CAAe,CACdC,KAAMH,WADQ,CAEdT,KAAM,OAFQ,CAGda,MAAO3B,OAAO4B,SAHA,CAAf,EAKA,CAbI,CAP6C,CAAnC,CADE,CAwBnB,KAAKV,QAAL,CAAcW,IAAd,CAAmB,cAAnB,EAAmCC,EAAnC,CAAsC,QAAtC,CAAgD,UAAM,CACrD,MAAK5B,SAAL,CAAeU,IAAf,CAAoBmB,MAApB,GACA,CAFD,EAGA,CACD;;mEAGqB,iBACdC,KAAO,IADO,CAEpB,KAAK3B,KAAL,CAAWyB,EAAX,CAAc,OAAd,CAAuB,mBAAvB,CAA4C,SAACG,CAAD,CAAO,CAClD9B,IAAI+B,iBAAJ,CACC,CACCC,MAAOhC,IAAIiC,SAAJ,CAAc,wCAAd,CADR,CADD,CAIC,UAAY,CACXC,aAAaC,OAAb,CAAqB,CACpBvB,KAAM,EADc,CAEpBF,IAAKG,EAAEiB,EAAEM,aAAJ,EAAmBxB,IAAnB,CAAwB,KAAxB,CAFe,CAArB,EAGGyB,IAHH,CAGQ,SAACzB,IAAD,CAAU,CACbA,KAAK0B,MADQ,EAEhBT,KAAK9B,SAAL,CAAeU,IAAf,CAAoBmB,MAApB,GAED,CAPD,EAQA,CAbF,EAeA,CAhBD,CAFoB,CAmBpB,KAAK1B,KAAL,CAAWyB,EAAX,CAAc,OAAd,CAAuB,oBAAvB,CAA6C,UAAM,CAClD,OAAK5B,SAAL,CAAeU,IAAf,CAAoBmB,MAApB,GACA,CAFD,CAnBoB,CAsBpB,KAAK1B,KAAL,CAAWyB,EAAX,CAAc,OAAd,CAAuB,kBAAvB,CAA2C,UAAM,CAChD,OAAKzB,KAAL,CAAWwB,IAAX,CAAgB,kBAAhB,EAAoCa,IAApC,CAAyC,UAAY,CACpD,KAAKC,KAAL,CAAa,GACb,CAFD,CADgD,CAIhD,OAAKzC,SAAL,CAAeU,IAAf,CAAoBmB,MAApB,GACA,CALD,EAMA,CACD;;mEAGqB,iBAChBa,YAAc,KAAK1B,QAAL,CAAcW,IAAd,CAAmB,aAAnB,CADE,CAEpBgB,IAAIC,MAAJ,CAAWC,QAAX,CAAoBC,sBAApB,CAA2CJ,WAA3C,CAFoB,CAGpBA,YAAYd,EAAZ,CAAe,QAAf,CAAyB,UAAO,CAC/Bd,EAAEiC,qBAAF,EAD+B,CAE/B,OAAKC,UAAL,GACA,CAHD,CAHoB,CAOpB,KAAKhC,QAAL,CAAcY,EAAd,CAAiB,OAAjB,CAA0B,gBAA1B,CAA4C,SAACG,CAAD,CAAO,CAClDjB,EAAEiC,qBAAF,EADkD,CAElD,OAAKE,SAAL,CAAetB,IAAf,CAAoB,eAApB,EAAqCuB,GAArC,CAAyCnB,EAAEM,aAAF,CAAgBc,OAAhB,CAAwBC,IAAjE,CAFkD,CAGlD,OAAKJ,UAAL,GACA,CAJD,EAKA,CACD;;mDAGa,CACZ,SAAW,CACVK,OAAQ,KAAKJ,SAAL,CAAetB,IAAf,CAAoB,SAApB,EAA+BuB,GAA/B,EADE,CAEVI,KAAM,KAAKL,SAAL,CAAetB,IAAf,CAAoB,OAApB,EAA6BuB,GAA7B,EAFI,CAGVK,KAAM,KAAKN,SAAL,CAAetB,IAAf,CAAoB,eAApB,EAAqCuB,GAArC,EAHI,CAAX,CAKApD,OAAO0D,QAAP,CAAgBC,IAAhB,CAAuBxD,IAAIyD,kBAAJ,CAAuB7C,IAAvB,EACvB,CACD;;uDAGe,CACd,KAAKG,QAAL,CAAcW,IAAd,CAAmB,iBAAnB,EAAsCC,EAAtC,CAAyC,OAAzC,CAAkD,SAACG,CAAD,CAAO,CACxD,mBAAqBjB,EAAEiB,EAAEM,aAAJ,EAAmBsB,OAAnB,CAA2B,kBAA3B,CAArB,CACCC,eAAiBC,eAAelC,IAAf,CAAoB,gBAApB,CADlB,CAECmC,oBAAsBD,eAAelC,IAAf,wBAA2CiC,eAAeG,IAAf,CAAoB,iBAApB,CAA3C,MAFvB,CAGCC,SAAWJ,eAAe/C,IAAf,CAAoB,UAApB,CAHZ,CAIAZ,IAAIgE,eAAJ,CAAoBJ,eAAelC,IAAf,CAAoB,uBAApB,EAA6CuC,KAA7C,EAApB,CAA0E,SAAUC,cAAV,CAA0B,CACnG,mBAAqBA,eAAexC,IAAf,CAAoB,iBAApB,CAArB,CACiB,CAAb,WAF+F,CAGlG,WAAWgB,GAAP,CAAWC,MAAX,CAAkBwB,SAAtB,CAAgCC,cAAhC,CAHkG,CAKlG,WAAW1B,GAAP,CAAWC,MAAX,CAAkB0B,IAAtB,CAA2BD,cAA3B,CALkG,CAOnGF,eAAexC,IAAf,CAAoB,uBAApB,EAA6CC,EAA7C,CAAgD,OAAhD,CAAyD,UAAY,CACpE,uBAAyB,EAAzB,CACAd,EAAE0B,IAAF,CAAO6B,eAAeE,MAAf,CAAsB,cAAtB,IAAP,CAAoD,SAACC,KAAD,CAAQ/B,KAAR,CAAkB,CACrEgC,mBAAmBC,IAAnB,CAAwBjC,KAAxB,EACA,CAFD,CAFoE,cAKrD,EALqD,CAMhEkC,UAAY,EANoD,CAOpE7D,EAAE0B,IAAF,CAAOiC,kBAAP,CAA2B,SAACD,KAAD,CAAQ/B,KAAR,CAAkB,CAC5CkC,UAAUD,IAAV,CAAejC,mBAAf,CAD4C,CAE5CmC,SAASF,IAAT,CAAcjC,UAAd,EACA,CAHD,CAPoE,CAWpEqB,oBAAoBZ,GAApB,CAAwB0B,SAASC,IAAT,CAAc,GAAd,CAAxB,CAXoE,CAYpEf,oBAAoBC,IAApB,CAAyB,UAAzB,IAZoE,CAapEe,QAAQC,GAAR,CAAYJ,UAAUE,IAAV,CAAe,GAAf,CAAZ,CAboE,CAcpEjB,eAAeV,GAAf,CAAmByB,UAAUE,IAAV,CAAe,GAAf,CAAnB,CAdoE,CAepEjB,eAAeoB,OAAf,CAAuB,QAAvB,CAfoE,CAgBpE/E,IAAIgF,eAAJ,GACA,CAjBD,EAkBA,CAzBD,EA0BA,CA/BD,CADc,CAiCd,KAAKjE,QAAL,CAAcW,IAAd,CAAmB,gBAAnB,EAAqCC,EAArC,CAAwC,OAAxC,CAAiD,SAACG,CAAD,CAAO,CACvD,mBAAqBjB,EAAEiB,EAAEM,aAAJ,EAAmBsB,OAAnB,CAA2B,kBAA3B,CAArB,CACCC,eAAiBC,eAAelC,IAAf,CAAoB,gBAApB,CADlB,CAECmC,oBAAsBD,eAAelC,IAAf,wBAA2CiC,eAAeG,IAAf,CAAoB,iBAApB,CAA3C,MAFvB,CAGAD,oBAAoBZ,GAApB,CAAwB,EAAxB,CAJuD,CAKvDY,oBAAoBC,IAApB,CAAyB,UAAzB,IALuD,CAMvDH,eAAeV,GAAf,CAAmB,EAAnB,CANuD,CAOvDU,eAAeoB,OAAf,CAAuB,QAAvB,EACA,CARD,EASA,CACD;;2DAGiB,CAChB,KAAK/B,SAAL,CAAiBnC,EAAE,OAAF,CADD,CAEhB,KAAKE,QAAL,CAAgBF,EAAE,oBAAF,CAFA,CAGhB,KAAKX,KAAL,CAAa,KAAKa,QAAL,CAAcW,IAAd,CAAmB,qBAAnB,CAHG,CAIhB,KAAKuD,iBAAL,EAJgB,CAKhB,KAAKC,kBAAL,EALgB,CAMhB,KAAKC,YAAL,EANgB,CAOhB,KAAKC,kBAAL,GACA,CApJF"}