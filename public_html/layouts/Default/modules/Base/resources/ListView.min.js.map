{"version":3,"file":"ListView.min.js","sources":["ListView.js"],"sourcesContent":["/**\n * Base list view class\n *\n * @copyright YetiForce S.A.\n * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n */\n'use strict';\n\nwindow.Base_ListView_Js = class {\n\t/**\n\t * Register data table\n\t */\n\tregisterDataTable() {\n\t\tthis.dataTable = app.registerDataTables(this.table, {\n\t\t\torder: [],\n\t\t\tprocessing: true,\n\t\t\tserverSide: true,\n\t\t\tsearching: false,\n\t\t\torderCellsTop: true,\n\t\t\tdeferRender: true,\n\t\t\tajax: {\n\t\t\t\turl: 'index.php',\n\t\t\t\ttype: 'POST',\n\t\t\t\tdata: (data) => {\n\t\t\t\t\t$.extend(data, this.listForm.serializeFormData());\n\t\t\t\t},\n\t\t\t\terror: function (jqXHR, ajaxOptions, thrownError) {\n\t\t\t\t\tapp.errorLog(jqXHR, thrownError);\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttext: thrownError,\n\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\tstack: window.stackPage\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tconsole.log(this.listForm.find('input,select'));\n\t\tthis.listForm.find('input,select').on('change', (e) => {\n\t\t\tconsole.log(11);\n\t\t\tconsole.log(e);\n\t\t\tthis.dataTable.ajax.reload();\n\t\t});\n\t}\n\t/**\n\t * Register records events\n\t */\n\tregisterListEvents() {\n\t\tconst self = this;\n\t\tthis.table.on('click', '.js-delete-record', (e) => {\n\t\t\tconst url = $(e.currentTarget).data('url');\n\t\t\tapp.showNotifyConfirm(\n\t\t\t\t{\n\t\t\t\t\ttitle: app.translate('JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_DELETE')\n\t\t\t\t},\n\t\t\t\tfunction () {\n\t\t\t\t\tAppConnector.request({\n\t\t\t\t\t\tdata: {},\n\t\t\t\t\t\turl: url\n\t\t\t\t\t}).done((data) => {\n\t\t\t\t\t\tif (data.result) {\n\t\t\t\t\t\t\tself.dataTable.ajax.reload();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t\tthis.table.on('click', '.js-search-records', () => {\n\t\t\tthis.dataTable.ajax.reload();\n\t\t});\n\t\tthis.table.on('click', '.js-clear-search', () => {\n\t\t\tthis.table.find('.js-filter-field').each(function () {\n\t\t\t\tthis.value = '';\n\t\t\t});\n\t\t\tthis.dataTable.ajax.reload();\n\t\t});\n\t\tthis.table.on('click', 'tbody tr', function (e) {\n\t\t\tlet clickedElement = $(e.target);\n\t\t\tlet rowElement = jQuery(this);\n\t\t\tif (clickedElement.closest('div').parent().is('.actions, .dropdown-menu')) return;\n\t\t\tif (clickedElement.closest('a').length > 0) return;\n\t\t\twindow.location.href = rowElement.find('.js-detail-view').attr('href');\n\t\t});\n\t}\n\t/**\n\t * Register custom view event\n\t */\n\tregisterCustomView() {\n\t\tlet customFilter = this.listForm.find('.js-cv-list');\n\t\tApp.Fields.Picklist.showSelect2ElementView(customFilter);\n\t\tcustomFilter.on('change', (e) => {\n\t\t\tconsole.log(22);\n\t\t\tconsole.log(e);\n\t\t\t// $.progressIndicatorShow();\n\t\t\t// this.reloadView(false);\n\t\t});\n\t\tthis.listForm.on('click', '.js-filter-tab', (e) => {\n\t\t\t$.progressIndicatorShow();\n\t\t\tthis.container.find('[name=\"cvId\"]').val(e.currentTarget.dataset.cvid);\n\t\t\tthis.reloadView(false);\n\t\t});\n\t}\n\t/**\n\t * Reload view\n\t * @param   {boolean}  onlyData\n\t */\n\treloadView(onlyData = true) {\n\t\tif (onlyData) {\n\t\t\tthis.dataTable.ajax.reload();\n\t\t} else {\n\t\t\twindow.location.href = app.convertObjectToUrl({\n\t\t\t\tmodule: this.container.find('#module').val(),\n\t\t\t\tview: this.container.find('#view').val(),\n\t\t\t\tcvId: this.container.find('[name=\"cvId\"]').val()\n\t\t\t});\n\t\t}\n\t}\n\t/**\n\t * Register tree.\n\t */\n\tregisterTree() {\n\t\tthis.listForm.find('.js-tree-select').on('click', (e) => {\n\t\t\tlet containerField = $(e.currentTarget).closest('.js-tree-content'),\n\t\t\t\ttreeValueField = containerField.find('.js-tree-value'),\n\t\t\t\tfieldDisplayElement = containerField.find(`input[data-display=\"${treeValueField.attr('date-field-name')}\"]`),\n\t\t\t\tmultiple = treeValueField.data('multiple');\n\t\t\tapp.showModalWindow(containerField.find('.js-tree-modal-window').clone(), function (modalContainer) {\n\t\t\t\tlet jstreeInstance = modalContainer.find('.js-tree-jstree');\n\t\t\t\tif (multiple === 1) {\n\t\t\t\t\tnew window.App.Fields.MultiTree(jstreeInstance);\n\t\t\t\t} else {\n\t\t\t\t\tnew window.App.Fields.Tree(jstreeInstance);\n\t\t\t\t}\n\t\t\t\tmodalContainer.find('.js-tree-modal-select').on('click', function () {\n\t\t\t\t\tlet selectedCategories = [];\n\t\t\t\t\t$.each(jstreeInstance.jstree('get_selected', true), (index, value) => {\n\t\t\t\t\t\tselectedCategories.push(value);\n\t\t\t\t\t});\n\t\t\t\t\tlet treeText = [];\n\t\t\t\t\tlet treeValue = [];\n\t\t\t\t\t$.each(selectedCategories, (index, value) => {\n\t\t\t\t\t\ttreeValue.push(value['original']['tree']);\n\t\t\t\t\t\ttreeText.push(value['text']);\n\t\t\t\t\t});\n\t\t\t\t\tfieldDisplayElement.val(treeText.join(','));\n\t\t\t\t\tfieldDisplayElement.attr('readonly', true);\n\t\t\t\t\tconsole.log(treeValue.join(','));\n\t\t\t\t\ttreeValueField.val(treeValue.join(','));\n\t\t\t\t\ttreeValueField.trigger('change');\n\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\tthis.listForm.find('.js-tree-clear').on('click', (e) => {\n\t\t\tlet containerField = $(e.currentTarget).closest('.js-tree-content'),\n\t\t\t\ttreeValueField = containerField.find('.js-tree-value'),\n\t\t\t\tfieldDisplayElement = containerField.find(`input[data-display=\"${treeValueField.attr('date-field-name')}\"]`);\n\t\t\tfieldDisplayElement.val('');\n\t\t\tfieldDisplayElement.attr('readonly', false);\n\t\t\ttreeValueField.val('');\n\t\t\ttreeValueField.trigger('change');\n\t\t});\n\t}\n\t/**\n\t * Register keyboard shortcuts events\n\t */\n\tregisterKeyboardShortcutsEvent() {\n\t\tdocument.addEventListener('keydown', (event) => {\n\t\t\tif (event.altKey && event.code === 'KeyA' && $('.js-add-record').length) {\n\t\t\t\twindow.location.href = 'index.php?module=' + app.getModuleName() + '&view=EditView';\n\t\t\t}\n\t\t});\n\t}\n\t/**\n\t * Register modal events.\n\t */\n\tregisterEvents() {\n\t\tthis.container = $('#page');\n\t\tthis.listForm = $('.js-form-container');\n\t\tthis.table = this.listForm.find('.js-list-view-table');\n\t\tthis.registerDataTable();\n\t\tthis.registerListEvents();\n\t\tthis.registerTree();\n\t\tthis.registerCustomView();\n\t\tthis.registerKeyboardShortcutsEvent();\n\t}\n};\n"],"names":["window","Base_ListView_Js","dataTable","app","registerDataTables","table","order","processing","serverSide","searching","orderCellsTop","deferRender","ajax","url","type","data","$","extend","listForm","serializeFormData","error","jqXHR","ajaxOptions","thrownError","errorLog","showNotify","text","stack","stackPage","console","log","find","on","e","reload","self","currentTarget","showNotifyConfirm","title","translate","AppConnector","request","done","result","each","value","clickedElement","target","rowElement","jQuery","closest","parent","is","length","location","href","attr","customFilter","App","Fields","Picklist","showSelect2ElementView","progressIndicatorShow","container","val","dataset","cvid","reloadView","onlyData","convertObjectToUrl","module","view","cvId","containerField","treeValueField","fieldDisplayElement","multiple","showModalWindow","clone","modalContainer","jstreeInstance","MultiTree","Tree","selectedCategories","jstree","index","push","treeText","treeValue","join","trigger","hideModalWindow","document","addEventListener","event","altKey","code","getModuleName","registerDataTable","registerListEvents","registerTree","registerCustomView","registerKeyboardShortcutsEvent"],"mappings":"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"}