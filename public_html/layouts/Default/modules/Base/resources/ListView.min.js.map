{"version":3,"file":"ListView.min.js","sources":["ListView.js"],"sourcesContent":["/**\n * Base list view class\n *\n * @copyright YetiForce S.A.\n * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n */\n'use strict';\n\nwindow.Base_ListView_Js = class {\n\t/**\n\t * Register data table\n\t */\n\tregisterDataTable() {\n\t\tthis.dataTable = app.registerDataTables(this.table, {\n\t\t\torder: [],\n\t\t\tprocessing: true,\n\t\t\tserverSide: true,\n\t\t\tsearching: false,\n\t\t\torderCellsTop: true,\n\t\t\tdeferRender: true,\n\t\t\tajax: {\n\t\t\t\turl: 'index.php',\n\t\t\t\ttype: 'POST',\n\t\t\t\tdata: (data) => {\n\t\t\t\t\t$.extend(data, this.listForm.serializeFormData());\n\t\t\t\t},\n\t\t\t\terror: function (jqXHR, ajaxOptions, thrownError) {\n\t\t\t\t\tapp.errorLog(jqXHR, thrownError);\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttext: thrownError,\n\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\tstack: window.stackPage\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.listForm.find('input,select:not(.js-cv-list)').on('change', (e) => {\n\t\t\tthis.dataTable.ajax.reload();\n\t\t});\n\t}\n\t/**\n\t * Register records events\n\t */\n\tregisterListEvents() {\n\t\tconst self = this;\n\t\tthis.table.on('click', '.js-delete-record', (e) => {\n\t\t\tconst url = $(e.currentTarget).data('url');\n\t\t\tapp.showConfirmModal({\n\t\t\t\ttitle: app.translate('JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_DELETE'),\n\t\t\t\tconfirmedCallback: () => {\n\t\t\t\t\tAppConnector.request({\n\t\t\t\t\t\tdata: {},\n\t\t\t\t\t\turl: url\n\t\t\t\t\t}).done((data) => {\n\t\t\t\t\t\tif (data.result) {\n\t\t\t\t\t\t\tself.dataTable.ajax.reload();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\tthis.table.on('click', '.js-search-records', () => {\n\t\t\tthis.dataTable.ajax.reload();\n\t\t});\n\t\tthis.table.on('click', '.js-clear-search', () => {\n\t\t\tthis.table.find('.js-filter-field').each(function () {\n\t\t\t\tthis.value = '';\n\t\t\t});\n\t\t\tthis.dataTable.ajax.reload();\n\t\t});\n\t\tthis.table.on('click', 'tbody tr', function (e) {\n\t\t\tlet clickedElement = $(e.target);\n\t\t\tlet rowElement = jQuery(this);\n\t\t\tif (clickedElement.closest('div').parent().is('.actions, .dropdown-menu')) return;\n\t\t\tif (clickedElement.closest('a').length > 0) return;\n\t\t\twindow.location.href = rowElement.find('.js-detail-view').attr('href');\n\t\t});\n\t}\n\t/**\n\t * Register custom view event\n\t */\n\tregisterCustomView() {\n\t\tlet customFilter = this.listForm.find('.js-cv-list');\n\t\tApp.Fields.Picklist.showSelect2ElementView(customFilter);\n\t\tcustomFilter.on('change', (e) => {\n\t\t\t$.progressIndicatorShow();\n\t\t\tthis.reloadView(false);\n\t\t});\n\t\tthis.listForm.on('click', '.js-filter-tab', (e) => {\n\t\t\t$.progressIndicatorShow();\n\t\t\tthis.container.find('[name=\"cvId\"]').val(e.currentTarget.dataset.cvid);\n\t\t\tthis.reloadView(false);\n\t\t});\n\t}\n\t/**\n\t * Reload view\n\t * @param   {boolean}  onlyData\n\t */\n\treloadView(onlyData = true) {\n\t\tif (onlyData) {\n\t\t\tthis.dataTable.ajax.reload();\n\t\t} else {\n\t\t\twindow.location.href = app.convertObjectToUrl({\n\t\t\t\tmodule: this.container.find('#module').val(),\n\t\t\t\tview: this.container.find('#view').val(),\n\t\t\t\tcvId: this.container.find('[name=\"cvId\"]').val()\n\t\t\t});\n\t\t}\n\t}\n\t/**\n\t * Register tree.\n\t */\n\tregisterTree() {\n\t\tthis.listForm.find('.js-tree-select').on('click', (e) => {\n\t\t\tlet containerField = $(e.currentTarget).closest('.js-tree-content'),\n\t\t\t\ttreeValueField = containerField.find('.js-tree-value'),\n\t\t\t\tfieldDisplayElement = containerField.find(`input[data-display=\"${treeValueField.attr('date-field-name')}\"]`),\n\t\t\t\tmultiple = treeValueField.data('multiple');\n\t\t\tapp.showModalWindow(containerField.find('.js-tree-modal-window').clone(), function (modalContainer) {\n\t\t\t\tlet jstreeInstance = modalContainer.find('.js-tree-jstree');\n\t\t\t\tif (multiple === 1) {\n\t\t\t\t\tnew window.App.Fields.MultiTree(jstreeInstance);\n\t\t\t\t} else {\n\t\t\t\t\tnew window.App.Fields.Tree(jstreeInstance);\n\t\t\t\t}\n\t\t\t\tmodalContainer.find('.js-tree-modal-select').on('click', function () {\n\t\t\t\t\tlet selectedCategories = [];\n\t\t\t\t\t$.each(jstreeInstance.jstree('get_selected', true), (index, value) => {\n\t\t\t\t\t\tselectedCategories.push(value);\n\t\t\t\t\t});\n\t\t\t\t\tlet treeText = [];\n\t\t\t\t\tlet treeValue = [];\n\t\t\t\t\t$.each(selectedCategories, (index, value) => {\n\t\t\t\t\t\ttreeValue.push(value['original']['tree']);\n\t\t\t\t\t\ttreeText.push(value['text']);\n\t\t\t\t\t});\n\t\t\t\t\tfieldDisplayElement.val(treeText.join(','));\n\t\t\t\t\tfieldDisplayElement.attr('readonly', true);\n\t\t\t\t\ttreeValueField.val(treeValue.join(','));\n\t\t\t\t\ttreeValueField.trigger('change');\n\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\tthis.listForm.find('.js-tree-clear').on('click', (e) => {\n\t\t\tlet containerField = $(e.currentTarget).closest('.js-tree-content'),\n\t\t\t\ttreeValueField = containerField.find('.js-tree-value'),\n\t\t\t\tfieldDisplayElement = containerField.find(`input[data-display=\"${treeValueField.attr('date-field-name')}\"]`);\n\t\t\tfieldDisplayElement.val('');\n\t\t\tfieldDisplayElement.attr('readonly', false);\n\t\t\ttreeValueField.val('');\n\t\t\ttreeValueField.trigger('change');\n\t\t});\n\t}\n\t/**\n\t * Register keyboard shortcuts events\n\t */\n\tregisterKeyboardShortcutsEvent() {\n\t\tdocument.addEventListener('keydown', (event) => {\n\t\t\tif (event.altKey && event.code === 'KeyA' && $('.js-add-record').length) {\n\t\t\t\twindow.location.href = 'index.php?module=' + app.getModuleName() + '&view=EditView';\n\t\t\t}\n\t\t});\n\t}\n\t/**\n\t * Register modal events.\n\t */\n\tregisterEvents() {\n\t\tthis.container = $('#page');\n\t\tthis.listForm = $('.js-form-container');\n\t\tthis.table = this.listForm.find('.js-list-view-table');\n\t\tthis.registerDataTable();\n\t\tthis.registerListEvents();\n\t\tthis.registerTree();\n\t\tthis.registerCustomView();\n\t\tthis.registerKeyboardShortcutsEvent();\n\t}\n};\n"],"names":["window","Base_ListView_Js","dataTable","app","registerDataTables","table","order","processing","serverSide","searching","orderCellsTop","deferRender","ajax","url","type","data","$","extend","listForm","serializeFormData","error","jqXHR","ajaxOptions","thrownError","errorLog","showNotify","text","stack","stackPage","find","on","reload","self","e","currentTarget","showConfirmModal","title","translate","confirmedCallback","AppConnector","request","done","result","each","value","clickedElement","target","rowElement","jQuery","closest","parent","is","length","location","href","attr","customFilter","App","Fields","Picklist","showSelect2ElementView","progressIndicatorShow","reloadView","container","val","dataset","cvid","onlyData","convertObjectToUrl","module","view","cvId","containerField","treeValueField","fieldDisplayElement","multiple","showModalWindow","clone","modalContainer","jstreeInstance","MultiTree","Tree","selectedCategories","jstree","index","push","treeText","treeValue","join","trigger","hideModalWindow","document","addEventListener","event","altKey","code","getModuleName","registerDataTable","registerListEvents","registerTree","registerCustomView","registerKeyboardShortcutsEvent"],"mappings":"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"}