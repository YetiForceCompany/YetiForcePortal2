{"version":3,"file":"Tree.min.js","sources":["Tree.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\nwindow.Products_Tree_Js = class {\n\tconstructor(container = $('.js-products-container')) {\n\t\tthis.container = container;\n\t\tthis.checkStockLevels = this.container.data('check-stock-levels');\n\t\tthis.page = this.container.find('.js-pagination-list').data('page') || 1;\n\t\tthis.treeInstance = $('.js-tree-container');\n\t\tthis.shoppingCartBadge = $('.js-body-header .js-shopping-cart .js-badge');\n\t\tthis.isTreeLoaded = false;\n\t\twindow.Products_Tree_Js.instance = this;\n\t}\n\t/**\n\t * Get instance of Tree.\n\t * @returns {Tree}\n\t */\n\tstatic getInstance(container = $('.js-products-container')) {\n\t\tif (typeof window.Products_Tree_Js.instance === 'undefined') {\n\t\t\twindow.Products_Tree_Js.instance = new window.Products_Tree_Js(container);\n\t\t}\n\t\treturn window.Products_Tree_Js.instance;\n\t}\n\tinit(container = $('.js-products-container')) {\n\t\tthis.container = container;\n\t\tthis.treeInstance = $('.js-tree-container');\n\t\tthis.registerEvents();\n\t}\n\tregisterEvents() {\n\t\tthis.registerAmountChange();\n\t\tthis.registerButtonAddToCart();\n\t\tthis.registerPagination();\n\t\tthis.registerSearch();\n\t\tthis.registerTreeEvents();\n\t\tthis.registerClearButton();\n\t}\n\tregisterClearButton() {\n\t\t$('.js-tree-clear').on('click', (e) => {\n\t\t\tthis.treeInstance.jstree('deselect_all');\n\t\t\t$(e.target).addClass('d-none');\n\t\t});\n\t}\n\tregisterTreeEvents() {\n\t\tthis.treeInstance.on('changed.jstree', (e, data) => {\n\t\t\tif (data.selected.length) {\n\t\t\t\t$('.js-tree-clear').removeClass('d-none');\n\t\t\t}\n\t\t\tthis.loadPage();\n\t\t});\n\t}\n\tregisterPagination() {\n\t\tthis.container.find('.js-page-item').on('click', (e) => {\n\t\t\tthis.page = parseInt($(e.currentTarget).data('page'));\n\t\t\tthis.loadPage();\n\t\t});\n\t\tthis.container.find('.js-page-next').on('click', (e) => {\n\t\t\tthis.page = parseInt(this.container.find('.js-pagination-list').data('page')) + 1;\n\t\t\tthis.loadPage();\n\t\t});\n\t\tthis.container.find('.js-page-previous').on('click', (e) => {\n\t\t\tthis.page = parseInt(this.container.find('.js-pagination-list').data('page')) - 1;\n\t\t\tthis.loadPage();\n\t\t});\n\t}\n\tgetSearchParams() {\n\t\tlet search = [];\n\t\tlet searchValue = $('.js-search').val();\n\t\tif (searchValue) {\n\t\t\tsearch.push({\n\t\t\t\tfieldName: 'productname',\n\t\t\t\tvalue: searchValue,\n\t\t\t\toperator: 'c'\n\t\t\t});\n\t\t}\n\t\tlet selectedCategories = [];\n\t\t$.each(this.treeInstance.jstree('get_selected', true), (index, value) => {\n\t\t\tselectedCategories.push(value['original']['tree']);\n\t\t});\n\t\tif (selectedCategories[0]) {\n\t\t\tsearch.push({\n\t\t\t\tfieldName: 'category_multipicklist',\n\t\t\t\tvalue: selectedCategories[0],\n\t\t\t\toperator: 'c'\n\t\t\t});\n\t\t}\n\t\t$('.js-advance-filter select.select2').each(function (index, e) {\n\t\t\tlet value = $(this).val();\n\t\t\tif (value) {\n\t\t\t\tsearch.push({\n\t\t\t\t\tfieldName: $(this).attr('name'),\n\t\t\t\t\tvalue: $(this).val(),\n\t\t\t\t\toperator: 'e'\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\treturn search;\n\t}\n\tloadPage() {\n\t\tconst progressInstance = $.progressIndicatorShow();\n\t\tAppConnector.requestPjax({\n\t\t\tdata: {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\tview: app.getViewName(),\n\t\t\t\tsearch: this.getSearchParams(),\n\t\t\t\tpage: this.page\n\t\t\t},\n\t\t\ttype: 'GET'\n\t\t}).done((data) => {\n\t\t\tprogressInstance.progressIndicator({ mode: 'hide' });\n\t\t\tlet container = $('.js-main-container');\n\t\t\tcontainer.html(data);\n\t\t\tthis.container = container;\n\t\t\tthis.registerAmountChange();\n\t\t\tthis.registerButtonAddToCart();\n\t\t\tthis.registerPagination();\n\t\t});\n\t}\n\tregisterSearch() {\n\t\t$('.js-search-button').on('click', (e) => {\n\t\t\tthis.page = 1;\n\t\t\tthis.loadPage();\n\t\t});\n\t\t$('.js-search').on('keypress', (e) => {\n\t\t\tif (e.keyCode == 13) {\n\t\t\t\tthis.page = 1;\n\t\t\t\tthis.loadPage();\n\t\t\t}\n\t\t});\n\t\t$('.js-search-cancel').on('click', (e) => {\n\t\t\t$('.js-search').val('');\n\t\t\tthis.loadPage();\n\t\t});\n\t\t$('.js-advance-filter .select2').on('change', (e) => {\n\t\t\tthis.page = 1;\n\t\t\tthis.loadPage();\n\t\t});\n\t}\n\tregisterAmountChange() {\n\t\tthis.container.find('.js-amount-inc').on('click', (e) => {\n\t\t\tlet amount = this.getCartItem(e.currentTarget).find('.js-amount');\n\t\t\tlet amountVal = amount.val();\n\t\t\tamountVal++;\n\t\t\tamount.val(amountVal);\n\t\t});\n\t\tthis.container.find('.js-amount-dec').on('click', (e) => {\n\t\t\tlet amount = this.getCartItem(e.currentTarget).find('.js-amount');\n\t\t\tlet amountVal = amount.val();\n\t\t\tamountVal--;\n\t\t\tif (amountVal >= 0) {\n\t\t\t\tamount.val(amountVal);\n\t\t\t}\n\t\t});\n\t}\n\tregisterButtonAddToCart() {\n\t\tthis.container.find('.js-add-to-cart').on('click', (e) => {\n\t\t\tlet product = this.getCartItem(e.currentTarget);\n\t\t\tlet amount = product.find('.js-amount').val();\n\t\t\tif (parseInt(amount) <= 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet amountInShoppingCart = parseFloat(product.data('amountInShoppingCart'));\n\t\t\tlet qtyinstock = parseFloat(product.data('qtyinstock'));\n\t\t\tif (this.checkStockLevels && qtyinstock - amountInShoppingCart - amount < 0) {\n\t\t\t\tapp.showNotify({\n\t\t\t\t\ttext: app.translate('JS_NO_SUCH_QUANTITY'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst amount = product.find('.js-amount').val();\n\t\t\t\tthis.cartMethod('addToCart', product.data('id'), {\n\t\t\t\t\tamount: amount,\n\t\t\t\t\tpriceNetto: product.data('priceNetto'),\n\t\t\t\t\tpriceGross: product.data('priceGross')\n\t\t\t\t}).done((data) => {\n\t\t\t\t\tif (data['result']['error']) {\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: data['result']['error'],\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.shoppingCartBadge.text(data['result']['numberOfItems']);\n\t\t\t\t\t\tconst notifyText =\n\t\t\t\t\t\t\tamount > 1\n\t\t\t\t\t\t\t\t? app.translate('JS_ADDED_ITEMS_TO_CART').replace('${amount}', amount)\n\t\t\t\t\t\t\t\t: app.translate('JS_ADDED_ITEM_TO_CART');\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: notifyText,\n\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tproduct.data('amountInShoppingCart', amountInShoppingCart + amount);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\tcartMethod(mode, recordId, params = {}) {\n\t\tconst deferred = $.Deferred();\n\t\tAppConnector.request(\n\t\t\t$.extend(\n\t\t\t\t{\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\taction: 'ShoppingCart',\n\t\t\t\t\tmode: mode,\n\t\t\t\t\trecord: recordId\n\t\t\t\t},\n\t\t\t\tparams\n\t\t\t)\n\t\t).done((data) => {\n\t\t\tdeferred.resolve(data);\n\t\t});\n\t\treturn deferred.promise();\n\t}\n\tgetCartItem(element) {\n\t\treturn $(element).closest('.js-cart-item');\n\t}\n};\n"],"names":["window","Products_Tree_Js","$","container","checkStockLevels","data","page","find","treeInstance","shoppingCartBadge","isTreeLoaded","instance","registerEvents","registerAmountChange","registerButtonAddToCart","registerPagination","registerSearch","registerTreeEvents","registerClearButton","on","e","jstree","target","addClass","selected","length","removeClass","loadPage","parseInt","currentTarget","searchValue","val","search","push","fieldName","value","operator","each","index","selectedCategories","attr","progressInstance","progressIndicatorShow","AppConnector","requestPjax","module","app","getModuleName","view","getViewName","getSearchParams","type","done","progressIndicator","mode","html","keyCode","getCartItem","amountVal","amount","product","parseFloat","qtyinstock","amountInShoppingCart","showNotify","text","translate","cartMethod","priceNetto","priceGross","replace","notifyText","recordId","deferred","Deferred","request","extend","action","record","params","resolve","promise","element","closest"],"mappings":"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"}