'use strict';

/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */'use strict';function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)descriptor=props[i],descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor);}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}window.Products_Tree_Js=/*#__PURE__*/function(){function _class(){var container=0<arguments.length&&void 0!==arguments[0]?arguments[0]:$(".js-products-container");_classCallCheck(this,_class),this.container=container,this.checkStockLevels=this.container.data("check-stock-levels"),this.page=this.container.find(".js-pagination-list").data("page")||1,this.treeInstance=$(".js-tree-container"),this.shoppingCartBadge=$(".js-body-header .js-shopping-cart .js-badge"),this.isTreeLoaded=!1,window.Products_Tree_Js.instance=this;}/**
	 * Get instance of Tree.
	 * @returns {Tree}
	 */return _createClass(_class,[{key:"init",value:function init(){var container=0<arguments.length&&void 0!==arguments[0]?arguments[0]:$(".js-products-container");this.container=container,this.treeInstance=$(".js-tree-container"),this.registerEvents();}},{key:"registerEvents",value:function registerEvents(){this.registerAmountChange(),this.registerButtonAddToCart(),this.registerPagination(),this.registerSearch(),this.registerTreeEvents(),this.registerClearButton();}},{key:"registerClearButton",value:function registerClearButton(){var _this=this;$(".js-tree-clear").on("click",function(e){_this.treeInstance.jstree("deselect_all"),$(e.target).addClass("d-none");});}},{key:"registerTreeEvents",value:function registerTreeEvents(){var _this2=this;this.treeInstance.on("changed.jstree",function(e,data){data.selected.length&&$(".js-tree-clear").removeClass("d-none"),_this2.loadPage();});}},{key:"registerPagination",value:function registerPagination(){var _this3=this;this.container.find(".js-page-item").on("click",function(e){_this3.page=parseInt($(e.currentTarget).data("page")),_this3.loadPage();}),this.container.find(".js-page-next").on("click",function(){_this3.page=parseInt(_this3.container.find(".js-pagination-list").data("page"))+1,_this3.loadPage();}),this.container.find(".js-page-previous").on("click",function(){_this3.page=parseInt(_this3.container.find(".js-pagination-list").data("page"))-1,_this3.loadPage();});}},{key:"getSearchParams",value:function getSearchParams(){var search=[],searchValue=$(".js-search").val();searchValue&&search.push({fieldName:"productname",value:searchValue,operator:"c"});var selectedCategories=[];return $.each(this.treeInstance.jstree("get_selected",!0),function(index,value){selectedCategories.push(value.original.tree);}),selectedCategories[0]&&search.push({fieldName:"category_multipicklist",value:selectedCategories[0],operator:"c"}),$(".js-advance-filter select.select2").each(function(){var value=$(this).val();value&&search.push({fieldName:$(this).attr("name"),value:$(this).val(),operator:"e"});}),search}},{key:"loadPage",value:function loadPage(){var _this4=this,progressInstance=$.progressIndicatorShow();AppConnector.requestPjax({data:{module:app.getModuleName(),view:app.getViewName(),search:this.getSearchParams(),page:this.page},type:"GET"}).done(function(data){progressInstance.progressIndicator({mode:"hide"});var container=$(".js-main-container");container.html(data),_this4.container=container,_this4.registerEventsAfterLoad();});}},{key:"registerEventsAfterLoad",value:function registerEventsAfterLoad(){this.registerAmountChange(),this.registerButtonAddToCart(),this.registerPagination();}},{key:"registerSearch",value:function registerSearch(){var _this5=this;$(".js-search-button").on("click",function(){_this5.page=1,_this5.loadPage();}),$(".js-search").on("keypress",function(e){13==e.keyCode&&(_this5.page=1,_this5.loadPage());}),$(".js-search-cancel").on("click",function(){$(".js-search").val(""),_this5.loadPage();}),$(".js-advance-filter .select2").on("change",function(){_this5.page=1,_this5.loadPage();});}},{key:"registerAmountChange",value:function registerAmountChange(){var _this6=this;this.container.find(".js-amount-inc").on("click",function(e){var amount=_this6.getCartItem(e.currentTarget).find(".js-amount"),amountVal=amount.val();amountVal++,amount.val(amountVal);}),this.container.find(".js-amount-dec").on("click",function(e){var amount=_this6.getCartItem(e.currentTarget).find(".js-amount"),amountVal=amount.val();amountVal--,0<=amountVal&&amount.val(amountVal);});}},{key:"registerButtonAddToCart",value:function registerButtonAddToCart(){var _this7=this;this.container.find(".js-add-to-cart").on("click",function(e){var product=_this7.getCartItem(e.currentTarget),amount=product.find(".js-amount").val();if(!(0>=parseInt(amount))){var amountInShoppingCart=parseFloat(product.data("amountInShoppingCart")),qtyinstock=parseFloat(product.data("qtyinstock"));if(_this7.checkStockLevels&&0>qtyinstock-amountInShoppingCart-amount)app.showNotify({text:app.translate("JS_NO_SUCH_QUANTITY"),type:"error"});else {var _amount=product.find(".js-amount").val();_this7.cartMethod("addToCart",product.data("id"),{amount:_amount,priceNetto:product.data("priceNetto"),priceGross:product.data("priceGross")}).done(function(data){if(data.result.error)app.showNotify({text:data.result.error,type:"error"});else {_this7.shoppingCartBadge.text(data.result.numberOfItems);var notifyText=1<_amount?app.translate("JS_ADDED_ITEMS_TO_CART").replace("${amount}",_amount):app.translate("JS_ADDED_ITEM_TO_CART");app.showNotify({text:notifyText,type:"success"}),product.data("amountInShoppingCart",amountInShoppingCart+_amount);}});}}});}},{key:"cartMethod",value:function cartMethod(mode,recordId){var params=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},deferred=$.Deferred();return AppConnector.request($.extend({module:app.getModuleName(),action:"ShoppingCart",mode:mode,record:recordId},params)).done(function(data){deferred.resolve(data);}),deferred.promise()}},{key:"getCartItem",value:function getCartItem(element){return $(element).closest(".js-cart-item")}}],[{key:"getInstance",value:function getInstance(){var container=0<arguments.length&&void 0!==arguments[0]?arguments[0]:$(".js-products-container");return "undefined"==typeof window.Products_Tree_Js.instance&&(window.Products_Tree_Js.instance=new window.Products_Tree_Js(container)),window.Products_Tree_Js.instance}}]),_class}();
//# sourceMappingURL=Tree.min.js.map
