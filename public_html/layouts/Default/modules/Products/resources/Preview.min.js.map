{"version":3,"file":"Preview.min.js","sources":["Preview.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\nwindow.Products_Preview_Js = class {\n\tconstructor(container = $('.js-preview')) {\n\t\tthis.container = container;\n\t\tthis.checkStockLevels = this.container.data('check-stock-levels');\n\t\tthis.shoppingCartBadge = $('.js-body-header .js-shopping-cart .js-badge');\n\t}\n\tcartMethod(mode, recordId, params = {}) {\n\t\tconst deferred = $.Deferred();\n\t\tAppConnector.request(\n\t\t\t$.extend(\n\t\t\t\t{\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\taction: 'ShoppingCart',\n\t\t\t\t\tmode: mode,\n\t\t\t\t\trecord: recordId\n\t\t\t\t},\n\t\t\t\tparams\n\t\t\t)\n\t\t).done((data) => {\n\t\t\tdeferred.resolve(data);\n\t\t});\n\t\treturn deferred.promise();\n\t}\n\tgetCartItem(element) {\n\t\treturn $(element).closest('.js-cart-item');\n\t}\n\tregisterAmountChange() {\n\t\tthis.container.find('.js-amount-inc').on('click', (e) => {\n\t\t\tlet amount = this.getCartItem(e.currentTarget).find('.js-amount');\n\t\t\tlet amountVal = amount.val();\n\t\t\tamountVal++;\n\t\t\tamount.val(amountVal);\n\t\t});\n\t\tthis.container.find('.js-amount-dec').on('click', (e) => {\n\t\t\tlet amount = this.getCartItem(e.currentTarget).find('.js-amount');\n\t\t\tlet amountVal = amount.val();\n\t\t\tamountVal--;\n\t\t\tif (amountVal >= 0) {\n\t\t\t\tamount.val(amountVal);\n\t\t\t}\n\t\t});\n\t}\n\tregisterButtonAddToCart() {\n\t\tthis.container.find('.js-add-to-cart').on('click', (e) => {\n\t\t\tlet product = this.container;\n\t\t\tlet amountVal = product.find('.js-amount').val();\n\t\t\tif (parseInt(amountVal) <= 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet amountInShoppingCart = parseFloat(product.data('amountInShoppingCart'));\n\t\t\tlet qtyinstock = parseFloat(product.data('qtyinstock'));\n\t\t\tif (this.checkStockLevels && qtyinstock - amountInShoppingCart - amountVal < 0) {\n\t\t\t\tapp.showNotify({\n\t\t\t\t\ttext: app.translate('JS_NO_SUCH_QUANTITY'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst amountVal = product.find('.js-amount').val();\n\t\t\t\tthis.cartMethod('addToCart', this.container.find('.js-preview-record').val(), {\n\t\t\t\t\tamount: product.find('.js-amount').val(),\n\t\t\t\t\tpriceNetto: product.data('priceNetto'),\n\t\t\t\t\tpriceGross: product.data('priceGross')\n\t\t\t\t}).done((data) => {\n\t\t\t\t\tif (data['result']['error']) {\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: data['result']['error'],\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.shoppingCartBadge.text(data['result']['numberOfItems']);\n\t\t\t\t\t\tconst notifyText =\n\t\t\t\t\t\t\tamountVal > 1\n\t\t\t\t\t\t\t\t? app.translate('JS_ADDED_ITEMS_TO_CART').replace('${amount}', amountVal)\n\t\t\t\t\t\t\t\t: app.translate('JS_ADDED_ITEM_TO_CART');\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: notifyText,\n\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tproduct.data('amountInShoppingCart', amountInShoppingCart + amountVal);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\tregisterButtonAddToCartForBundles() {\n\t\tthis.container.find('.js-add-to-cart-bundles').on('click', (e) => {\n\t\t\tlet product = this.getCartItem(e.currentTarget);\n\t\t\tlet amount = product.find('.js-amount').val();\n\t\t\tif (parseInt(amount) <= 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet amountInShoppingCart = parseFloat(product.data('amountInShoppingCart'));\n\t\t\tlet qtyinstock = parseFloat(product.data('qtyinstock'));\n\t\t\tif (this.checkStockLevels && qtyinstock - amountInShoppingCart - amount < 0) {\n\t\t\t\tapp.showNotify({\n\t\t\t\t\ttext: app.translate('JS_NO_SUCH_QUANTITY'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst amount = product.find('.js-amount').val();\n\t\t\t\tthis.cartMethod('addToCart', product.data('id'), {\n\t\t\t\t\tamount: amount,\n\t\t\t\t\tpriceNetto: product.data('priceNetto'),\n\t\t\t\t\tpriceGross: product.data('priceGross')\n\t\t\t\t}).done((data) => {\n\t\t\t\t\tif (data['result']['error']) {\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: data['result']['error'],\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.shoppingCartBadge.text(data['result']['numberOfItems']);\n\t\t\t\t\t\tconst notifyText =\n\t\t\t\t\t\t\tamount > 1\n\t\t\t\t\t\t\t\t? app.translate('JS_ADDED_ITEMS_TO_CART').replace('${amount}', amount)\n\t\t\t\t\t\t\t\t: app.translate('JS_ADDED_ITEM_TO_CART');\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: notifyText,\n\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tproduct.data('amountInShoppingCart', amountInShoppingCart + amount);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\tregisterEvents() {\n\t\tthis.container = $('.js-preview');\n\t\tthis.registerAmountChange();\n\t\tthis.registerButtonAddToCart();\n\t\tthis.registerButtonAddToCartForBundles();\n\t}\n};\n"],"names":["window","Products_Preview_Js","container","$","checkStockLevels","data","shoppingCartBadge","mode","recordId","params","deferred","Deferred","AppConnector","request","extend","module","app","getModuleName","action","record","done","resolve","promise","element","closest","find","on","e","amount","getCartItem","currentTarget","amountVal","val","product","parseInt","amountInShoppingCart","parseFloat","qtyinstock","showNotify","text","translate","type","cartMethod","priceNetto","priceGross","notifyText","replace","registerAmountChange","registerButtonAddToCart","registerButtonAddToCartForBundles"],"mappings":"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"}