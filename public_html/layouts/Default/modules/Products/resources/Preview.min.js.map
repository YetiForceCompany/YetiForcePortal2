{"version":3,"file":"Preview.min.js","sources":["Preview.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\nwindow.Products_Preview_Js = class {\n\tconstructor(container = $('.js-preview')) {\n\t\tthis.container = container;\n\t\tthis.checkStockLevels = this.container.data('check-stock-levels');\n\t\tthis.shoppingCartBadge = $('.js-body-header .js-shopping-cart .js-badge');\n\t}\n\tcartMethod(mode, recordId, params = {}) {\n\t\tconst deferred = $.Deferred();\n\t\tAppConnector.request(\n\t\t\t$.extend(\n\t\t\t\t{\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\taction: 'ShoppingCart',\n\t\t\t\t\tmode: mode,\n\t\t\t\t\trecord: recordId\n\t\t\t\t},\n\t\t\t\tparams\n\t\t\t)\n\t\t).done((data) => {\n\t\t\tdeferred.resolve(data);\n\t\t});\n\t\treturn deferred.promise();\n\t}\n\tgetCartItem(element) {\n\t\treturn $(element).closest('.js-cart-item');\n\t}\n\tregisterAmountChange() {\n\t\tthis.container.find('.js-amount-inc').on('click', (e) => {\n\t\t\tlet amount = this.getCartItem(e.currentTarget).find('.js-amount');\n\t\t\tlet amountVal = amount.val();\n\t\t\tamountVal++;\n\t\t\tamount.val(amountVal);\n\t\t});\n\t\tthis.container.find('.js-amount-dec').on('click', (e) => {\n\t\t\tlet amount = this.getCartItem(e.currentTarget).find('.js-amount');\n\t\t\tlet amountVal = amount.val();\n\t\t\tamountVal--;\n\t\t\tif (amountVal >= 0) {\n\t\t\t\tamount.val(amountVal);\n\t\t\t}\n\t\t});\n\t}\n\tregisterButtonAddToCart() {\n\t\tthis.container.find('.js-add-to-cart').on('click', (e) => {\n\t\t\tlet product = this.container;\n\t\t\tlet amountVal = product.find('.js-amount').val();\n\t\t\tif (parseInt(amountVal) <= 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet amountInShoppingCart = parseFloat(product.data('amountInShoppingCart'));\n\t\t\tlet qtyinstock = parseFloat(product.data('qtyinstock'));\n\t\t\tif (this.checkStockLevels && qtyinstock - amountInShoppingCart - amountVal < 0) {\n\t\t\t\tapp.showNotify({\n\t\t\t\t\ttext: app.translate('JS_NO_SUCH_QUANTITY'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst amountVal = product.find('.js-amount').val();\n\t\t\t\tthis.cartMethod('addToCart', this.container.find('.js-preview-record').val(), {\n\t\t\t\t\tamount: product.find('.js-amount').val(),\n\t\t\t\t\tpriceNetto: product.data('priceNetto'),\n\t\t\t\t\tpriceGross: product.data('priceGross')\n\t\t\t\t}).done((data) => {\n\t\t\t\t\tif (data['result']['error']) {\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: data['result']['error'],\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.shoppingCartBadge.text(data['result']['numberOfItems']);\n\t\t\t\t\t\tconst notifyText =\n\t\t\t\t\t\t\tamountVal > 1\n\t\t\t\t\t\t\t\t? app.translate('JS_ADDED_ITEMS_TO_CART').replace('${amount}', amountVal)\n\t\t\t\t\t\t\t\t: app.translate('JS_ADDED_ITEM_TO_CART');\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: notifyText,\n\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tproduct.data('amountInShoppingCart', amountInShoppingCart + amountVal);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\tregisterButtonAddToCartForBundles() {\n\t\tthis.container.find('.js-add-to-cart-bundles').on('click', (e) => {\n\t\t\tlet product = this.getCartItem(e.currentTarget);\n\t\t\tlet amount = product.find('.js-amount').val();\n\t\t\tif (parseInt(amount) <= 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet amountInShoppingCart = parseFloat(product.data('amountInShoppingCart'));\n\t\t\tlet qtyinstock = parseFloat(product.data('qtyinstock'));\n\t\t\tif (this.checkStockLevels && qtyinstock - amountInShoppingCart - amount < 0) {\n\t\t\t\tapp.showNotify({\n\t\t\t\t\ttext: app.translate('JS_NO_SUCH_QUANTITY'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst amount = product.find('.js-amount').val();\n\t\t\t\tthis.cartMethod('addToCart', product.data('id'), {\n\t\t\t\t\tamount: amount,\n\t\t\t\t\tpriceNetto: product.data('priceNetto'),\n\t\t\t\t\tpriceGross: product.data('priceGross')\n\t\t\t\t}).done((data) => {\n\t\t\t\t\tif (data['result']['error']) {\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: data['result']['error'],\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.shoppingCartBadge.text(data['result']['numberOfItems']);\n\t\t\t\t\t\tconst notifyText =\n\t\t\t\t\t\t\tamount > 1\n\t\t\t\t\t\t\t\t? app.translate('JS_ADDED_ITEMS_TO_CART').replace('${amount}', amount)\n\t\t\t\t\t\t\t\t: app.translate('JS_ADDED_ITEM_TO_CART');\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: notifyText,\n\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tproduct.data('amountInShoppingCart', amountInShoppingCart + amount);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\tregisterEvents() {\n\t\tthis.container = $('.js-preview');\n\t\tthis.registerAmountChange();\n\t\tthis.registerButtonAddToCart();\n\t\tthis.registerButtonAddToCartForBundles();\n\t}\n};\n"],"names":["window","Products_Preview_Js","$","container","checkStockLevels","data","shoppingCartBadge","mode","recordId","deferred","Deferred","request","extend","module","app","getModuleName","action","record","params","done","resolve","promise","element","closest","find","on","e","getCartItem","currentTarget","amountVal","amount","val","product","parseFloat","qtyinstock","amountInShoppingCart","showNotify","text","translate","type","cartMethod","priceNetto","priceGross","replace","notifyText","registerAmountChange","registerButtonAddToCart","registerButtonAddToCartForBundles"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAEAA,OAAOC,mBAAP,YACC,iBAA0C,cAAA,wDAAlBC,EAAE,aAAF,CAAkB,6BACzC,KAAKC,SAAL,CAAiBA,SADwB,CAEzC,KAAKC,gBAAL,CAAwB,KAAKD,SAAL,CAAeE,IAAf,CAAoB,oBAApB,CAFiB,CAGzC,KAAKC,iBAAL,CAAyBJ,EAAE,6CAAF,EACzB,CALF,uEAMYK,IANZ,CAMkBC,QANlB,CAMyC,WAAA,wDAAJ,EAAI,CACjCC,SAAWP,EAAEQ,QAAF,EADsB,CAevC,oBAbaC,OAAb,CACCT,EAAEU,MAAF,CACC,CACCC,OAAQC,IAAIC,aAAJ,EADT,CAECC,OAAQ,cAFT,CAGCT,KAAMA,IAHP,CAICU,OAAQT,QAJT,CADD,CAOCU,MAPD,CADD,EAUEC,IAVF,CAUO,SAACd,IAAD,CAAU,CAChBI,SAASW,OAAT,CAAiBf,IAAjB,EACA,CAZD,CAaA,CAAOI,SAASY,OAAT,EACP,CAtBF,gDAuBaC,OAvBb,CAuBsB,CACpB,SAASA,OAAF,EAAWC,OAAX,CAAmB,eAAnB,CACP,CAzBF,mEA0BwB,gBACtB,KAAKpB,SAAL,CAAeqB,IAAf,CAAoB,gBAApB,EAAsCC,EAAtC,CAAyC,OAAzC,CAAkD,SAACC,CAAD,CAAO,YAC3C,MAAKC,WAAL,CAAiBD,EAAEE,aAAnB,EAAkCJ,IAAlC,CAAuC,YAAvC,CAD2C,CAEpDK,UAAYC,OAAOC,GAAP,EAFwC,CAGxDF,WAHwD,CAIxDC,OAAOC,GAAP,CAAWF,SAAX,EACA,CALD,CADsB,CAOtB,KAAK1B,SAAL,CAAeqB,IAAf,CAAoB,gBAApB,EAAsCC,EAAtC,CAAyC,OAAzC,CAAkD,SAACC,CAAD,CAAO,YAC3C,MAAKC,WAAL,CAAiBD,EAAEE,aAAnB,EAAkCJ,IAAlC,CAAuC,YAAvC,CAD2C,CAEpDK,UAAYC,OAAOC,GAAP,EAFwC,CAGxDF,WAHwD,CAIvC,CAAb,WAJoD,EAKvDC,OAAOC,GAAP,CAAWF,SAAX,EAED,CAPD,EAQA,CAzCF,yEA0C2B,iBACzB,KAAK1B,SAAL,CAAeqB,IAAf,CAAoB,iBAApB,EAAuCC,EAAvC,CAA0C,OAA1C,CAAmD,UAAO,aAC3C,OAAKtB,SADsC,CAErD0B,UAAYG,QAAQR,IAAR,CAAa,YAAb,EAA2BO,GAA3B,EAFyC,CAGzD,KAA2B,CAAvB,WAASF,SAAT,CAAJ,4BAG2BI,WAAWD,QAAQ3B,IAAR,CAAa,sBAAb,CAAX,CAH3B,CAII6B,WAAaD,WAAWD,QAAQ3B,IAAR,CAAa,YAAb,CAAX,CAJjB,CAKA,GAAI,OAAKD,gBAAL,EAAyE,CAAhD,YAAa+B,oBAAb,CAAoCN,SAAjE,CACCf,IAAIsB,UAAJ,CAAe,CACdC,KAAMvB,IAAIwB,SAAJ,CAAc,qBAAd,CADQ,CAEdC,KAAM,OAFQ,CAAf,CADD,MAKO,CACN,eAAkBP,QAAQR,IAAR,CAAa,YAAb,EAA2BO,GAA3B,EAAlB,CACA,OAAKS,UAAL,CAAgB,WAAhB,CAA6B,OAAKrC,SAAL,CAAeqB,IAAf,CAAoB,oBAApB,EAA0CO,GAA1C,EAA7B,CAA8E,CAC7ED,OAAQE,QAAQR,IAAR,CAAa,YAAb,EAA2BO,GAA3B,EADqE,CAE7EU,WAAYT,QAAQ3B,IAAR,CAAa,YAAb,CAFiE,CAG7EqC,WAAYV,QAAQ3B,IAAR,CAAa,YAAb,CAHiE,CAA9E,EAIGc,IAJH,CAIQ,SAACd,IAAD,CAAU,CACjB,GAAIA,iBAAJ,CACCS,IAAIsB,UAAJ,CAAe,CACdC,KAAMhC,iBADQ,CAEdkC,KAAM,OAFQ,CAAf,CADD,MAKO,CACN,OAAKjC,iBAAL,CAAuB+B,IAAvB,CAA4BhC,yBAA5B,CADM,CAEN,eACa,CAAZ,YACGS,IAAIwB,SAAJ,CAAc,wBAAd,EAAwCK,OAAxC,CAAgD,WAAhD,CAA6Dd,UAA7D,CADH,CAEGf,IAAIwB,SAAJ,CAAc,uBAAd,CAHJ,CAIAxB,IAAIsB,UAAJ,CAAe,CACdC,KAAMO,UADQ,CAEdL,KAAM,SAFQ,CAAf,CANM,CAUNP,QAAQ3B,IAAR,CAAa,sBAAb,CAAqC8B,qBAAuBN,UAA5D,EACA,CACD,CAtBD,EAuBA,CAnCD,CAoCA,CAvCD,EAwCA,CAnFF,6FAoFqC,iBACnC,KAAK1B,SAAL,CAAeqB,IAAf,CAAoB,yBAApB,EAA+CC,EAA/C,CAAkD,OAAlD,CAA2D,SAACC,CAAD,CAAO,aACnD,OAAKC,WAAL,CAAiBD,EAAEE,aAAnB,CADmD,CAE7DE,OAASE,QAAQR,IAAR,CAAa,YAAb,EAA2BO,GAA3B,EAFoD,CAGjE,KAAwB,CAApB,WAASD,MAAT,CAAJ,4BAG2BG,WAAWD,QAAQ3B,IAAR,CAAa,sBAAb,CAAX,CAH3B,CAII6B,WAAaD,WAAWD,QAAQ3B,IAAR,CAAa,YAAb,CAAX,CAJjB,CAKA,GAAI,OAAKD,gBAAL,EAAsE,CAA7C,YAAa+B,oBAAb,CAAoCL,MAAjE,CACChB,IAAIsB,UAAJ,CAAe,CACdC,KAAMvB,IAAIwB,SAAJ,CAAc,qBAAd,CADQ,CAEdC,KAAM,OAFQ,CAAf,CADD,MAKO,CACN,YAAeP,QAAQR,IAAR,CAAa,YAAb,EAA2BO,GAA3B,EAAf,CACA,OAAKS,UAAL,CAAgB,WAAhB,CAA6BR,QAAQ3B,IAAR,CAAa,IAAb,CAA7B,CAAiD,CAChDyB,OAAQA,OADwC,CAEhDW,WAAYT,QAAQ3B,IAAR,CAAa,YAAb,CAFoC,CAGhDqC,WAAYV,QAAQ3B,IAAR,CAAa,YAAb,CAHoC,CAAjD,EAIGc,IAJH,CAIQ,SAACd,IAAD,CAAU,CACjB,GAAIA,iBAAJ,CACCS,IAAIsB,UAAJ,CAAe,CACdC,KAAMhC,iBADQ,CAEdkC,KAAM,OAFQ,CAAf,CADD,MAKO,CACN,OAAKjC,iBAAL,CAAuB+B,IAAvB,CAA4BhC,yBAA5B,CADM,CAEN,eACU,CAAT,SACGS,IAAIwB,SAAJ,CAAc,wBAAd,EAAwCK,OAAxC,CAAgD,WAAhD,CAA6Db,OAA7D,CADH,CAEGhB,IAAIwB,SAAJ,CAAc,uBAAd,CAHJ,CAIAxB,IAAIsB,UAAJ,CAAe,CACdC,KAAMO,UADQ,CAEdL,KAAM,SAFQ,CAAf,CANM,CAUNP,QAAQ3B,IAAR,CAAa,sBAAb,CAAqC8B,qBAAuBL,OAA5D,EACA,CACD,CAtBD,EAuBA,CAnCD,CAoCA,CAvCD,EAwCA,CA7HF,uDA8HkB,CAChB,KAAK3B,SAAL,CAAiBD,EAAE,aAAF,CADD,CAEhB,KAAK2C,oBAAL,EAFgB,CAGhB,KAAKC,uBAAL,EAHgB,CAIhB,KAAKC,iCAAL,GACA,CAnIF"}