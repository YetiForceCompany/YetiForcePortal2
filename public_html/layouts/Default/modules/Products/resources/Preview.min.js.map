{"version":3,"file":"Preview.min.js","sources":["Preview.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\nwindow.Products_Preview_Js = class {\n\tconstructor(container = $('.js-preview')) {\n\t\tthis.container = container;\n\t\tthis.checkStockLevels = this.container.data('check-stock-levels');\n\t\tthis.shoppingCartBadge = $('.js-body-header .js-shopping-cart .js-badge');\n\t}\n\tcartMethod(mode, recordId, params = {}) {\n\t\tconst deferred = $.Deferred();\n\t\tAppConnector.request(\n\t\t\t$.extend(\n\t\t\t\t{\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\taction: 'ShoppingCart',\n\t\t\t\t\tmode: mode,\n\t\t\t\t\trecord: recordId\n\t\t\t\t},\n\t\t\t\tparams\n\t\t\t)\n\t\t).done((data) => {\n\t\t\tdeferred.resolve(data);\n\t\t});\n\t\treturn deferred.promise();\n\t}\n\tgetCartItem(element) {\n\t\treturn $(element).closest('.js-cart-item');\n\t}\n\tregisterAmountChange() {\n\t\tthis.container.find('.js-amount-inc').on('click', (e) => {\n\t\t\tlet amount = this.getCartItem(e.currentTarget).find('.js-amount');\n\t\t\tlet amountVal = amount.val();\n\t\t\tamountVal++;\n\t\t\tamount.val(amountVal);\n\t\t});\n\t\tthis.container.find('.js-amount-dec').on('click', (e) => {\n\t\t\tlet amount = this.getCartItem(e.currentTarget).find('.js-amount');\n\t\t\tlet amountVal = amount.val();\n\t\t\tamountVal--;\n\t\t\tif (amountVal >= 0) {\n\t\t\t\tamount.val(amountVal);\n\t\t\t}\n\t\t});\n\t}\n\tregisterButtonAddToCart() {\n\t\tthis.container.find('.js-add-to-cart').on('click', (e) => {\n\t\t\tlet product = this.container;\n\t\t\tlet amountVal = product.find('.js-amount').val();\n\t\t\tif (parseInt(amountVal) <= 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet amountInShoppingCart = parseFloat(product.data('amountInShoppingCart'));\n\t\t\tlet qtyinstock = parseFloat(product.data('qtyinstock'));\n\t\t\tif (this.checkStockLevels && qtyinstock - amountInShoppingCart - amountVal < 0) {\n\t\t\t\tapp.showNotify({\n\t\t\t\t\ttext: app.translate('JS_NO_SUCH_QUANTITY'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst amountVal = product.find('.js-amount').val();\n\t\t\t\tthis.cartMethod('addToCart', this.container.find('.js-preview-record').val(), {\n\t\t\t\t\tamount: product.find('.js-amount').val(),\n\t\t\t\t\tpriceNetto: product.data('priceNetto'),\n\t\t\t\t\tpriceGross: product.data('priceGross')\n\t\t\t\t}).done((data) => {\n\t\t\t\t\tif (data['result']['error']) {\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: data['result']['error'],\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.shoppingCartBadge.text(data['result']['numberOfItems']);\n\t\t\t\t\t\tconst notifyText =\n\t\t\t\t\t\t\tamountVal > 1\n\t\t\t\t\t\t\t\t? app.translate('JS_ADDED_ITEMS_TO_CART').replace('${amount}', amountVal)\n\t\t\t\t\t\t\t\t: app.translate('JS_ADDED_ITEM_TO_CART');\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: notifyText,\n\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tproduct.data('amountInShoppingCart', amountInShoppingCart + amountVal);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\tregisterButtonAddToCartForBundles() {\n\t\tthis.container.find('.js-add-to-cart-bundles').on('click', (e) => {\n\t\t\tlet product = this.getCartItem(e.currentTarget);\n\t\t\tlet amount = product.find('.js-amount').val();\n\t\t\tif (parseInt(amount) <= 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet amountInShoppingCart = parseFloat(product.data('amountInShoppingCart'));\n\t\t\tlet qtyinstock = parseFloat(product.data('qtyinstock'));\n\t\t\tif (this.checkStockLevels && qtyinstock - amountInShoppingCart - amount < 0) {\n\t\t\t\tapp.showNotify({\n\t\t\t\t\ttext: app.translate('JS_NO_SUCH_QUANTITY'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst amount = product.find('.js-amount').val();\n\t\t\t\tthis.cartMethod('addToCart', product.data('id'), {\n\t\t\t\t\tamount: amount,\n\t\t\t\t\tpriceNetto: product.data('priceNetto'),\n\t\t\t\t\tpriceGross: product.data('priceGross')\n\t\t\t\t}).done((data) => {\n\t\t\t\t\tif (data['result']['error']) {\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: data['result']['error'],\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.shoppingCartBadge.text(data['result']['numberOfItems']);\n\t\t\t\t\t\tconst notifyText =\n\t\t\t\t\t\t\tamount > 1\n\t\t\t\t\t\t\t\t? app.translate('JS_ADDED_ITEMS_TO_CART').replace('${amount}', amount)\n\t\t\t\t\t\t\t\t: app.translate('JS_ADDED_ITEM_TO_CART');\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: notifyText,\n\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tproduct.data('amountInShoppingCart', amountInShoppingCart + amount);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\tregisterEvents() {\n\t\tthis.container = $('.js-preview');\n\t\tthis.registerAmountChange();\n\t\tthis.registerButtonAddToCart();\n\t\tthis.registerButtonAddToCartForBundles();\n\t}\n};\n"],"names":["window","Products_Preview_Js","$","container","checkStockLevels","data","shoppingCartBadge","mode","recordId","deferred","Deferred","request","extend","module","app","getModuleName","action","record","params","done","resolve","promise","element","closest","find","on","e","amount","getCartItem","currentTarget","amountVal","val","product","parseInt","parseFloat","qtyinstock","amountInShoppingCart","showNotify","text","translate","type","cartMethod","priceNetto","priceGross","notifyText","replace","registerAmountChange","registerButtonAddToCart","registerButtonAddToCartForBundles"],"mappings":"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"}