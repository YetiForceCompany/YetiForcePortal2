'use strict';

/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */'use strict';function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)descriptor=props[i],descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor);}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}window.Products_Preview_Js=/*#__PURE__*/function(){function _class(){var container=0<arguments.length&&void 0!==arguments[0]?arguments[0]:$(".js-preview");_classCallCheck(this,_class),this.container=container,this.checkStockLevels=this.container.data("check-stock-levels"),this.shoppingCartBadge=$(".js-body-header .js-shopping-cart .js-badge");}return _createClass(_class,[{key:"cartMethod",value:function cartMethod(mode,recordId){var params=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},deferred=$.Deferred();return AppConnector.request($.extend({module:app.getModuleName(),action:"ShoppingCart",mode:mode,record:recordId},params)).done(function(data){deferred.resolve(data);}),deferred.promise()}},{key:"getCartItem",value:function getCartItem(element){return $(element).closest(".js-cart-item")}},{key:"registerAmountChange",value:function registerAmountChange(){var _this=this;this.container.find(".js-amount-inc").on("click",function(e){var amount=_this.getCartItem(e.currentTarget).find(".js-amount"),amountVal=amount.val();amountVal++,amount.val(amountVal);}),this.container.find(".js-amount-dec").on("click",function(e){var amount=_this.getCartItem(e.currentTarget).find(".js-amount"),amountVal=amount.val();amountVal--,0<=amountVal&&amount.val(amountVal);});}},{key:"registerButtonAddToCart",value:function registerButtonAddToCart(){var _this2=this;this.container.find(".js-add-to-cart").on("click",function(){var product=_this2.container,amountVal=product.find(".js-amount").val();if(!(0>=parseInt(amountVal))){var amountInShoppingCart=parseFloat(product.data("amountInShoppingCart")),qtyinstock=parseFloat(product.data("qtyinstock"));if(_this2.checkStockLevels&&0>qtyinstock-amountInShoppingCart-amountVal)app.showNotify({text:app.translate("JS_NO_SUCH_QUANTITY"),type:"error"});else {var _amountVal=product.find(".js-amount").val();_this2.cartMethod("addToCart",_this2.container.find(".js-preview-record").val(),{amount:product.find(".js-amount").val(),priceNetto:product.data("priceNetto"),priceGross:product.data("priceGross")}).done(function(data){if(data.result.error)app.showNotify({text:data.result.error,type:"error"});else {_this2.shoppingCartBadge.text(data.result.numberOfItems);var notifyText=1<_amountVal?app.translate("JS_ADDED_ITEMS_TO_CART").replace("${amount}",_amountVal):app.translate("JS_ADDED_ITEM_TO_CART");app.showNotify({text:notifyText,type:"success"}),product.data("amountInShoppingCart",amountInShoppingCart+_amountVal);}});}}});}},{key:"registerButtonAddToCartForBundles",value:function registerButtonAddToCartForBundles(){var _this3=this;this.container.find(".js-add-to-cart-bundles").on("click",function(e){var product=_this3.getCartItem(e.currentTarget),amount=product.find(".js-amount").val();if(!(0>=parseInt(amount))){var amountInShoppingCart=parseFloat(product.data("amountInShoppingCart")),qtyinstock=parseFloat(product.data("qtyinstock"));if(_this3.checkStockLevels&&0>qtyinstock-amountInShoppingCart-amount)app.showNotify({text:app.translate("JS_NO_SUCH_QUANTITY"),type:"error"});else {var _amount=product.find(".js-amount").val();_this3.cartMethod("addToCart",product.data("id"),{amount:_amount,priceNetto:product.data("priceNetto"),priceGross:product.data("priceGross")}).done(function(data){if(data.result.error)app.showNotify({text:data.result.error,type:"error"});else {_this3.shoppingCartBadge.text(data.result.numberOfItems);var notifyText=1<_amount?app.translate("JS_ADDED_ITEMS_TO_CART").replace("${amount}",_amount):app.translate("JS_ADDED_ITEM_TO_CART");app.showNotify({text:notifyText,type:"success"}),product.data("amountInShoppingCart",amountInShoppingCart+_amount);}});}}});}},{key:"registerEvents",value:function registerEvents(){this.container=$(".js-preview"),this.registerAmountChange(),this.registerButtonAddToCart(),this.registerButtonAddToCartForBundles();}}]),_class}();
//# sourceMappingURL=Preview.min.js.map
